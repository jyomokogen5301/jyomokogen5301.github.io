<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <title>ももてつもどき</title>
    <link rel="stylesheet" href="./style.css"><!--CSSファイル読み込み-->
    <script src='./plugin/compress.js'></script><!--圧縮プラグイン挿入-->
</head>

<body>
    <div class="load"><input type="file" onchange="data.loadFile(this)" id='input'></div>
    <canvas id="can1"></canvas>
    <script>
        let locX = 0; //fitCanvasSize関数で初期値を設定
        let locY = 0; //fitCanvasSize関数で初期値を設定
        let ctx, canvas, txw, txw2, txw3;
        let sta_name = "";
        let adj = { x: 0, y: 0, s: 0, seth: 0 }; //位置調整用。sは駅名の表示位置調整。sethは設定画面の高さ調整。
        let center = { x: 0, y: 0, x2: 0, y2: 0, x3: 0, y3: 0 };
        //centerのxは現在の中心、x2は、x3とx1の差、x3は画面の中心
        let context = "";
        let temporary = { arr: {}, i: { n: '', n2: '', n3: '', n4: '', p: '' } };//一時的な値を格納
        let dpr = devicePixelRatio;
        if (dpr > 1.75) dpr = 1.75; //dprの上限(1.75)を設定
        let r = 1 * dpr;//raito(比率)を設定
        let size = { font: 40 };
        let shapes = [];
        let strings = "";
        let yn_strings = "";
        let steal_card = "";
        let now = { player: 0, dest: { n: '', x: '', y: '' }, time: 0, state: 'monthstart', dice_roll: 0, can: { move: false, canvas_touch: false, move_roll: 0, bukken: { buy: false, }, card: { buy: false, } }, next: { arrive: false }, mouse: false, mousemoving: false, }; //mouseはマウスが押された状態であるか
        //destはdestination、目的地の座標が格納。nは名前、x、yは座標。timeは最初の１か月を１として計測。dice_rollはサイコロの目。

        Object.prototype.areaname = function () {
            temporary.i26 = '';
            if (this == 'saitama') temporary.i26 = '埼玉県';
            else if (this == 'tokyo') temporary.i26 = '東京都';
            else if (/chiba|bousou|shimousa/.test(this)) temporary.i26 = '千葉県';
            else if (this == 'kanagawa') temporary.i26 = '神奈川県';
            else if (this == 'ibaraki') temporary.i26 = '茨城県';
            else if (this == 'gunma') temporary.i26 = '群馬県';
            else if (this == 'tochigi') temporary.i26 = '栃木県';
            else if (this == 'shizuoka') temporary.i26 = '静岡県';
            return temporary.i26;
        }
        let display = { f: {}, s: { sta_name: true, bukken: false, bukken_sta: 0, txtbox: false, money: false, state: false, cmd1: false, cmd2: false, cmd3: false, yn: false, yn_de: false, card: false, roulette: false, moving: false, glasses: false, buycard: false, card_sta: 0, setting: false, } }; //sはsituation(状況)のs ynはyes or no
        display.f.sta_name = function () {
            if (display.s.sta_name) display.s.sta_name = false;
            else display.s.sta_name = true;
        }; display.f.bukken = function (b_place, tf, mode) {
            console.log(b_place);
            if (mode == undefined) mode = 'arrive';
            if (tf == undefined && display.s.bukken) display.s.bukken = false;
            else if (tf == undefined && (!(display.s.bukken))) display.s.bukken = true;
            else if (tf) display.s.bukken = true;
            else if (!(tf)) display.s.bukken = false;
            if (b_place.length > 1) {
                temporary.i = search.f.coordinate(b_place[1], b_place[2]);
                if (temporary.i.n.charAt(temporary.i.n.length - 1) == '駅') temporary.i.n = temporary.i.n.substring(0, temporary.i.n.length - 1)
                display.s.txtbox = true;
                if (mode == 'glasses') {
                    strings = `ここは物件駅、${temporary.i.n}ですぞ！！`;
                    strings += display.f.can.move(b_place[1], b_place[2]).strings;
                }
                display.s.bukken_sta = temporary.i.order;
                console.log(temporary.i.order);
                display.s.money = true; //金額表示を表示
            }
        };
        display.f.txtbox = function (txtbox_strings2, tf) {
            let txtbox_strings = txtbox_strings2;
            console.log(txtbox_strings);
            if (Array.isArray(txtbox_strings2)) {
                txtbox_strings = txtbox_strings2[0];
                temporary.i = "";
                if (txtbox_strings2.length > 1) {
                    temporary.i = stde(search.f.coordinate(txtbox_strings2[1], txtbox_strings2[2]));
                    display.f.bukken(['none'], false);//物件表示を消す
                    display.s.money = true;//金額表示を表示
                }
            }
            if (!(txtbox_strings == undefined || txtbox_strings == 'none')) {
                //最初のif文の編集も忘れずに
                if (/nicecard|yellow|card|blue|plus|red|minus|port|buycard/.test(txtbox_strings.toLowerCase())) {
                    temporary.i.n2 = stde(temporary.i.n);
                    if (!(temporary.i.n2 == '')) temporary.i.n2 = '、' + temporary.i.n2;
                    temporary.p = search.f.coordinate(txtbox_strings2[1], txtbox_strings2[2]).p;
                    if (!(temporary.p == undefined) && !(temporary.p.areaname() == '')) temporary.i.n2 += '(' + temporary.p.areaname() + ')';
                    if (/nicecard/.test(txtbox_strings.toLowerCase())) strings = 'ここはナイスカード駅' + temporary.i.n2 + 'ですぞ！';
                    else if (/yellow|card/.test(txtbox_strings.toLowerCase())) strings = 'ここはカード駅' + temporary.i.n2 + 'ですぞ！';
                    else if (/blue|plus/.test(txtbox_strings.toLowerCase())) strings = `ここはプラス駅${temporary.i.n2}ですぞ！`;
                    else if (/red|minus/.test(txtbox_strings.toLowerCase())) strings = `ここはマイナス駅${temporary.i.n2}ですぞ！`;
                    else if (/port/.test(txtbox_strings.toLowerCase())) strings = `ここは${temporary.i.n2}ですぞ！`;
                    else if (/buycard/.test(txtbox_strings.toLowerCase())) strings = `ここはカード売り場駅${temporary.i.n2}ですぞ！`;
                    else strings = `ここは${temporary.i.n2}ですぞ！`;
                    /*if (glasses.tf == true && now.can.move == true) {
                        if (past.coordinate.length < 1) past.coordinate.push({ x: player[now.player].x, y: player[now.player].y });
                        temporary.arr.result = search.f.route({ x: past.coordinate[0].x, y: past.coordinate[0].y }, '', now.can.move_roll);
                        temporary.i29 = temporary.arr.result.r.filter(value => value.x == txtbox_strings2[1] && value.y == txtbox_strings2[2]);
                        if (temporary.i29.length < 1) strings += '\nこの駅はどうやっても行けませんぞ!!';
                        else strings += '\nこの駅には行けますぞ！';
                    }*/
                    strings += display.f.can.move(txtbox_strings2[1], txtbox_strings2[2]).strings;
                } else strings = txtbox_strings;
            }
            if (tf == undefined && display.s.txtbox) display.s.txtbox = false;
            else if (tf == undefined && (!(display.s.txtbox))) display.s.txtbox = true;
            else if (tf) display.s.txtbox = true;
            else if (!(tf)) display.s.txtbox = false;
        }
        display.f.can = {};
        display.f.can.move = function (x, y) {
            temporary.i30 = { strings: '', tf: false, r: [] };
            if (glasses.tf == true && now.can.move == true) {
                if (past.coordinate.length < 1) past.coordinate.push({ x: player[now.player].x, y: player[now.player].y });
                temporary.arr.result = search.f.route({ x: past.coordinate[0].x, y: past.coordinate[0].y }, '', now.can.move_roll + past.coordinate.length - 1);
                temporary.i29 = temporary.arr.result.r2.filter(value => value[value.length - 1].x == x && value[value.length - 1].y == y);
                if (temporary.i29.length < 1) {
                    temporary.i30.strings = '\nこの駅はどうやっても行けませんぞ!!';
                    temporary.i30.tf = false;
                    display.s.yn = false;
                    temporary.i30.r = [];
                } else {
                    temporary.i30.strings = '\nこの駅に行きますか?';
                    temporary.i30.tf = true;
                    temporary.i30.r = temporary.i29;
                    moving.auto.r2 = temporary.i30.r;
                    display.s.yn = true;
                    yn_strings = 'routego';
                }
            }
            return temporary.i30;
        }
        let money = {};
        money.unit = ['京', '兆', '億', '万'];
        money.f = function (value) { //conversionのcon
            if (value == undefined) value = '';
            value = value.toString();
            temporary.money = value;
            if (value.charAt(0) == '-') temporary.money = temporary.money.substring(1, temporary.money.length);
            temporary.arr.money = [];
            let i9;
            for (i9 = 0; i9 < temporary.money.length / 4; i9++) {
                temporary.arr.money.unshift(temporary.money.substring(temporary.money.length - 4 - i9 * 4, temporary.money.length - i9 * 4));
            }
            temporary.money = '';
            for (i9 = 0; i9 < temporary.arr.money.length; i9++) {
                if (!(parseFloat(temporary.arr.money[temporary.arr.money.length - 1 - i9]) === 0)) temporary.money = parseFloat(temporary.arr.money[temporary.arr.money.length - 1 - i9]) + money.unit[money.unit.length - 1 - i9] + temporary.money;
            }
            if (temporary.money == '') temporary.money = 0;
            if (value.charAt(0) == '-') temporary.money = '-' + temporary.money; //負の数の場合
            return temporary.money;
        }
        let box = {
            w: 40, //横
            h: 40, //縦
        };
        box.p = [ //boxのplace=場所を格納。dは名前の表示方向で、n=north(北)s=south(南)e=east(東)w=west(南)。seは南東になる。
            //{x:x座標,y:y座標,n:名前,d:direction(名前の表示方向), s:文字を右、左、中央のどれに寄せるか(right,left,center), b:物件or色マスとか[{n:名前,v:価格, p:利益率(profits), w:who(所持者)(番号で書く。)}]}
            //テンプレ{ x: , y: , n: '駅', d: "", s:'left', b: [{ n: '', v: , w: 'none',p: },] },
            //1000:1000万,10000:1億,100000:10億,1000000:100億,10000000:1000億,10000000:1兆
            { x: -2, y: -5, n: '赤羽駅', d: "sw", s: 'right', p: 'tokyo', b: [], },
            { x: -1, y: -5, n: '東十条駅', d: "e", s: 'left', p: 'tokyo', b: 'plus', },
            { x: -1, y: -4, n: '王子駅', d: "s", s: 'center', p: 'tokyo', b: 'card', },
            { x: 0, y: -4, n: '上中里駅', d: "e", s: 'left', p: 'tokyo', b: 'plus', },
            { x: 0, y: -3, n: '田端駅', d: "se", s: 'left', p: 'tokyo', b: 'card', },

            { x: -1, y: -3, n: '駒込駅', d: "s", s: 'center', p: 'tokyo', b: 'plus', },
            { x: -2, y: -3, n: '大塚駅', d: "s", s: 'center', p: 'tokyo', b: [{ n: '雑居ビル', v: 15000, p: 20, w: 'none' }, { n: '商店街(北口)', v: 20000, p: 10, w: 'none' }, { n: '商店街(南口)', v: 20000, p: 10, w: 'none' },], },

            { x: 0, y: -2, n: '上野駅', d: "w", s: 'right', p: 'tokyo', b: [{ n: 'どら焼き屋', v: 1000, p: 90, w: 'none' }, { n: 'パンダ土産屋', v: 1000, p: 80, w: 'none' }, { n: '科学博物館', v: 1100000, p: 8, w: 'none' }, { n: '美術博物館', v: 1150000, p: 8, w: 'none' }, { n: '動物園', v: 1120000, p: 8, w: 'none' }] },
            { x: 0, y: -1, n: '秋葉原駅', d: "ne", s: 'left', p: 'tokyo', b: [{ n: 'メイド喫茶店', v: 10000, p: 10, w: 'none' }, { n: '家電量販店', v: 10000, p: 9, w: 'none' }] },
            { x: 0, y: 0, n: '東京駅', d: "w", s: 'right', p: 'tokyo', b: [{ n: '東京ばなな屋', v: 1000, p: 80, w: 'none' }, { n: '駅弁屋', v: 2000, p: 50, w: 'none' }, { n: '証券会社', v: 50000000, p: 50, w: 'none' }] },
            { x: -1, y: -1, n: '水道橋駅', d: "n", s: 'right', p: 'tokyo', b: [{ n: '餃子屋', v: 1000, p: 80, w: 'none' }, { n: '雑居ビル', v: 15000, p: 10, w: 'none' }, { n: '遊園地', v: 400000, p: 15, w: 'none' }, { n: '野球場', v: 400000, p: 15, w: 'none' },] },
            { x: -2, y: -1, n: '千駄ヶ谷駅', d: "s", s: 'center', p: 'tokyo', b: [{ n: 'お土産屋', v: 1000, p: 60, w: 'none' }, { n: '将棋館', v: 10000, p: 10, w: 'none' }, { n: '国立競技場', v: 5000000, p: 6, w: 'none' }] },
            { x: -3, y: -1, n: '新宿駅', d: "n", s: 'right', p: 'tokyo', b: [{ n: 'カラオケ店', v: 1000, p: 60, w: 'none' }, { n: '百貨店', v: 1000000, p: 30, w: 'none' }, { n: '家電量販店', v: 100000, p: 60, w: 'none' }, { n: 'バスターミナル', v: 1000000, p: 15, w: 'none' }, { n: '駅ビル', v: 1000000, p: 20, w: 'none' },] },

            { x: -3, y: -2, n: '高田馬場駅', d: "e", s: 'left', p: 'tokyo', b: 'card', },
            { x: -3, y: -3, n: '池袋駅', d: "s", s: 'center', p: 'tokyo', b: [{ n: '家電量販店', v: 100000, p: 60, w: 'none' }, { n: '水族館', v: 100000, p: 20, w: 'none' }, { n: '百貨店店', v: 1000000, p: 30, w: 'none' }, { n: '百貨店', v: 1000000, p: 30, w: 'none' }, { n: '駅ビル', v: 1000000, p: 20, w: 'none' },], },
            { x: -3, y: -4, n: '板橋駅', d: "sw", s: 'right', p: 'tokyo', b: 'card', },
            { x: -2, y: -4, n: '十条駅', d: "s", s: 'center', p: 'tokyo', b: 'blue', },

            { x: -3, y: 0, n: '原宿駅', d: "e", s: 'left', p: 'tokyo', b: [], },
            { x: -3, y: 1, n: '渋谷駅', d: "n", s: 'center', p: 'tokyo', b: [], },
            { x: -2, y: 1, n: '恵比寿駅', d: "ne", s: 'center', p: 'tokyo', b: [], },
            { x: -3, y: 2, n: '中目黒駅', d: "ne", s: 'center', p: 'tokyo', b: 'card', },
            { x: -2, y: 2, n: '目黒駅', d: "ne", s: 'center', p: 'tokyo', b: 'plus', },
            { x: -1, y: 2, n: '大崎駅', d: "s", s: 'center', p: 'tokyo', b: 'card', },
            //東海道方面
            { x: 0, y: 1, n: '新橋駅', d: "w", s: 'right', p: 'tokyo', b: 'buycard', set: 0 },
            { x: 0, y: 2, n: '品川駅', d: "ne", s: 'left', p: 'tokyo', b: [], },
            { x: 0, y: 3, n: '大井町駅', d: "e", s: 'left', p: 'tokyo', b: 'plus', },
            { x: 0, y: 4, n: '蒲田駅', d: "s", s: 'center', p: 'tokyo', b: 'plus', },
            { x: 1, y: 4, n: '羽田駅', d: "s", s: 'center', p: 'tokyo', b: [{ n: 'お土産屋', v: 1000, w: 'none', p: 80 }, { n: 'お土産屋', v: 1000, w: 'none', p: 80 }, { n: '空港第一ビル', v: 12000000, w: 'none', p: 40 }, { n: '空港第二ビル', v: 12000000, w: 'none', p: 40 }, { n: '空港第三ビル', v: 12000000, w: 'none', p: 40 },], },
            { x: -1, y: 4, n: '川崎駅', d: "s", s: 'center', p: 'kanagawa', b: [], },
            { x: -2, y: 4, n: '鶴見駅', d: "s", s: 'center', p: 'kanagawa', b: 'card', },
            { x: -2, y: 5, n: '生麦駅', d: "s", s: 'ceter', p: 'kanagawa', b: [{ n: 'ビール会社', v: 12000000, w: 'none', p: 20 },], },
            { x: -3, y: 5, n: '横浜駅', d: "s", s: 'ceter', p: 'kanagawa', b: [], },
            { x: -4, y: 5, n: '平沼橋駅', d: "s", s: 'center', p: 'kanagawa', b: 'card', },
            { x: -5, y: 5, n: '保土ヶ谷駅', d: "s", s: 'right', p: 'kanagawa', b: 'plus', },
            { x: -6, y: 5, n: '戸塚駅', d: "n", s: 'center', p: 'kanagawa', b: 'card', },
            { x: -6, y: 6, n: '大船駅', d: "s", s: 'center', p: 'kanagawa', b: [{ n: '巨大観音像土産屋', v: 1500, w: 'none', p: 50 },], },
            { x: -7, y: 6, n: '藤沢駅', d: "s", s: 'center', p: 'kanagawa', b: 'plus', },
            { x: -8, y: 6, n: '辻堂駅', d: "s", s: 'center', p: 'kanagawa', b: 'plus', },
            { x: -9, y: 6, n: '茅ヶ崎駅', d: "s", s: 'center', p: 'kanagawa', b: [], },
            { x: -10, y: 6, n: '平塚駅', d: "w", s: 'right', p: 'kanagawa', b: [], },
            { x: -10, y: 7, n: '大磯駅', d: "s", s: 'center', p: 'kanagawa', b: 'blue', },
            { x: -11, y: 7, n: '二宮駅', d: "s", s: 'center', p: 'kanagawa', b: 'card', },
            { x: -12, y: 7, n: '国府津駅', d: "n", s: 'center', p: 'kanagawa', b: 'card', },
            { x: -12, y: 8, n: '鴨宮駅', d: "e", s: 'left', p: 'kanagawa', b: 'red', },
            { x: -13, y: 8, n: '小田原駅', d: "s", s: 'center', p: 'kanagawa', b: [], },
            { x: -13, y: 9, n: '根府川駅', d: "e", s: 'left', p: 'kanagawa', b: 'red', },
            { x: -13, y: 10, n: '真鶴駅', d: "e", s: 'left', p: 'kanagawa', b: 'card', },
            { x: -14, y: 10, n: '湯河原駅', d: "w", s: 'right', p: 'kanagawa', b: 'plus', },
            { x: -14, y: 11, n: '熱海駅', d: "s", s: 'center', p: 'shizuoka', b: [], },
            { x: -13, y: 11, n: '熱海港', d: "s", s: 'center', p: 'shizuoka', b: 'port', },
            { x: -15, y: 11, n: '来宮駅', d: "s", s: 'center', p: 'shizuoka', b: 'card', },
            { x: -16, y: 11, n: '函南駅', d: "s", s: 'center', p: 'shizuoka', b: 'red', },
            { x: -17, y: 11, n: '三島駅', d: "s", s: 'center', p: 'shizuoka', b: [], },
            { x: -18, y: 11, n: '沼津駅', d: "s", s: 'center', p: 'shizuoka', b: [], },
            //伊豆半島
            { x: -15, y: 12, n: '伊豆多賀駅', d: "s", s: 'center', p: 'shizuoka', b: 'card', },
            { x: -14, y: 12, n: '網代駅', d: "e", s: 'left', p: 'shizuoka', b: 'red', },
            { x: -14, y: 13, n: '伊東駅', d: "s", s: 'center', p: 'shizuoka', b: 'card', },
            { x: -13, y: 13, n: '川奈駅', d: "n", s: 'center', p: 'shizuoka', b: 'red', },
            { x: -13, y: 14, n: '富戸駅', d: "e", s: 'left', p: 'shizuoka', b: 'red', },
            { x: -13, y: 15, n: '伊豆高原駅', d: "e", s: 'left', p: 'shizuoka', b: [], },
            { x: -14, y: 15, n: '伊豆大川駅', d: "w", s: 'right', p: 'shizuoka', b: 'plus', },
            { x: -14, y: 16, n: '伊豆熱川駅', d: "e", s: 'left', p: 'shizuoka', b: 'card', },
            { x: -14, y: 17, n: '伊豆稲取駅', d: "e", s: 'left', p: 'shizuoka', b: 'red', },
            { x: -15, y: 17, n: '河津駅', d: "s", s: 'center', p: 'shizuoka', b: 'card', },
            { x: -16, y: 17, n: '蓮台寺駅', d: "n", s: 'center', p: 'shizuoka', b: 'red', },
            { x: -16, y: 18, n: '下田駅', d: "e", s: 'left', p: 'shizuoka', b: [], },
            { x: -16, y: 19, n: '下田港', d: "w", s: 'right', p: 'shizuoka', b: 'port', },

            //三浦半島方面
            { x: -3, y: 6, n: '中華街駅', d: "e", s: 'left', p: 'kanagawa', b: [{ n: '中華レストラン', v: 1000, w: 'none', p: 70 }, { n: '中華レストラン', v: 1000, w: 'none', p: 70 },], },
            { x: -4, y: 6, n: '上大岡駅', d: "se", s: 'left', p: 'kanagawa', b: 'plus', },
            { x: -5, y: 6, n: '港南台駅', d: "s", s: 'center', p: 'kanagawa', b: 'plus', },
            { x: -4, y: 7, n: '金沢八景駅', d: "e", s: 'left', p: 'kanagawa', b: [{ n: '水族館', v: 500000, w: 'none', p: 20 }, { n: '大学', v: 2000000, w: 'none', p: 7 },], },
            { x: -7, y: 7, n: '江の島駅', d: "w", s: 'right', p: 'kanagawa', b: [{ n: '水族館', v: 500000, w: 'none', p: 20 },], },
            { x: -6, y: 7, n: '鎌倉駅', d: "s", s: 'center', p: 'kanagawa', b: [{ n: '昔ながらの街並み', v: 100000, w: 'none', p: 10 },], },
            { x: -5, y: 7, n: '逗子駅', d: "s", s: 'center', p: 'kanagawa', b: 'card', },
            { x: -5, y: 8, n: '葉山駅', d: "s", s: 'center', p: 'kanagawa', b: [{ n: '高級別荘地', v: 2000000, w: 'none', p: 10 },], },
            { x: -4, y: 8, n: '横須賀駅', d: "s", s: 'center', p: 'kanagawa', b: [], },
            { x: -3, y: 8, n: '堀ノ内駅', d: "n", s: 'center', p: 'kanagawa', b: 'blue', },
            { x: -2, y: 8, n: '浦賀駅', d: "e", s: 'left', p: 'kanagawa', b: 'card', },
            { x: -3, y: 9, n: '久里浜駅', d: "w", s: 'right', p: 'kanagawa', b: 'blue', },
            { x: -2, y: 9, n: '久里浜港', d: "s", s: 'center', p: 'kanagawa', b: 'port', },
            { x: -3, y: 10, n: '三崎駅', d: "w", s: 'right', p: 'kanagawa', b: [], },
            //品鶴線とか東急東横線とか
            { x: -1, y: 3, n: '西大井駅', d: "s", s: 'ceter', p: 'tokyo', b: 'minus', },
            { x: -2, y: 3, n: '小杉駅', d: "s", s: 'center', p: 'kanagawa', b: [{ n: '高層マンション', v: 8600000, w: 'none', p: 10 },], },
            { x: -3, y: 3, n: '田園調布駅', d: "ne", s: 'center', p: 'tokyo', b: [{ n: '高級住宅街', v: 100000, w: 'none', p: 20 }, { n: '高級住宅街', v: 100000, w: 'none', p: 20 },], },
            { x: -3, y: 4, n: '新横浜駅', d: "s", s: 'center', p: 'kanagawa', b: 'plus', },
            //相鉄・神奈川南部
            { x: -4, y: 4, n: '西谷駅', d: "n", s: 'left', p: 'kanagawa', b: 'plus', },
            { x: -5, y: 4, n: '鶴ヶ峰駅', d: "se", s: 'right', p: 'kanagawa', b: 'minus', },
            { x: -6, y: 4, n: '二俣川駅', d: "nw", s: 'center', p: 'kanagawa', b: 'card', },
            { x: -7, y: 4, n: '大和駅', d: "nw", s: 'right', p: 'kanagawa', b: 'plus', },
            { x: -7, y: 5, n: '湘南台駅', d: "w", s: 'right', p: 'kanagawa', b: [], },
            { x: -8, y: 4, n: 'さがみ野駅', d: "se", s: 'center', p: 'kanagawa', b: 'plus', },
            { x: -9, y: 4, n: '海老名駅', d: "se", s: 'right', p: 'kanagawa', b: [], },
            { x: -7, y: 3, n: '中央林間駅', d: "nw", s: 'right', p: 'kanagawa', b: 'plus', },
            { x: -7, y: 2, n: '大野駅', d: "nw", s: 'center', p: 'kanagawa', b: 'plus', },

            { x: -8, y: 2, n: '相武台駅', d: "n", s: 'right', p: 'kanagawa', b: 'blue', },
            { x: -8, y: 3, n: '相武台下駅', d: "sw", s: 'right', p: 'kanagawa', b: 'minus', },
            //相模線
            { x: -9, y: 5, n: '倉見駅', d: "w", s: 'right', p: 'kanagawa', b: 'red', },
            { x: -9, y: 3, n: '座間駅', d: "w", s: 'right', p: 'kanagawa', b: 'card', },
            { x: -9, y: 2, n: '原当麻駅', d: "w", s: 'right', p: 'kanagawa', b: 'red', },
            { x: -9, y: 1, n: '上溝駅', d: "w", s: 'right', p: 'kanagawa', b: 'red', },
            { x: -9, y: 0, n: '橋本駅', d: "w", s: 'right', p: 'kanagawa', b: [], },
            { x: -9, y: -1, n: '片倉駅', d: "sw", s: 'right', p: 'tokyo', b: 'card', },
            //小田急
            { x: -6, y: 2, n: '町田駅', d: "sw", s: 'right', p: 'tokyo', b: [], },
            { x: -5, y: 2, n: '百合丘駅', d: "n", s: 'right', p: 'kanagawa', b: 'plus', },
            { x: -5, y: 1, n: '登戸駅', d: "n", s: 'center', p: 'kanagawa', b: 'plus', },
            { x: -5, y: 0, n: '狛江駅', d: "n", s: 'right', p: 'tokyo', b: 'plus', },
            { x: -4, y: 0, n: '下北沢駅', d: "n", s: 'center', p: 'tokyo', b: [], },

            { x: -8, y: 1, n: '黒川駅', d: "n", s: 'center', p: 'kanagawa', b: 'card', }, //小田急多摩線
            { x: -7, y: 1, n: '栗平駅', d: "se", s: 'center', p: 'kanagawa', b: 'red', },
            { x: -6, y: 1, n: '五月台駅', d: "n", s: 'center', p: 'kanagawa', b: 'plus', },
            //東急田園都市線
            { x: -4, y: 1, n: '太子堂駅', d: "n", s: 'center', p: 'tokyo', b: 'blue', },
            { x: -4, y: 2, n: '二子玉川駅', d: "n", s: 'center', p: 'tokyo', b: [], },
            { x: -4, y: 3, n: '溝の口駅', d: "n", s: 'center', p: 'kanagawa', b: 'card', },
            { x: -5, y: 3, n: 'あざみ野駅', d: "s", s: 'center', p: 'kanagawa', b: [], },
            { x: -6, y: 3, n: '長津田駅', d: "ne", s: 'center', p: 'kanagawa', b: [], },
            //京王
            { x: -4, y: -1, n: '笹塚駅', d: "n", s: 'center', p: 'tokyo', b: [], },
            { x: -5, y: -1, n: '桜上水駅', d: "n", s: 'center', p: 'tokyo', b: 'plus', },
            { x: -6, y: -1, n: '上北沢駅', d: "n", s: 'right', p: 'tokyo', b: 'plus', },
            { x: -6, y: 0, n: '仙川駅', d: "n", s: 'center', p: 'tokyo', b: 'plus', },
            { x: -7, y: 0, n: '調布駅', d: "s", s: 'center', p: 'tokyo', b: [], },
            { x: -8, y: 0, n: '永山駅', d: "n", s: 'center', p: 'tokyo', b: [], },
            { x: -7, y: -1, n: '府中駅', d: "s", s: 'center', p: 'tokyo', b: [], },
            { x: -8, y: -1, n: '高幡不動駅', d: "n", s: 'center', p: 'tokyo', b: [], },
            { x: -10, y: -1, n: 'めじろ台駅', d: "w", s: 'right', p: 'tokyo', b: 'card', },
            //中央線
            { x: -4, y: -2, n: '中野駅', d: "n", s: 'center', p: 'tokyo', b: 'card', },
            { x: -5, y: -2, n: '吉祥寺駅', d: "n", s: 'center', p: 'tokyo', b: [], },
            { x: -6, y: -2, n: '三鷹駅', d: "n", s: 'center', p: 'tokyo', b: 'card', },
            { x: -7, y: -2, n: '国分寺駅', d: "n", s: 'center', p: 'tokyo', b: 'plus', },
            { x: -8, y: -2, n: '立川駅', d: "n", s: 'right', p: 'tokyo', b: 'plus', },
            { x: -9, y: -2, n: '八王子駅', d: "sw", s: 'right', p: 'tokyo', b: [], },
            { x: -10, y: -2, n: '高尾駅', d: "n", s: 'center', p: 'tokyo', b: [], },
            { x: -11, y: -2, n: '相模湖駅', d: "n", s: 'center', p: 'kanagawa', b: [{ n: 'レジャー施設', v: 700000, w: 'none', p: 10 },], },
            { x: -12, y: -2, n: '上野原駅', d: "s", s: 'center', p: 'yamanashi', b: 'minus', },
            //千葉方面
            { x: 1, y: -1, n: '両国駅', d: "se", s: 'left', p: 'tokyo', b: [{ n: 'お土産屋', v: 1000, w: 'none', p: 70 }, { n: '歴史博物館', v: 1200000, w: 'none', p: 20 }, { n: '国技館', v: 1500000, w: 'none', p: 35 }], },
            { x: 2, y: -1, n: '小岩駅', d: "n", s: 'left', p: 'tokyo', b: 'card', },
            { x: 3, y: -1, n: '市川駅', d: "n", s: 'left', p: 'chiba', b: 'plus', },
            { x: 4, y: -1, n: '本八幡駅', d: 'n', s: 'left', p: 'chiba', b: 'card' },
            { x: 5, y: -1, n: '船橋駅', d: "e", s: 'left', p: 'chiba', b: [{ n: '駅ビル', v: 300000, w: 'none', p: 40 }, { n: '百貨店', v: 400000, w: 'none', p: 35 }, { n: '競馬場', v: 500000, w: 'none', p: 20 }], },
            { x: 5, y: 0, n: '津田沼駅', d: "s", s: 'center', p: 'chiba', b: [{ n: '駅ビル', v: 300000, w: 'none', p: 40 }, { n: '百貨店', v: 400000, w: 'none', p: 25 }, { n: '百貨店', v: 400000, w: 'none', p: 25 }], },
            { x: 5, y: 1, n: '稲毛駅', d: "s", s: 'center', p: 'chiba', b: 'plus', },
            { x: 5, y: 2, n: '千葉駅', d: "s", s: 'center', p: 'chiba', b: [], },

            { x: 2, y: 1, n: '東雲駅', d: "w", s: 'right', p: 'tokyo', b: 'plus' },
            { x: 2, y: 2, n: '東京港', d: "e", s: 'left', p: 'tokyo', b: 'port', },
            { x: 1, y: 2, n: 'お台場駅', d: "s", s: 'right', p: 'tokyo', b: [{ n: 'ショッピングモール', v: 1200000, w: 'none', p: 20 }, { n: 'テレビ会社', v: 7000000, w: 'none', p: 20 }, { n: '展示場', v: 8000000, w: 'none', p: 20 },], },

            { x: 1, y: 0, n: '日本橋駅', d: "s", s: 'right', p: 'tokyo', b: [], },
            { x: 2, y: 0, n: '新木場駅', d: "s", s: 'center', p: 'tokyo', b: 'plus', },
            { x: 3, y: 0, n: '舞浜駅', d: "s", s: 'left', p: 'chiba', b: [{ n: 'リゾートホテル', v: 100000, w: 'none', p: 20 }, { n: 'リゾートホテル', v: 100000, w: 'none', p: 20 }, { n: '夢とネズミの王国', v: 95300000, w: 'none', p: 35 }, { n: '夢とネズミの王国', v: 95300000, w: 'none', p: 35 }], },
            { x: 4, y: 0, n: '南船橋駅', d: "n", s: 'center', p: 'chiba', b: 'card', },
            { x: 4, y: 1, n: '海浜幕張駅', d: "s", s: 'right', p: 'chiba', b: [{ n: 'リゾートホテル', v: 100000, w: 'none', p: 20 }, { n: 'リゾートホテル', v: 100000, w: 'none', p: 20 }, { n: '夢とネズミの王国', v: 95300000, w: 'none', p: 35 }, { n: '夢とネズミの王国', v: 95300000, w: 'none', p: 35 }], },
            { x: 4, y: 2, n: '稲毛海岸駅', d: "s", s: 'right', p: 'chiba', b: 'card', },
            { x: 4, y: 3, n: '千葉みなと駅', d: "sw", s: 'center', p: 'chiba', b: 'card', },
            { x: 5, y: 3, n: '蘇我駅', d: "s", s: 'center', p: 'chiba', b: [{ n: 'サッカーチーム', v: 600000, w: 'none', p: 20 },], },
            //内房
            { x: 5, y: 4, n: '五井駅', d: "w", s: 'right', p: 'bousou', b: 'nicecard' },
            { x: 5, y: 5, n: '姉ヶ崎駅', d: "s", s: 'center', p: 'bousou', b: 'minus' },
            { x: 4, y: 5, n: '巌根駅', d: "w", s: 'right', p: 'bousou', b: 'nicecard' },
            { x: 4, y: 6, n: '木更津駅', d: "nw", s: 'center', p: 'bousou', b: [] },
            { x: 3, y: 6, n: '君津駅', d: "w", s: 'right', p: 'bousou', b: 'nicecard' },
            { x: 3, y: 7, n: '大貫駅', d: "w", s: 'right', p: 'bousou', b: 'minus' },
            { x: 3, y: 8, n: '上総湊駅', d: "e", s: 'left', p: 'bousou', b: 'nicecard' },
            { x: 3, y: 9, n: '浜金谷港', d: "s", s: 'left', p: 'bousou', b: 'port' },
            { x: 3, y: 10, n: '安房勝山駅', d: "w", s: 'right', p: 'bousou', b: 'red' },
            { x: 3, y: 11, n: '館山駅', d: "s", s: 'center', p: 'bousou', b: [] },
            { x: 4, y: 11, n: '九重駅', d: "s", s: 'center', p: 'bousou', b: 'minus' },
            { x: 5, y: 11, n: '千倉駅', d: "s", s: 'center', p: 'bousou', b: 'buycard', set: 1 },
            { x: 5, y: 10, n: '南三原駅', d: 'w', s: 'right', p: 'bousou', b: 'minus' },
            { x: 6, y: 10, n: '和田浦駅', d: "e", s: 'left', p: 'bousou', b: 'minus' },
            { x: 6, y: 9, n: '太海駅', d: "w", s: 'right', p: 'bousou', b: 'minus' },
            { x: 6, y: 8, n: '安房鴨川駅', d: "n", s: 'right', p: 'bousou', b: [] },
            //東京湾航路
            { x: -1, y: 9, n: 0, d: "none", s: 'none', p: 'sea', b: 'plus' },
            { x: 0, y: 9, n: 1, d: "none", s: 'none', p: 'sea', b: 'plus' },
            { x: 1, y: 9, n: 2, d: "none", s: 'none', p: 'sea', b: 'plus' },
            { x: 2, y: 9, n: 3, d: "none", s: 'none', p: 'sea', b: 'minus' },
            //外房
            { x: 6, y: 3, n: '鎌取駅', d: "s", s: 'center', p: 'bousou', b: 'minus' },
            { x: 7, y: 3, n: '誉田駅', d: "s", s: 'center', p: 'bousou', b: 'nicecard' },
            { x: 8, y: 3, n: '大網駅', d: "n", s: 'center', p: 'bousou', b: 'minus' },
            { x: 9, y: 3, n: '東金駅', d: "s", s: 'center', p: 'bousou', b: 'minus' },
            { x: 10, y: 3, n: '片貝駅', d: "e", s: 'left', p: 'bousou', b: [] }, //九十九里鉄道
            { x: 8, y: 4, n: '本納駅', d: "e", s: 'left', p: 'bousou', b: 'minus' },
            { x: 8, y: 5, n: '茂原駅', d: "s", s: 'center', p: 'bousou', b: [] },
            { x: 9, y: 5, n: '一ノ宮駅', d: "e", s: 'left', p: 'bousou', b: 'nicecard' },
            { x: 9, y: 6, n: '大原駅', d: "e", s: 'left', p: 'bousou', b: 'nicecard' },
            { x: 9, y: 7, n: '御宿駅', d: "s", s: 'center', p: 'bousou', b: 'minus' },
            { x: 8, y: 7, n: '勝浦駅', d: "w", s: 'right', p: 'bousou', b: 'nicecard' },
            { x: 8, y: 8, n: '上総興津駅', d: "e", s: 'left', p: 'bousou', b: 'minus' },
            { x: 7, y: 8, n: '安房小湊駅', d: "s", s: 'center', p: 'bousou', b: [{ n: '廃墟遊園地', v: 600000, w: 'none', p: -30 },] }, //行川アイランドのこと。収益率はマイナス。プラスに転じるイベントがあるといいかも。
            //房総縦貫（小湊、いすみ、久留里）
            { x: 6, y: 4, n: '上総牛久駅', d: "se", s: 'center', p: 'bousou', b: 'plus' },
            { x: 6, y: 5, n: '里見駅', d: "e", s: 'left', p: 'bousou', b: 'minus' },
            { x: 6, y: 6, n: '養老渓谷駅', d: "s", s: 'center', p: 'bousou', b: [] },
            { x: 7, y: 6, n: '大多喜駅', d: "s", s: 'left', p: 'bousou', b: 'nicecard' },
            { x: 8, y: 6, n: '国吉駅', d: "se", s: 'center', p: 'bousou', b: 'minus' },
            { x: 5, y: 6, n: '久留里駅', d: "s", s: 'right', p: 'bousou', b: 'minus' },
            //千葉県銚子方面
            { x: 6, y: 2, n: '都賀駅', d: "e", s: 'left', p: 'shimousa', b: 'card' },
            { x: 6, y: 1, n: '四街道駅', d: "s", s: 'center', p: 'shimousa', b: 'nicecard' },
            { x: 7, y: 1, n: '佐倉駅', d: "s", s: 'center', p: 'shimousa', b: [] },
            { x: 8, y: 1, n: '八街駅', d: "e", s: 'left', p: 'shimousa', b: 'minus' },
            { x: 8, y: 2, n: '日向駅', d: "ne", s: 'left', p: 'shimousa', b: 'minus' },
            { x: 9, y: 2, n: '成東駅', d: "se", s: 'left', p: 'shimousa', b: 'buycard', set: 0 },
            { x: 10, y: 2, n: '松尾駅', d: "e", s: 'left', p: 'shimousa', b: 'minus' },
            { x: 10, y: 1, n: '横芝駅', d: "n", s: 'center', p: 'shimousa', b: 'card' },
            { x: 11, y: 1, n: '八日市場駅', d: "s", s: 'center', p: 'shimousa', b: 'buycard', set: 1 },
            { x: 12, y: 1, n: '旭駅', d: "s", s: 'center', p: 'shimousa', b: [] },
            { x: 13, y: 1, n: '倉橋駅', d: "s", s: 'center', p: 'shimousa', b: 'minus' },
            { x: 14, y: 1, n: '松岸駅', d: "s", s: 'center', p: 'shimousa', b: 'card' },
            { x: 15, y: 1, n: '銚子駅', d: "s", s: 'center', p: 'shimousa', b: [] },
            { x: 16, y: 1, n: '外川駅', d: "e", s: 'left', p: 'shimousa', b: 'card' },

            { x: 6, y: 0, n: '八千代駅', d: "n", s: 'center', p: 'chiba', b: 'blue' }, //京成
            { x: 7, y: 0, n: '酒々井駅', d: "s", s: 'center', p: 'shimousa', b: 'card' },
            { x: 8, y: 0, n: '成田駅', d: "s", s: 'center', p: 'shimousa', b: [] },
            { x: 9, y: 0, n: '久住駅', d: "e", s: 'left', p: 'shimousa', b: 'minus' },
            { x: 9, y: -1, n: '滑川駅', d: "n", s: 'center', p: 'shimousa', b: 'minus' },
            { x: 10, y: -1, n: '佐原駅', d: "n", s: 'center', p: 'shimousa', b: [] },
            { x: 11, y: -1, n: '香取駅', d: "s", s: 'center', p: 'shimousa', b: 'card' },
            { x: 12, y: -1, n: '水郷駅', d: "s", s: 'center', p: 'shimousa', b: 'card' },
            { x: 12, y: 0, n: '小見川駅', d: "w", s: 'right', p: 'shimousa', b: 'minus' },
            { x: 13, y: 0, n: '笹川駅', d: "s", s: 'center', p: 'shimousa', b: 'minus' },
            { x: 14, y: 0, n: '橘駅', d: "e", s: 'left', p: 'shimousa', b: 'card' },
            //鹿島線・鹿島臨海鉄道
            { x: 11, y: -2, n: '潮来駅', d: "w", s: 'right', p: 'ibaraki', b: 'nicecard' },
            { x: 12, y: -2, n: '延方駅', d: "n", s: 'center', p: 'ibaraki', b: 'minus' },
            { x: 13, y: -2, n: '鹿島駅', d: "e", s: 'left', p: 'ibaraki', b: [] },
            { x: 13, y: -1, n: '神栖駅', d: "e", s: 'left', p: 'ibaraki', b: [] },

            //小笠原航路
            { x: 2, y: 3, n: 10, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: 2, y: 4, n: 11, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: 2, y: 5, n: 12, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: 1, y: 5, n: 13, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: 1, y: 6, n: 14, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: 0, y: 6, n: 15, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: 0, y: 7, n: 16, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: 0, y: 8, n: 17, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: 0, y: 10, n: 18, d: "none", s: 'none', p: 'sea', b: 'plus', }, //x:0,y:9は東京湾航路
            { x: 0, y: 11, n: 19, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: 0, y: 12, n: 20, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: 0, y: 13, n: 21, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: 0, y: 14, n: 22, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: 0, y: 15, n: 23, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: 0, y: 16, n: 24, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: 0, y: 17, n: 25, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: 0, y: 18, n: 26, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: 0, y: 19, n: 27, d: "none", s: 'none', p: 'sea', b: 'plus', },
            //伊豆諸島・東海汽船航路   
            { x: -1, y: 11, n: 50, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -2, y: 11, n: 51, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -3, y: 11, n: 52, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -4, y: 11, n: 53, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -5, y: 11, n: 54, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -5, y: 12, n: 55, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -6, y: 12, n: 56, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -6, y: 13, n: 57, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -6, y: 14, n: 58, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -7, y: 14, n: 59, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -7, y: 15, n: 60, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -7, y: 16, n: 61, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -8, y: 16, n: 62, d: "none", s: 'none', p: 'sea', b: 'plus', },
            //伊豆諸島・大島方面航路
            { x: -12, y: 11, n: 80, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -11, y: 11, n: '初島港', d: "s", s: 'center', p: 'shizuoka', b: 'port', },
            { x: -10, y: 11, n: '初島駅', d: "e", s: 'left', p: 'shizuoka', b: [], },
            { x: -12, y: 12, n: 81, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -12, y: 13, n: 82, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -11, y: 13, n: 83, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -10, y: 13, n: 84, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -10, y: 14, n: 85, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -10, y: 15, n: 86, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -9, y: 15, n: 87, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -9, y: 16, n: 88, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -9, y: 17, n: '大島港', d: "w", s: 'right', p: 'tokyo', b: 'port', },
            { x: -8, y: 17, n: '伊豆大島駅', d: "e", s: 'left', p: 'tokyo', b: [], },
            { x: -9, y: 18, n: 89, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -9, y: 19, n: 90, d: "none", s: 'none', p: 'sea', b: 'minus', },
            { x: -9, y: 20, n: '利島港', d: "se", s: 'left', p: 'tokyo', b: 'port', },
            { x: -8, y: 20, n: '利島駅', d: "e", s: 'left', p: 'tokyo', b: [], },
            { x: -9, y: 21, n: 91, d: "none", s: 'none', p: 'sea', b: 'red', },
            { x: -9, y: 22, n: '新島港', d: "s", s: 'center', p: 'tokyo', b: 'port', },
            { x: -8, y: 22, n: '新島駅', d: "e", s: 'left', p: 'tokyo', b: [], },
            { x: -10, y: 22, n: '式根島港', d: "n", s: 'center', p: 'tokyo', b: 'port', },
            { x: -11, y: 22, n: '式根島駅', d: "w", s: 'right', p: 'tokyo', b: 'buycard', set: 1 },
            { x: -10, y: 23, n: 92, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -11, y: 23, n: 93, d: "none", s: 'none', p: 'sea', b: 'minus', },
            { x: -11, y: 24, n: 94, d: "none", s: 'none', p: 'sea', b: 'minus', },
            { x: -11, y: 25, n: '神津島港', d: "w", s: 'right', p: 'tokyo', b: 'port', },
            { x: -10, y: 25, n: '神津島駅', d: "e", s: 'left', p: 'tokyo', b: 'buycard', set: 1 },
            //下田からの航路
            //利島方面
            { x: -15, y: 19, n: 100, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -14, y: 19, n: 101, d: "none", s: 'none', p: 'sea', b: 'minus', },
            { x: -13, y: 19, n: 102, d: "none", s: 'none', p: 'sea', b: 'minus', },
            { x: -12, y: 19, n: 103, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -12, y: 20, n: 104, d: "none", s: 'none', p: 'sea', b: 'minus', },
            { x: -11, y: 20, n: 105, d: "none", s: 'none', p: 'sea', b: 'minus', },
            { x: -10, y: 20, n: 106, d: "none", s: 'none', p: 'sea', b: 'plus', },
            //神津島方面
            { x: -16, y: 20, n: 107, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -16, y: 21, n: 108, d: "none", s: 'none', p: 'sea', b: 'minus', },
            { x: -15, y: 21, n: 107, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -15, y: 22, n: 109, d: "none", s: 'none', p: 'sea', b: 'minus', },
            { x: -14, y: 22, n: 110, d: "none", s: 'none', p: 'sea', b: 'minus', },
            { x: -14, y: 23, n: 111, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -13, y: 23, n: 112, d: "none", s: 'none', p: 'sea', b: 'plus', },
            { x: -13, y: 24, n: 113, d: "none", s: 'none', p: 'sea', b: 'minus', },
            { x: -12, y: 24, n: 114, d: "none", s: 'none', p: 'sea', b: 'nicecard', },
        ];
        box.f = function (st) { //stringsのst
            let ew = 0; //東西(EastWest)
            let ns = 0; //南北(NorthSouth)
            if (st.charAt(0).toLowerCase() == 'n') ns = -50; //北
            else if (st.charAt(0).toLowerCase() == 's') ns = 50; //南
            if (st.charAt(st.length - 1).toLowerCase() == 'e') ew = 50; //東
            else if (st.charAt(st.length - 1).toLowerCase() == 'w') ew = -50; //西
            return [ew, ns];
        }
        for (let i18 = 0; i18 < box.p.length; i18++) box.p[i18].order = i18; //番号(order)を設定
        let s = 100; //駅(マス)間の間隔をここに格納
        let line = { //線路はここに格納
            w: box.w / 2, //箱の長さの半分
            p: [],
        }
        line.p = [
            // { c: (座標のCoordinateから、)[{ x: 1個目のx座標, y: y座標 }, { x: 2個目のx座標, y:y座標  }], l: 長さ(何マス分か) }
            //西から東、北から南の順に座標を入力（例:北東から南西）
            { c: [{ x: -2, y: -5 }, { x: -1, y: -5 }], l: 1 },
            { c: [{ x: -1, y: -5 }, { x: -1, y: -4 }], l: 1 },
            { c: [{ x: -1, y: -4 }, { x: 0, y: -4 }], l: 1 },
            { c: [{ x: 0, y: -4 }, { x: 0, y: -3 }], l: 1 },
            { c: [{ x: 0, y: -3 }, { x: 0, y: -2 }], l: 1 },
            { c: [{ x: 0, y: -2 }, { x: 0, y: -1 }], l: 1 },
            { c: [{ x: 0, y: -1 }, { x: 0, y: 0 }], l: 1 },

            //横浜方面・東海道方面
            { c: [{ x: 0, y: 0 }, { x: 0, y: 1 }], l: 1 },
            { c: [{ x: 0, y: 1 }, { x: 0, y: 2 }], l: 1 },
            { c: [{ x: 0, y: 2 }, { x: 0, y: 3 }], l: 1 },
            { c: [{ x: 0, y: 3 }, { x: 0, y: 4 }], l: 1 },
            { c: [{ x: -1, y: 4 }, { x: 0, y: 4 }], l: 1 },
            { c: [{ x: -2, y: 4 }, { x: -1, y: 4 }], l: 1 },
            { c: [{ x: -2, y: 4 }, { x: -2, y: 5 }], l: 1 },
            { c: [{ x: -3, y: 5 }, { x: -2, y: 5 }], l: 1 },
            { c: [{ x: -4, y: 5 }, { x: -3, y: 5 }], l: 1 },
            { c: [{ x: -5, y: 5 }, { x: -4, y: 5 }], l: 1 },
            { c: [{ x: -6, y: 5 }, { x: -5, y: 5 }], l: 1 },
            { c: [{ x: -6, y: 5 }, { x: -6, y: 6 }], l: 1 },
            { c: [{ x: -7, y: 6 }, { x: -6, y: 6 }], l: 1 },
            { c: [{ x: -8, y: 6 }, { x: -7, y: 6 }], l: 1 },
            { c: [{ x: -9, y: 6 }, { x: -8, y: 6 }], l: 1 },
            { c: [{ x: -10, y: 6 }, { x: -9, y: 6 }], l: 1 },
            { c: [{ x: -10, y: 6 }, { x: -10, y: 7 }], l: 1 },
            { c: [{ x: -11, y: 7 }, { x: -10, y: 7 }], l: 1 },
            { c: [{ x: -12, y: 7 }, { x: -11, y: 7 }], l: 1 },
            { c: [{ x: -12, y: 7 }, { x: -12, y: 8 }], l: 1 },
            { c: [{ x: -13, y: 8 }, { x: -12, y: 8 }], l: 1 },
            { c: [{ x: -13, y: 8 }, { x: -13, y: 9 }], l: 1 },
            { c: [{ x: -13, y: 9 }, { x: -13, y: 10 }], l: 1 },
            { c: [{ x: -14, y: 10 }, { x: -13, y: 10 }], l: 1 },
            { c: [{ x: -14, y: 10 }, { x: -14, y: 11 }], l: 1 },
            { c: [{ x: -14, y: 11 }, { x: -13, y: 11 }], l: 1 }, //熱海港支線
            { c: [{ x: -15, y: 11 }, { x: -14, y: 11 }], l: 1 },
            { c: [{ x: -16, y: 11 }, { x: -15, y: 11 }], l: 1 },
            { c: [{ x: -17, y: 11 }, { x: -16, y: 11 }], l: 1 },
            { c: [{ x: -18, y: 11 }, { x: -17, y: 11 }], l: 1 },
            //三浦半島方面(横浜以南)
            { c: [{ x: -3, y: 5 }, { x: -3, y: 6 }], l: 1 },
            { c: [{ x: -4, y: 6 }, { x: -3, y: 6 }], l: 1 },
            { c: [{ x: -4, y: 6 }, { x: -4, y: 7 }], l: 1 },
            { c: [{ x: -5, y: 7 }, { x: -4, y: 7 }], l: 1 },
            { c: [{ x: -4, y: 7 }, { x: -4, y: 8 }], l: 1 },
            { c: [{ x: -4, y: 8 }, { x: -3, y: 8 }], l: 1 },
            { c: [{ x: -3, y: 8 }, { x: -2, y: 8 }], l: 1 },

            { c: [{ x: -3, y: 8 }, { x: -3, y: 9 }], l: 1 },
            { c: [{ x: -3, y: 9 }, { x: -2, y: 9 }], l: 1 },
            { c: [{ x: -3, y: 9 }, { x: -3, y: 10 }], l: 1 },

            { c: [{ x: -6, y: 6 }, { x: -6, y: 7 }], l: 1 }, //大船～鎌倉
            { c: [{ x: -7, y: 6 }, { x: -7, y: 7 }], l: 1 }, //藤沢～江の島
            { c: [{ x: -7, y: 7 }, { x: -6, y: 7 }], l: 1 }, //鎌倉～江の島
            { c: [{ x: -6, y: 7 }, { x: -5, y: 7 }], l: 1 },
            { c: [{ x: -5, y: 7 }, { x: -5, y: 8 }], l: 1 },

            { c: [{ x: -5, y: 6 }, { x: -4, y: 6 }], l: 1 }, //根岸線　上大岡~大船
            { c: [{ x: -6, y: 6 }, { x: -5, y: 6 }], l: 1 },
            //品鶴線・東急
            { c: [{ x: -1, y: 2 }, { x: -1, y: 3 }], l: 1 },
            { c: [{ x: -2, y: 3 }, { x: -1, y: 3 }], l: 1 },
            { c: [{ x: -3, y: 3 }, { x: -2, y: 3 }], l: 1 },
            { c: [{ x: -4, y: 3 }, { x: -3, y: 3 }], l: 1 },
            { c: [{ x: -2, y: 3 }, { x: -2, y: 4 }], l: 1 },
            { c: [{ x: -3, y: 3 }, { x: -3, y: 4 }], l: 1 },
            { c: [{ x: -3, y: 4 }, { x: -3, y: 5 }], l: 1 },
            //神奈川南部平野
            { c: [{ x: -4, y: 4 }, { x: -4, y: 5 }], l: 1 },
            { c: [{ x: -4, y: 4 }, { x: -3, y: 4 }], l: 1 },
            { c: [{ x: -5, y: 4 }, { x: -4, y: 4 }], l: 1 },
            { c: [{ x: -6, y: 4 }, { x: -5, y: 4 }], l: 1 },
            { c: [{ x: -7, y: 4 }, { x: -6, y: 4 }], l: 1 },
            { c: [{ x: -7, y: 4 }, { x: -7, y: 5 }], l: 1 },
            { c: [{ x: -7, y: 5 }, { x: -7, y: 6 }], l: 1 },
            { c: [{ x: -7, y: 5 }, { x: -6, y: 5 }], l: 1 },
            { c: [{ x: -8, y: 4 }, { x: -7, y: 4 }], l: 1 },
            { c: [{ x: -9, y: 4 }, { x: -8, y: 4 }], l: 1 },
            { c: [{ x: -9, y: 4 }, { x: -9, y: 5 }], l: 1 },
            { c: [{ x: -9, y: 5 }, { x: -9, y: 6 }], l: 1 },

            //東急田園都市線・小田急
            { c: [{ x: -4, y: 1 }, { x: -3, y: 1 }], l: 1 },
            { c: [{ x: -4, y: 1 }, { x: -4, y: 2 }], l: 1 },
            { c: [{ x: -4, y: 2 }, { x: -4, y: 3 }], l: 1 },
            { c: [{ x: -5, y: 3 }, { x: -4, y: 3 }], l: 1 },
            { c: [{ x: -6, y: 3 }, { x: -5, y: 3 }], l: 1 },
            { c: [{ x: -7, y: 3 }, { x: -6, y: 3 }], l: 1 },


            { c: [{ x: -4, y: 0 }, { x: -3, y: 0 }], l: 1 },
            { c: [{ x: -5, y: 0 }, { x: -4, y: 0 }], l: 1 },
            { c: [{ x: -5, y: 0 }, { x: -5, y: 1 }], l: 1 },
            { c: [{ x: -5, y: 1 }, { x: -5, y: 2 }], l: 1 },

            { c: [{ x: -6, y: 2 }, { x: -5, y: 2 }], l: 1 },
            { c: [{ x: -7, y: 2 }, { x: -6, y: 2 }], l: 1 },
            { c: [{ x: -7, y: 2 }, { x: -7, y: 3 }], l: 1 },
            { c: [{ x: -7, y: 3 }, { x: -7, y: 4 }], l: 1 },

            { c: [{ x: -8, y: 2 }, { x: -7, y: 2 }], l: 1 }, //小田急本線
            { c: [{ x: -8, y: 2 }, { x: -8, y: 3 }], l: 1 },
            { c: [{ x: -9, y: 3 }, { x: -8, y: 3 }], l: 1 },

            { c: [{ x: -8, y: 0 }, { x: -8, y: 1 }], l: 1 }, //小田急多摩線
            { c: [{ x: -8, y: 1 }, { x: -7, y: 1 }], l: 1 },
            { c: [{ x: -7, y: 1 }, { x: -6, y: 1 }], l: 1 },
            { c: [{ x: -6, y: 1 }, { x: -6, y: 2 }], l: 1 },
            //八王子・多摩方面
            { c: [{ x: -4, y: -1 }, { x: -3, y: -1 }], l: 1 },
            { c: [{ x: -5, y: -1 }, { x: -4, y: -1 }], l: 1 },
            { c: [{ x: -6, y: -1 }, { x: -5, y: -1 }], l: 1 },
            { c: [{ x: -6, y: -1 }, { x: -6, y: 0 }], l: 1 },
            { c: [{ x: -7, y: 0 }, { x: -6, y: 0 }], l: 1 },
            { c: [{ x: -8, y: 0 }, { x: -7, y: 0 }], l: 1 },
            { c: [{ x: -9, y: 0 }, { x: -8, y: 0 }], l: 1 },

            { c: [{ x: -7, y: -1 }, { x: -7, y: 0 }], l: 1 },
            { c: [{ x: -8, y: -1 }, { x: -7, y: -1 }], l: 1 },
            { c: [{ x: -9, y: -1 }, { x: -8, y: -1 }], l: 1 },
            { c: [{ x: -10, y: -1 }, { x: -9, y: -1 }], l: 1 },
            { c: [{ x: -10, y: -2 }, { x: -10, y: -1 }], l: 1 },

            { c: [{ x: -4, y: -2 }, { x: -3, y: -2 }], l: 1 },
            { c: [{ x: -5, y: -2 }, { x: -4, y: -2 }], l: 1 },
            { c: [{ x: -6, y: -2 }, { x: -5, y: -2 }], l: 1 },
            { c: [{ x: -7, y: -2 }, { x: -6, y: -2 }], l: 1 },
            { c: [{ x: -8, y: -2 }, { x: -7, y: -2 }], l: 1 },
            { c: [{ x: -9, y: -2 }, { x: -8, y: -2 }], l: 1 },
            { c: [{ x: -10, y: -2 }, { x: -9, y: -2 }], l: 1 },
            { c: [{ x: -11, y: -2 }, { x: -10, y: -2 }], l: 1 },
            { c: [{ x: -12, y: -2 }, { x: -11, y: -2 }], l: 1 },
            //相模線
            { c: [{ x: -9, y: -2 }, { x: -9, y: -1 }], l: 1 },
            { c: [{ x: -9, y: -1 }, { x: -9, y: 0 }], l: 1 },
            { c: [{ x: -9, y: 0 }, { x: -9, y: 1 }], l: 1 },
            { c: [{ x: -9, y: 1 }, { x: -9, y: 2 }], l: 1 },
            { c: [{ x: -9, y: 2 }, { x: -9, y: 3 }], l: 1 },
            { c: [{ x: -9, y: 3 }, { x: -9, y: 4 }], l: 1 },
            //羽田支線
            { c: [{ x: 0, y: 4 }, { x: 1, y: 4 }], l: 1 },

            { c: [{ x: -1, y: -3 }, { x: 0, y: -3 }], l: 1 },
            { c: [{ x: -2, y: -3 }, { x: -1, y: -3 }], l: 1 },
            { c: [{ x: -3, y: -3 }, { x: -2, y: -3 }], l: 1 },

            { c: [{ x: -1, y: -1 }, { x: 0, y: -1 }], l: 1 },
            { c: [{ x: -2, y: -1 }, { x: -1, y: -1 }], l: 1 },
            { c: [{ x: -3, y: -1 }, { x: -2, y: -1 }], l: 1 },

            { c: [{ x: -3, y: 0 }, { x: -3, y: 1 }], l: 1 },
            { c: [{ x: -3, y: 1 }, { x: -3, y: 2 }], l: 1 },
            { c: [{ x: -3, y: 2 }, { x: -3, y: 3 }], l: 1 },
            { c: [{ x: -3, y: 1 }, { x: -2, y: 1 }], l: 1 },
            { c: [{ x: -2, y: 1 }, { x: -2, y: 2 }], l: 1 },
            { c: [{ x: -2, y: 2 }, { x: -1, y: 2 }], l: 1 },
            { c: [{ x: -1, y: 2 }, { x: 0, y: 2 }], l: 1 },


            { c: [{ x: -3, y: -1 }, { x: -3, y: 0 }], l: 1 },
            { c: [{ x: -3, y: -2 }, { x: -3, y: -1 }], l: 1 },
            { c: [{ x: -3, y: -3 }, { x: -3, y: -2 }], l: 1 },
            { c: [{ x: -3, y: -4 }, { x: -3, y: -3 }], l: 1 },
            { c: [{ x: -3, y: -4 }, { x: -2, y: -4 }], l: 1 },
            { c: [{ x: -2, y: -5 }, { x: -2, y: -4 }], l: 1 },

            { c: [{ x: 0, y: 0 }, { x: 1, y: 0 }], l: 1 }, //千葉方面
            { c: [{ x: 1, y: 0 }, { x: 2, y: 0 }], l: 1 },
            { c: [{ x: 2, y: 0 }, { x: 3, y: 0 }], l: 1 },
            { c: [{ x: 3, y: 0 }, { x: 4, y: 0 }], l: 1 },
            { c: [{ x: 4, y: 0 }, { x: 4, y: 1 }], l: 1 },
            { c: [{ x: 4, y: 1 }, { x: 4, y: 2 }], l: 1 },
            { c: [{ x: 4, y: 2 }, { x: 4, y: 3 }], l: 1 },
            { c: [{ x: 4, y: 3 }, { x: 5, y: 3 }], l: 1 },

            { c: [{ x: 1, y: -1 }, { x: 1, y: 0 }], l: 1 },

            { c: [{ x: 0, y: -1 }, { x: 1, y: -1 }], l: 1 },
            { c: [{ x: 1, y: -1 }, { x: 2, y: -1 }], l: 1 },
            { c: [{ x: 2, y: -1 }, { x: 3, y: -1 }], l: 1 },
            { c: [{ x: 3, y: -1 }, { x: 4, y: -1 }], l: 1 },
            { c: [{ x: 4, y: -1 }, { x: 5, y: -1 }], l: 1 },
            { c: [{ x: 5, y: -1 }, { x: 5, y: 0 }], l: 1 },
            { c: [{ x: 5, y: 0 }, { x: 5, y: 1 }], l: 1 },
            { c: [{ x: 5, y: 1 }, { x: 5, y: 2 }], l: 1 },
            { c: [{ x: 5, y: 2 }, { x: 5, y: 3 }], l: 1 },
            //南船橋~津田沼
            { c: [{ x: 4, y: 0 }, { x: 5, y: 0 }], l: 1 },
            //房総半島外房方面
            { c: [{ x: 5, y: 3 }, { x: 6, y: 3 }], l: 1 },
            { c: [{ x: 6, y: 3 }, { x: 7, y: 3 }], l: 1 },
            { c: [{ x: 7, y: 3 }, { x: 8, y: 3 }], l: 1 },
            { c: [{ x: 8, y: 3 }, { x: 8, y: 4 }], l: 1 },
            { c: [{ x: 8, y: 4 }, { x: 8, y: 5 }], l: 1 },
            { c: [{ x: 8, y: 5 }, { x: 9, y: 5 }], l: 1 },
            { c: [{ x: 9, y: 5 }, { x: 9, y: 6 }], l: 1 },
            { c: [{ x: 9, y: 6 }, { x: 9, y: 7 }], l: 1 },
            { c: [{ x: 8, y: 7 }, { x: 9, y: 7 }], l: 1 },
            { c: [{ x: 8, y: 7 }, { x: 8, y: 8 }], l: 1 },
            { c: [{ x: 7, y: 8 }, { x: 8, y: 8 }], l: 1 },
            { c: [{ x: 6, y: 8 }, { x: 7, y: 8 }], l: 1 },
            //房総半島内房方面
            { c: [{ x: 5, y: 3 }, { x: 5, y: 4 }], l: 1 },
            { c: [{ x: 5, y: 4 }, { x: 5, y: 5 }], l: 1 },
            { c: [{ x: 4, y: 5 }, { x: 5, y: 5 }], l: 1 },
            { c: [{ x: 4, y: 5 }, { x: 4, y: 6 }], l: 1 },
            { c: [{ x: 3, y: 6 }, { x: 4, y: 6 }], l: 1 },
            { c: [{ x: 3, y: 6 }, { x: 3, y: 7 }], l: 1 },
            { c: [{ x: 3, y: 7 }, { x: 3, y: 8 }], l: 1 },
            { c: [{ x: 2, y: 9 }, { x: 3, y: 9 }], l: 1 }, //浜金谷港支線
            { c: [{ x: 3, y: 8 }, { x: 3, y: 9 }], l: 1 },
            { c: [{ x: 3, y: 9 }, { x: 3, y: 10 }], l: 1 },
            { c: [{ x: 3, y: 10 }, { x: 3, y: 11 }], l: 1 },
            { c: [{ x: 3, y: 11 }, { x: 4, y: 11 }], l: 1 },
            { c: [{ x: 4, y: 11 }, { x: 5, y: 11 }], l: 1 },
            { c: [{ x: 5, y: 10 }, { x: 5, y: 11 }], l: 1 },
            { c: [{ x: 5, y: 10 }, { x: 6, y: 10 }], l: 1 },
            { c: [{ x: 6, y: 9 }, { x: 6, y: 10 }], l: 1 },
            { c: [{ x: 6, y: 8 }, { x: 6, y: 9 }], l: 1 },
            //房総半島縦貫線
            { c: [{ x: 5, y: 4 }, { x: 6, y: 4 }], l: 1 },
            { c: [{ x: 6, y: 4 }, { x: 6, y: 5 }], l: 1 },
            { c: [{ x: 6, y: 5 }, { x: 6, y: 6 }], l: 1 },
            { c: [{ x: 6, y: 6 }, { x: 7, y: 6 }], l: 1 },
            { c: [{ x: 7, y: 6 }, { x: 8, y: 6 }], l: 1 },
            { c: [{ x: 8, y: 6 }, { x: 9, y: 6 }], l: 1 },
            { c: [{ x: 4, y: 6 }, { x: 5, y: 6 }], l: 1 },
            { c: [{ x: 5, y: 6 }, { x: 6, y: 6 }], l: 1 },
            //総武本線・成田・成東・銚子方面
            { c: [{ x: 5, y: 2 }, { x: 6, y: 2 }], l: 1 },
            { c: [{ x: 6, y: 1 }, { x: 6, y: 2 }], l: 1 },
            { c: [{ x: 6, y: 1 }, { x: 7, y: 1 }], l: 1 },
            { c: [{ x: 7, y: 0 }, { x: 7, y: 1 }], l: 1 },
            { c: [{ x: 8, y: 1 }, { x: 8, y: 2 }], l: 1 },
            { c: [{ x: 8, y: 2 }, { x: 9, y: 2 }], l: 1 },
            { c: [{ x: 9, y: 2 }, { x: 10, y: 2 }], l: 1 },
            { c: [{ x: 10, y: 1 }, { x: 10, y: 2 }], l: 1 },
            { c: [{ x: 10, y: 1 }, { x: 11, y: 1 }], l: 1 },
            { c: [{ x: 11, y: 1 }, { x: 12, y: 1 }], l: 1 },
            { c: [{ x: 12, y: 1 }, { x: 13, y: 1 }], l: 1 },
            { c: [{ x: 13, y: 1 }, { x: 14, y: 1 }], l: 1 },
            { c: [{ x: 14, y: 1 }, { x: 15, y: 1 }], l: 1 },
            { c: [{ x: 15, y: 1 }, { x: 16, y: 1 }], l: 1 },

            { c: [{ x: 8, y: 0 }, { x: 8, y: 1 }], l: 1 }, //佐倉～成田方面
            { c: [{ x: 7, y: 0 }, { x: 8, y: 0 }], l: 1 },
            { c: [{ x: 8, y: 0 }, { x: 9, y: 0 }], l: 1 },
            { c: [{ x: 9, y: -1 }, { x: 9, y: 0 }], l: 1 },
            { c: [{ x: 9, y: -1 }, { x: 10, y: -1 }], l: 1 },
            { c: [{ x: 10, y: -1 }, { x: 11, y: -1 }], l: 1 },
            { c: [{ x: 11, y: -1 }, { x: 12, y: -1 }], l: 1 },
            { c: [{ x: 12, y: -1 }, { x: 12, y: 0 }], l: 1 },
            { c: [{ x: 12, y: 0 }, { x: 13, y: 0 }], l: 1 },
            { c: [{ x: 13, y: 0 }, { x: 14, y: 0 }], l: 1 },
            { c: [{ x: 14, y: 0 }, { x: 14, y: 1 }], l: 1 },
            //東金線
            { c: [{ x: 8, y: 3 }, { x: 9, y: 3 }], l: 1 },
            { c: [{ x: 9, y: 2 }, { x: 9, y: 3 }], l: 1 },
            //九十九里鉄道（東金～(上総)片貝)
            { c: [{ x: 9, y: 3 }, { x: 10, y: 3 }], l: 1 },
            //京成
            { c: [{ x: 5, y: 0 }, { x: 6, y: 0 }], l: 1 },
            { c: [{ x: 6, y: 0 }, { x: 7, y: 0 }], l: 1 },
            //鹿島線
            { c: [{ x: 11, y: -2 }, { x: 11, y: -1 }], l: 1 },
            { c: [{ x: 11, y: -2 }, { x: 12, y: -2 }], l: 1 },
            { c: [{ x: 12, y: -2 }, { x: 13, y: -2 }], l: 1 },
            { c: [{ x: 13, y: -2 }, { x: 13, y: -1 }], l: 1 }, //神栖支線（臨港線）
            //東京湾航路
            { c: [{ x: -2, y: 9 }, { x: -1, y: 9 }], l: 1 },
            { c: [{ x: -1, y: 9 }, { x: 0, y: 9 }], l: 1 },
            { c: [{ x: 0, y: 9 }, { x: 1, y: 9 }], l: 1 },
            { c: [{ x: 1, y: 9 }, { x: 2, y: 9 }], l: 1 },
            //東京港航路
            { c: [{ x: 2, y: 2 }, { x: 2, y: 3 }], l: 1 },
            { c: [{ x: 2, y: 3 }, { x: 2, y: 4 }], l: 1 },
            { c: [{ x: 2, y: 4 }, { x: 2, y: 5 }], l: 1 },
            { c: [{ x: 1, y: 5 }, { x: 2, y: 5 }], l: 1 },
            { c: [{ x: 1, y: 5 }, { x: 1, y: 6 }], l: 1 },
            { c: [{ x: 0, y: 6 }, { x: 1, y: 6 }], l: 1 },
            { c: [{ x: 0, y: 6 }, { x: 0, y: 7 }], l: 1 },
            { c: [{ x: 0, y: 7 }, { x: 0, y: 8 }], l: 1 },
            { c: [{ x: 0, y: 8 }, { x: 0, y: 9 }], l: 1 },
            { c: [{ x: 0, y: 9 }, { x: 0, y: 10 }], l: 1 },
            { c: [{ x: 0, y: 10 }, { x: 0, y: 11 }], l: 1 },
            { c: [{ x: 0, y: 11 }, { x: 0, y: 12 }], l: 1 },
            { c: [{ x: 0, y: 12 }, { x: 0, y: 13 }], l: 1 },
            { c: [{ x: 0, y: 13 }, { x: 0, y: 14 }], l: 1 },
            { c: [{ x: 0, y: 14 }, { x: 0, y: 15 }], l: 1 },
            { c: [{ x: 0, y: 15 }, { x: 0, y: 16 }], l: 1 },
            //東京湾航路・伊豆大島方面
            { c: [{ x: -1, y: 11 }, { x: 0, y: 11 }], l: 1 },
            { c: [{ x: -2, y: 11 }, { x: -1, y: 11 }], l: 1 },
            { c: [{ x: -3, y: 11 }, { x: -2, y: 11 }], l: 1 },
            { c: [{ x: -4, y: 11 }, { x: -3, y: 11 }], l: 1 },
            { c: [{ x: -5, y: 11 }, { x: -4, y: 11 }], l: 1 },
            { c: [{ x: -5, y: 11 }, { x: -5, y: 12 }], l: 1 },
            { c: [{ x: -6, y: 12 }, { x: -5, y: 12 }], l: 1 },
            { c: [{ x: -6, y: 12 }, { x: -6, y: 13 }], l: 1 },
            { c: [{ x: -6, y: 13 }, { x: -6, y: 14 }], l: 1 },
            { c: [{ x: -7, y: 14 }, { x: -6, y: 14 }], l: 1 },
            { c: [{ x: -7, y: 14 }, { x: -7, y: 15 }], l: 1 },
            { c: [{ x: -7, y: 15 }, { x: -7, y: 16 }], l: 1 },
            { c: [{ x: -8, y: 16 }, { x: -7, y: 16 }], l: 1 },
            { c: [{ x: -9, y: 16 }, { x: -8, y: 16 }], l: 1 },
            //伊豆諸島・初島航路
            { c: [{ x: -13, y: 11 }, { x: -12, y: 11 }], l: 1 },
            { c: [{ x: -12, y: 11 }, { x: -11, y: 11 }], l: 1 }, //初島支線
            { c: [{ x: -11, y: 11 }, { x: -10, y: 11 }], l: 1 }, //初島支線
            { c: [{ x: -12, y: 11 }, { x: -12, y: 12 }], l: 1 },
            { c: [{ x: -12, y: 12 }, { x: -12, y: 13 }], l: 1 },
            { c: [{ x: -12, y: 13 }, { x: -11, y: 13 }], l: 1 },
            { c: [{ x: -11, y: 13 }, { x: -10, y: 13 }], l: 1 },
            { c: [{ x: -10, y: 13 }, { x: -10, y: 14 }], l: 1 },
            { c: [{ x: -10, y: 14 }, { x: -10, y: 15 }], l: 1 },
            { c: [{ x: -10, y: 15 }, { x: -9, y: 15 }], l: 1 },
            { c: [{ x: -9, y: 15 }, { x: -9, y: 16 }], l: 1 },
            { c: [{ x: -9, y: 16 }, { x: -9, y: 17 }], l: 1 },
            { c: [{ x: -9, y: 17 }, { x: -8, y: 17 }], l: 1 }, //伊豆大島支線
            { c: [{ x: -9, y: 17 }, { x: -9, y: 18 }], l: 1 },
            { c: [{ x: -9, y: 18 }, { x: -9, y: 19 }], l: 1 },
            { c: [{ x: -9, y: 19 }, { x: -9, y: 20 }], l: 1 },
            { c: [{ x: -9, y: 20 }, { x: -8, y: 20 }], l: 1 }, //利島支線
            { c: [{ x: -9, y: 20 }, { x: -9, y: 21 }], l: 1 },
            { c: [{ x: -9, y: 21 }, { x: -9, y: 22 }], l: 1 },

            { c: [{ x: -11, y: 22 }, { x: -10, y: 22 }], l: 1 }, //式根島付近。
            { c: [{ x: -10, y: 22 }, { x: -9, y: 22 }], l: 1 },
            { c: [{ x: -9, y: 22 }, { x: -8, y: 22 }], l: 1 },

            { c: [{ x: -10, y: 22 }, { x: -10, y: 23 }], l: 1 },
            { c: [{ x: -11, y: 23 }, { x: -10, y: 23 }], l: 1 },
            { c: [{ x: -11, y: 23 }, { x: -11, y: 24 }], l: 1 },
            { c: [{ x: -11, y: 24 }, { x: -11, y: 25 }], l: 1 },
            { c: [{ x: -11, y: 25 }, { x: -10, y: 25 }], l: 1 },
            //下田からの航路
            { c: [{ x: -16, y: 19 }, { x: -15, y: 19 }], l: 1 }, //利島方面
            { c: [{ x: -15, y: 19 }, { x: -14, y: 19 }], l: 1 },
            { c: [{ x: -14, y: 19 }, { x: -13, y: 19 }], l: 1 },
            { c: [{ x: -13, y: 19 }, { x: -12, y: 19 }], l: 1 },
            { c: [{ x: -12, y: 19 }, { x: -12, y: 20 }], l: 1 },
            { c: [{ x: -12, y: 20 }, { x: -11, y: 20 }], l: 1 },
            { c: [{ x: -11, y: 20 }, { x: -10, y: 20 }], l: 1 },
            { c: [{ x: -10, y: 20 }, { x: -9, y: 20 }], l: 1 },

            { c: [{ x: -16, y: 19 }, { x: -16, y: 20 }], l: 1 }, //神津島方面
            { c: [{ x: -16, y: 20 }, { x: -16, y: 21 }], l: 1 },
            { c: [{ x: -16, y: 21 }, { x: -15, y: 21 }], l: 1 },
            { c: [{ x: -15, y: 21 }, { x: -15, y: 22 }], l: 1 },
            { c: [{ x: -15, y: 22 }, { x: -14, y: 22 }], l: 1 },
            { c: [{ x: -14, y: 22 }, { x: -14, y: 23 }], l: 1 },
            { c: [{ x: -14, y: 23 }, { x: -13, y: 23 }], l: 1 },
            { c: [{ x: -13, y: 23 }, { x: -13, y: 24 }], l: 1 },
            { c: [{ x: -13, y: 24 }, { x: -12, y: 24 }], l: 1 },
            { c: [{ x: -12, y: 24 }, { x: -11, y: 24 }], l: 1 },
            //お台場とか
            { c: [{ x: 2, y: 0 }, { x: 2, y: 1 }], l: 1 },
            { c: [{ x: 2, y: 1 }, { x: 2, y: 2 }], l: 1 },
            { c: [{ x: 1, y: 2 }, { x: 2, y: 2 }], l: 1 },
            { c: [{ x: 0, y: 2 }, { x: 1, y: 2 }], l: 1 },
            //伊豆半島
            { c: [{ x: -15, y: 11 }, { x: -15, y: 12 }], l: 1 },
            { c: [{ x: -15, y: 12 }, { x: -14, y: 12 }], l: 1 },
            { c: [{ x: -14, y: 12 }, { x: -14, y: 13 }], l: 1 },
            { c: [{ x: -14, y: 13 }, { x: -13, y: 13 }], l: 1 },
            { c: [{ x: -13, y: 13 }, { x: -13, y: 14 }], l: 1 },
            { c: [{ x: -13, y: 14 }, { x: -13, y: 15 }], l: 1 },
            { c: [{ x: -14, y: 15 }, { x: -13, y: 15 }], l: 1 },
            { c: [{ x: -14, y: 15 }, { x: -14, y: 16 }], l: 1 },
            { c: [{ x: -14, y: 16 }, { x: -14, y: 17 }], l: 1 },
            { c: [{ x: -15, y: 17 }, { x: -14, y: 17 }], l: 1 },
            { c: [{ x: -16, y: 17 }, { x: -15, y: 17 }], l: 1 },
            { c: [{ x: -16, y: 17 }, { x: -16, y: 18 }], l: 1 },
            { c: [{ x: -16, y: 18 }, { x: -16, y: 19 }], l: 1 },
        ];
        let block = [ //cはcolor
            { x: 2.3, y: 0.3, kind: 'square', w: 1.4, h: 2.2, c: 'sea' },
            { x: 1.3, y: 2.3, kind: 'square', w: 2.4, h: 3.4, c: 'sea' },
            { x: -1.7, y: 4.3, kind: 'square', w: 4.4, h: 20.2, c: 'sea' },
            { x: -12.7, y: 12.3, kind: 'square', w: 36, h: 14.2, c: 'sea' }, //南の海
            { x: 3.3, y: 3.3, kind: 'square', w: 1.4, h: 1.4, c: 'sea' },
            { x: -2.7, y: 5.3, kind: 'square', w: 1.4, h: 2.4, c: 'sea' },
            { x: -2.7, y: 9.3, kind: 'square', w: 2, h: 3.2, c: 'sea' }, //三浦半島久里浜周辺
            { x: -3.7, y: 10.3, kind: 'square', w: 1.4, h: 2.2, c: 'sea' }, //三浦半島南端
            { x: -4.7, y: 9.3, kind: 'square', w: 1.2, h: 3.2, c: 'sea' }, //三浦半島西海岸周辺
            { x: -5.7, y: 8.3, kind: 'square', w: 1.4, h: 4.2, c: 'sea' },
            { x: -11.7, y: 7.3, kind: 'square', w: 6.4, h: 6.2, c: 'sea' }, //相模湾
            { x: -12.7, y: 8.3, kind: 'square', w: 1.4, h: 5.2, c: 'sea' }, //相模湾


            { x: 4.6, y: 11.3, kind: 'square', w: 1.2, h: 1.2, c: 'sea' }, //房総半島沿岸(外房)
            { x: 5.3, y: 10.3, kind: 'square', w: 4.4, h: 2.2, c: 'sea' }, //房総半島沿岸(外房)
            { x: 6.3, y: 8.3, kind: 'square', w: 3.4, h: 3.2, c: 'sea' }, //房総半島沿岸(外房)
            { x: 8.3, y: 7.3, kind: 'square', w: 1.4, h: 1.2, c: 'sea' }, //房総半島沿岸(外房)
            { x: 9.3, y: 3.3, kind: 'square', w: 14.4, h: 13.2, c: 'sea' }, //房総半島沿岸(外房) //九十九里浜
            { x: 10.3, y: 2.3, kind: 'square', w: 13.4, h: 1.2, c: 'sea' }, //房総半島沿岸(外房)
            { x: 13.5, y: 1.3, kind: 'square', w: 10.2, h: 13.2, c: 'sea' }, //房総半島沿岸(外房) //九十九里浜
            { x: 16.3, y: 0.3, kind: 'square', w: 7.4, h: 1.2, c: 'sea' }, //房総半島沿岸(外房)
            { x: 14.3, y: -0.5, kind: 'square', w: 9.4, h: 1.2, c: 'sea' }, //房総半島沿岸(外房)
            { x: 13.3, y: -2.5, kind: 'square', w: 10.4, h: 2.2, c: 'sea' }, //房総半島沿岸(外房)
            //伊豆半島東岸
            { x: -13.7, y: 11.25, kind: 'square', w: 1.4, h: 1.5, c: 'sea' }, //熱海付近
            { x: -13.7, y: 15.3, kind: 'square', w: 1.4, h: 2.2, c: 'sea' }, //伊豆熱川付近
            { x: -15.7, y: 17.3, kind: 'square', w: 3.4, h: 2.2, c: 'sea' }, //下田付近


            { x: -20.7, y: 19.3, kind: 'square', w: 8.4, h: 16.2, c: 'sea' }, //南の海(下田付近)

            { x: -11.3, y: 10.6, kind: 'square', w: 1.6, h: 0.8, c: 'land' }, //初島
            { x: -9.3, y: 16.6, kind: 'square', w: 1.6, h: 0.8, c: 'land' }, //大島
            { x: -9.3, y: 19.6, kind: 'square', w: 1.6, h: 0.8, c: 'land' }, //利島
            { x: -9.3, y: 21.6, kind: 'square', w: 1.6, h: 0.8, c: 'land' }, //新島
            { x: -11.3, y: 21.6, kind: 'square', w:1.6, h: 0.8, c: 'land' }, //式根島
            { x: -11.3, y: 24.6, kind: 'square', w:1.6, h: 0.8, c: 'land' }, //神津島
        ];
        for (let i18 = 0; i18 < block.length; i18++) block[i18].order = i18;
        let svg = { make: {} };
        svg.make.ship = function (color) {
            //return '<?xml version="1.0"?><svg width="688" height="423" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xml:space="preserve"><g class="layer"><g fill="'+color+'"><path d="m561.87,190.8c-3.37,-5.63 -9.45,-9.08 -16.02,-9.06l-10.95,0l-34.89,-52.86c-5.66,-5.15 -13.12,-7.86 -20.76,-7.56l-163.73,0l-28.33,-75.52l-107.61,0l0,75.52l-58.53,0c-13.59,0 -24.55,7.56 -24.55,16.39l0,44.03l-3.77,0c-10.27,0.04 -18.58,8.38 -18.58,18.65l0,49.32l522.98,0l-35.26,-58.91zm-412.5,28.7c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.18,0 -7.56,-3.38 -7.56,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.56,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55zm60.42,0c0,4.17 -3.38,7.55 -7.56,7.55l-7.55,0c-4.17,0 -7.55,-3.38 -7.55,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.55,-7.55l7.55,0c4.18,0 7.56,3.38 7.56,7.55l0,7.55zm60.41,0c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.17,0 -7.55,-3.38 -7.55,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.55,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55zm60.42,0c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.17,0 -7.56,-3.38 -7.56,-7.55l0,-7.55c0,-4.17 3.39,-7.55 7.56,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55zm60.42,0c0,4.17 -3.39,7.55 -7.56,7.55l-7.55,0c-4.17,0 -7.55,-3.38 -7.55,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.55,-7.55l7.55,0c4.17,0 7.56,3.38 7.56,7.55l0,7.55zm60.41,0c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.17,0 -7.55,-3.38 -7.55,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.55,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55zm60.42,0c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.17,0 -7.56,-3.38 -7.56,-7.55l0,-7.55c0,-4.17 3.39,-7.55 7.56,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55z" id="svg_2"/><path d="m281.53,30.7l-7.55,-19.94c-2.36,-6.27 -8.41,-10.38 -15.1,-10.27l-79.3,0l0,30.21l101.95,0z" id="svg_3"/><path d="m675.6,272.37l-659.75,0c-7.51,-0.09 -13.66,5.93 -13.75,13.44c0,0.02 0,0.05 0,0.07l30.21,124.01c0.04,7.42 6.03,13.43 13.45,13.52l503.49,0c3.65,0 7.15,-1.44 9.75,-4.01l126.27,-124c5.29,-5.2 5.37,-13.71 0.17,-19.01c-2.59,-2.64 -6.15,-4.09 -9.84,-4.02zm-548.89,84.35c0,3.46 -2.8,6.27 -6.27,6.27l-25.22,0c-3.46,0 -6.27,-2.81 -6.27,-6.27l0,-25.22c0.04,-3.45 2.83,-6.23 6.27,-6.27l25.22,0c3.47,0 6.27,2.81 6.27,6.27l0,25.22zm83.08,0c0,3.46 -2.81,6.27 -6.27,6.27l-25.23,0c-3.46,0 -6.26,-2.81 -6.26,-6.27l0,-25.22c0.04,-3.45 2.82,-6.23 6.26,-6.27l25.23,0c3.46,0 6.27,2.81 6.27,6.27l0,25.22zm83.07,0c0,3.46 -2.81,6.27 -6.27,6.27l-25.22,0c-3.47,0 -6.27,-2.81 -6.27,-6.27l0,-25.22c0.04,-3.45 2.82,-6.23 6.27,-6.27l25.22,0c3.46,0 6.27,2.81 6.27,6.27l0,25.22zm83.07,0c0,3.46 -2.8,6.27 -6.27,6.27l-25.22,0c-3.46,0 -6.27,-2.81 -6.27,-6.27l0,-25.22c0.04,-3.45 2.83,-6.23 6.27,-6.27l25.22,0c3.47,0 6.27,2.81 6.27,6.27l0,25.22zm83.07,0c0,3.46 -2.8,6.27 -6.26,6.27l-25.23,0c-3.46,0 -6.26,-2.81 -6.26,-6.27l0,-25.22c0.04,-3.45 2.82,-6.23 6.26,-6.27l25.23,0c3.46,0 6.26,2.81 6.26,6.27l0,25.22zm83.08,0c0,3.46 -2.81,6.27 -6.27,6.27l-25.22,0c-3.47,0 -6.27,-2.81 -6.27,-6.27l0,-25.22c0.04,-3.45 2.82,-6.23 6.27,-6.27l25.22,0c3.46,0 6.27,2.81 6.27,6.27l0,25.22z" id="svg_4"/></g></g></svg>';
            //<svg width="688" height="423" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xml:space="preserve"><g class="layer"><g><path d="m560.87,190.8c-3.37,-5.63 -9.45,-9.08 -16.02,-9.06l-10.95,0l-34.89,-52.86c-5.66,-5.15 -13.12,-7.86 -20.76,-7.56l-163.73,0l-28.33,-75.52l-107.61,0l0,75.52l-58.53,0c-13.59,0 -24.55,7.56 -24.55,16.39l0,44.03l-3.77,0c-10.27,0.04 -18.58,8.38 -18.58,18.65l0,49.32l522.98,0l-35.26,-58.91zm-412.5,28.7c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.18,0 -7.56,-3.38 -7.56,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.56,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55zm60.42,0c0,4.17 -3.38,7.55 -7.56,7.55l-7.55,0c-4.17,0 -7.55,-3.38 -7.55,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.55,-7.55l7.55,0c4.18,0 7.56,3.38 7.56,7.55l0,7.55zm60.41,0c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.17,0 -7.55,-3.38 -7.55,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.55,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55zm60.42,0c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.17,0 -7.56,-3.38 -7.56,-7.55l0,-7.55c0,-4.17 3.39,-7.55 7.56,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55zm60.42,0c0,4.17 -3.39,7.55 -7.56,7.55l-7.55,0c-4.17,0 -7.55,-3.38 -7.55,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.55,-7.55l7.55,0c4.17,0 7.56,3.38 7.56,7.55l0,7.55zm60.41,0c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.17,0 -7.55,-3.38 -7.55,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.55,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55zm60.42,0c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.17,0 -7.56,-3.38 -7.56,-7.55l0,-7.55c0,-4.17 3.39,-7.55 7.56,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55z" fill="#ffffff" stroke="#000000" stroke-width="11"/><path d="m280.53,30.7l-7.55,-19.94c-2.36,-6.27 -8.41,-10.38 -15.1,-10.27l-79.3,0l0,30.21l101.95,0z" fill="#ffffff" stroke="#000000" stroke-width="11"/><path d="m674.6,272.37l-659.75,0c-7.51,-0.09 -13.66,5.93 -13.75,13.44c0,0.02 0,0.05 0,0.07l30.21,124.01c0.04,7.42 6.03,13.43 13.45,13.52l503.49,0c3.65,0 7.15,-1.44 9.75,-4.01l126.27,-124c5.29,-5.2 5.37,-13.71 0.17,-19.01c-2.59,-2.64 -6.15,-4.09 -9.84,-4.02zm-548.89,84.35c0,3.46 -2.8,6.27 -6.27,6.27l-25.22,0c-3.46,0 -6.27,-2.81 -6.27,-6.27l0,-25.22c0.04,-3.45 2.83,-6.23 6.27,-6.27l25.22,0c3.47,0 6.27,2.81 6.27,6.27l0,25.22zm83.08,0c0,3.46 -2.81,6.27 -6.27,6.27l-25.23,0c-3.46,0 -6.26,-2.81 -6.26,-6.27l0,-25.22c0.04,-3.45 2.82,-6.23 6.26,-6.27l25.23,0c3.46,0 6.27,2.81 6.27,6.27l0,25.22zm83.07,0c0,3.46 -2.81,6.27 -6.27,6.27l-25.22,0c-3.47,0 -6.27,-2.81 -6.27,-6.27l0,-25.22c0.04,-3.45 2.82,-6.23 6.27,-6.27l25.22,0c3.46,0 6.27,2.81 6.27,6.27l0,25.22zm83.07,0c0,3.46 -2.8,6.27 -6.27,6.27l-25.22,0c-3.46,0 -6.27,-2.81 -6.27,-6.27l0,-25.22c0.04,-3.45 2.83,-6.23 6.27,-6.27l25.22,0c3.47,0 6.27,2.81 6.27,6.27l0,25.22zm83.07,0c0,3.46 -2.8,6.27 -6.26,6.27l-25.23,0c-3.46,0 -6.26,-2.81 -6.26,-6.27l0,-25.22c0.04,-3.45 2.82,-6.23 6.26,-6.27l25.23,0c3.46,0 6.26,2.81 6.26,6.27l0,25.22zm83.08,0c0,3.46 -2.81,6.27 -6.27,6.27l-25.22,0c-3.47,0 -6.27,-2.81 -6.27,-6.27l0,-25.22c0.04,-3.45 2.82,-6.23 6.27,-6.27l25.22,0c3.46,0 6.27,2.81 6.27,6.27l0,25.22z" fill="#ffffff"stroke="#000000" stroke-width="11"/></g></g></svg>
            //return 'data:image/svg+xml;base64,' + window.btoa(window.unescape(encodeURIComponent('<?xml version="1.0"?><svg width="688" height="423" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xml:space="preserve"><g class="layer"><g fill="' + color + '"><path d="m561.87,190.8c-3.37,-5.63 -9.45,-9.08 -16.02,-9.06l-10.95,0l-34.89,-52.86c-5.66,-5.15 -13.12,-7.86 -20.76,-7.56l-163.73,0l-28.33,-75.52l-107.61,0l0,75.52l-58.53,0c-13.59,0 -24.55,7.56 -24.55,16.39l0,44.03l-3.77,0c-10.27,0.04 -18.58,8.38 -18.58,18.65l0,49.32l522.98,0l-35.26,-58.91zm-412.5,28.7c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.18,0 -7.56,-3.38 -7.56,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.56,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55zm60.42,0c0,4.17 -3.38,7.55 -7.56,7.55l-7.55,0c-4.17,0 -7.55,-3.38 -7.55,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.55,-7.55l7.55,0c4.18,0 7.56,3.38 7.56,7.55l0,7.55zm60.41,0c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.17,0 -7.55,-3.38 -7.55,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.55,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55zm60.42,0c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.17,0 -7.56,-3.38 -7.56,-7.55l0,-7.55c0,-4.17 3.39,-7.55 7.56,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55zm60.42,0c0,4.17 -3.39,7.55 -7.56,7.55l-7.55,0c-4.17,0 -7.55,-3.38 -7.55,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.55,-7.55l7.55,0c4.17,0 7.56,3.38 7.56,7.55l0,7.55zm60.41,0c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.17,0 -7.55,-3.38 -7.55,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.55,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55zm60.42,0c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.17,0 -7.56,-3.38 -7.56,-7.55l0,-7.55c0,-4.17 3.39,-7.55 7.56,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55z" id="svg_2"/><path d="m281.53,30.7l-7.55,-19.94c-2.36,-6.27 -8.41,-10.38 -15.1,-10.27l-79.3,0l0,30.21l101.95,0z" id="svg_3"/><path d="m675.6,272.37l-659.75,0c-7.51,-0.09 -13.66,5.93 -13.75,13.44c0,0.02 0,0.05 0,0.07l30.21,124.01c0.04,7.42 6.03,13.43 13.45,13.52l503.49,0c3.65,0 7.15,-1.44 9.75,-4.01l126.27,-124c5.29,-5.2 5.37,-13.71 0.17,-19.01c-2.59,-2.64 -6.15,-4.09 -9.84,-4.02zm-548.89,84.35c0,3.46 -2.8,6.27 -6.27,6.27l-25.22,0c-3.46,0 -6.27,-2.81 -6.27,-6.27l0,-25.22c0.04,-3.45 2.83,-6.23 6.27,-6.27l25.22,0c3.47,0 6.27,2.81 6.27,6.27l0,25.22zm83.08,0c0,3.46 -2.81,6.27 -6.27,6.27l-25.23,0c-3.46,0 -6.26,-2.81 -6.26,-6.27l0,-25.22c0.04,-3.45 2.82,-6.23 6.26,-6.27l25.23,0c3.46,0 6.27,2.81 6.27,6.27l0,25.22zm83.07,0c0,3.46 -2.81,6.27 -6.27,6.27l-25.22,0c-3.47,0 -6.27,-2.81 -6.27,-6.27l0,-25.22c0.04,-3.45 2.82,-6.23 6.27,-6.27l25.22,0c3.46,0 6.27,2.81 6.27,6.27l0,25.22zm83.07,0c0,3.46 -2.8,6.27 -6.27,6.27l-25.22,0c-3.46,0 -6.27,-2.81 -6.27,-6.27l0,-25.22c0.04,-3.45 2.83,-6.23 6.27,-6.27l25.22,0c3.47,0 6.27,2.81 6.27,6.27l0,25.22zm83.07,0c0,3.46 -2.8,6.27 -6.26,6.27l-25.23,0c-3.46,0 -6.26,-2.81 -6.26,-6.27l0,-25.22c0.04,-3.45 2.82,-6.23 6.26,-6.27l25.23,0c3.46,0 6.26,2.81 6.26,6.27l0,25.22zm83.08,0c0,3.46 -2.81,6.27 -6.27,6.27l-25.22,0c-3.47,0 -6.27,-2.81 -6.27,-6.27l0,-25.22c0.04,-3.45 2.82,-6.23 6.27,-6.27l25.22,0c3.46,0 6.27,2.81 6.27,6.27l0,25.22z" id="svg_4"/></g></g></svg>')));
            return 'data:image/svg+xml;base64,' + window.btoa(window.unescape(encodeURIComponent('<?xml version="1.0"?><svg width="688" height="423" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xml:space="preserve"><g class="layer"><g fill="white" stroke="' + color + '" stroke-width="18"><path d="m561.87,190.8c-3.37,-5.63 -9.45,-9.08 -16.02,-9.06l-10.95,0l-34.89,-52.86c-5.66,-5.15 -13.12,-7.86 -20.76,-7.56l-163.73,0l-28.33,-75.52l-107.61,0l0,75.52l-58.53,0c-13.59,0 -24.55,7.56 -24.55,16.39l0,44.03l-3.77,0c-10.27,0.04 -18.58,8.38 -18.58,18.65l0,49.32l522.98,0l-35.26,-58.91zm-412.5,28.7c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.18,0 -7.56,-3.38 -7.56,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.56,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55zm60.42,0c0,4.17 -3.38,7.55 -7.56,7.55l-7.55,0c-4.17,0 -7.55,-3.38 -7.55,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.55,-7.55l7.55,0c4.18,0 7.56,3.38 7.56,7.55l0,7.55zm60.41,0c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.17,0 -7.55,-3.38 -7.55,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.55,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55zm60.42,0c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.17,0 -7.56,-3.38 -7.56,-7.55l0,-7.55c0,-4.17 3.39,-7.55 7.56,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55zm60.42,0c0,4.17 -3.39,7.55 -7.56,7.55l-7.55,0c-4.17,0 -7.55,-3.38 -7.55,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.55,-7.55l7.55,0c4.17,0 7.56,3.38 7.56,7.55l0,7.55zm60.41,0c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.17,0 -7.55,-3.38 -7.55,-7.55l0,-7.55c0,-4.17 3.38,-7.55 7.55,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55zm60.42,0c0,4.17 -3.38,7.55 -7.55,7.55l-7.55,0c-4.17,0 -7.56,-3.38 -7.56,-7.55l0,-7.55c0,-4.17 3.39,-7.55 7.56,-7.55l7.55,0c4.17,0 7.55,3.38 7.55,7.55l0,7.55z" id="svg_2"/><path d="m281.53,30.7l-7.55,-19.94c-2.36,-6.27 -8.41,-10.38 -15.1,-10.27l-79.3,0l0,30.21l101.95,0z" id="svg_3"/><path d="m675.6,272.37l-659.75,0c-7.51,-0.09 -13.66,5.93 -13.75,13.44c0,0.02 0,0.05 0,0.07l30.21,124.01c0.04,7.42 6.03,13.43 13.45,13.52l503.49,0c3.65,0 7.15,-1.44 9.75,-4.01l126.27,-124c5.29,-5.2 5.37,-13.71 0.17,-19.01c-2.59,-2.64 -6.15,-4.09 -9.84,-4.02zm-548.89,84.35c0,3.46 -2.8,6.27 -6.27,6.27l-25.22,0c-3.46,0 -6.27,-2.81 -6.27,-6.27l0,-25.22c0.04,-3.45 2.83,-6.23 6.27,-6.27l25.22,0c3.47,0 6.27,2.81 6.27,6.27l0,25.22zm83.08,0c0,3.46 -2.81,6.27 -6.27,6.27l-25.23,0c-3.46,0 -6.26,-2.81 -6.26,-6.27l0,-25.22c0.04,-3.45 2.82,-6.23 6.26,-6.27l25.23,0c3.46,0 6.27,2.81 6.27,6.27l0,25.22zm83.07,0c0,3.46 -2.81,6.27 -6.27,6.27l-25.22,0c-3.47,0 -6.27,-2.81 -6.27,-6.27l0,-25.22c0.04,-3.45 2.82,-6.23 6.27,-6.27l25.22,0c3.46,0 6.27,2.81 6.27,6.27l0,25.22zm83.07,0c0,3.46 -2.8,6.27 -6.27,6.27l-25.22,0c-3.46,0 -6.27,-2.81 -6.27,-6.27l0,-25.22c0.04,-3.45 2.83,-6.23 6.27,-6.27l25.22,0c3.47,0 6.27,2.81 6.27,6.27l0,25.22zm83.07,0c0,3.46 -2.8,6.27 -6.26,6.27l-25.23,0c-3.46,0 -6.26,-2.81 -6.26,-6.27l0,-25.22c0.04,-3.45 2.82,-6.23 6.26,-6.27l25.23,0c3.46,0 6.26,2.81 6.26,6.27l0,25.22zm83.08,0c0,3.46 -2.81,6.27 -6.27,6.27l-25.22,0c-3.47,0 -6.27,-2.81 -6.27,-6.27l0,-25.22c0.04,-3.45 2.82,-6.23 6.27,-6.27l25.22,0c3.46,0 6.27,2.81 6.27,6.27l0,25.22z" id="svg_4"/></g></g></svg>')));
        }
        let player = [
            //{ x: x座標, y: y座標, d:今向いてる方向, n:名前, m:所持金(money),color:コーポレートカラー,card:持っているカード[カード名,使用可能回数]}
            { x: 0, y: 0, n: 'はてな社長', d: 's', m: 10000, point: 0, color: '#33CCFF', card: [['急行カード', 1], ['急行周遊カード', 6], ['ぶっとびカード', 1], ['急行カード', 1], ['急行カード', 1], ['急行カード', 1], ['急行カード', 1], ['急行カード', 1],], },
            { x: 0, y: 0, n: 'はてな２社長', d: 's', m: 10000, point: 0, color: '#EE3333', card: [['急行カード', 1], ['急行周遊カード', 6], ['ぶっとびカード', 1]], },
            //{ x: 0, y: 0, n: '?2社長', m: 100, color: 'red', card: [], }//2COM
        ];
        let card = { list: [], f: {}, mode: 'buy', set: [], point: 0, max: 8, selectmode: 'use' }; //ここのpointは一時的にポイントを保管するところmaxは最大所持枚数。
        card.list = [
            //{n:カード名,k:種類,t:回数(timesより),v:定価(valueより),e:説明(explainより)}
            { n: '急行カード', t: 1, k: 'express,2', v: 400, e: 'サイコロを2個振って、出た目の合計だけ進めます。' },
            { n: '急行周遊カード', t: 6, k: 'express,2', v: 8000, e: 'サイコロを2個振って、出た目の合計だけ進めます。\n何回か使えます。' },
            { n: '快急カード', t: 1, k: 'express,3', v: 4000, e: 'サイコロを3個振って、出た目の合計だけ進めます。' },
            { n: '快急周遊カード', t: 6, k: 'express,3', v: 30000, e: 'サイコロを3個振って、出た目の合計だけ進めます。\n何回か使えます。' },
            { n: '特急カード', t: 1, k: 'express,4', v: 7000, e: 'サイコロを4個振って、出た目の合計だけ進めます。' },
            { n: '特急周遊カード', t: 6, k: 'express,4', v: 50000, e: 'サイコロを4個振って、出た目の合計だけ進めます。\n何回か使えます。' },
            { n: '特急(特別車)カード', t: 1, k: 'express,4', v: 60000, e: 'サイコロを4個振って、出た目の合計だけ進めます。\n通常より売値が高いです。' }, //売値が高いだけの代物
            { n: '快特カード', t: 1, k: 'express,5', v: 12000, e: 'サイコロを5個振って、出た目の合計だけ進めます。' },
            { n: '快特(特別車)カード', t: 1, k: 'express,5', v: 50000, e: 'サイコロを5個振って、出た目の合計だけ進めます。\n通常より売値が高いです。' }, //売値が高いだけの代物
            { n: '快特周遊カード', t: 6, k: 'express,5', v: 100000, e: 'サイコロを5個振って、出た目の合計だけ進めます。\n何回か使えます。' },
            { n: '新幹線カード', t: 1, k: 'express,6', v: 20000, e: 'サイコロを6個振って、出た目の合計だけ進めます。' },
            { n: '新幹線周遊カード', t: 6, k: 'express,6', v: 80000, e: 'サイコロを6個振って、出た目の合計だけ進めます。\n何回か使えます。' },
            { n: '新幹線(グリーン車)カード', t: 1, k: 'express,6', v: 90000, e: 'サイコロを6個振って、出た目の合計だけ進めます。\n通常より売値が高いです。' }, //売値が高いだけの代物
            { n: 'はやぶさカード', t: 1, k: 'express,7', v: 30000, e: 'サイコロを7個振って、出た目の合計だけ進めます。' },
            { n: 'はやぶさ周遊カード', t: 6, k: 'express,7', v: 140000, e: 'サイコロを7個振って、出た目の合計だけ進めます。\n何回か使えます。' },
            { n: 'はやぶさ(グランクラス)カード', t: 1, k: 'express,7', v: 150000, e: 'サイコロを7個振って、出た目の合計だけ進めます。\n通常より売値が高いです。' }, //売値が高いだけの代物
            { n: 'リニアカード', t: 1, k: 'express,8', v: 40000, e: 'サイコロを8個振って、出た目の合計だけ進めます。' },
            { n: 'リニア周遊カード', t: 6, k: 'express,8', v: 200000, e: 'サイコロを8個振って、出た目の合計だけ進めます。\n何回か使えます。' },
            { n: 'ぶっとびカード', t: 1, k: 'buttobi', v: 5000, e: 'どこかにぶっとびます！' },
            { n: '乗っ取りカード', t: 1, k: 'steal', v: 10000, e: 'ほかの社長の物件を乗っ取ります。' },
            { n: '徳政令カード', t: 1, k: 'tokuseirei', v: 0, e: '全ての社長の借金をゼロにします！◎' },
            { n: '10億円カード', t: 1, k: '10okuen', v: 400, e: 'その名の通り10億円が手に入ります！◎' },
            { n: '一頭地を抜くカード', t: 1, k: 'ittouchiwonuku', v: 10000, e: '最も持ち金が多い人の持ち金プラス数億円が手に入ります！' },
        ];
        card.f.use = function (value) {
            if (player[now.player].card[value][0] == '徳政令カード') {
                for (let i16 = 0; i16 < player.length; i16++) {
                    if (player[i16].m < 0) {
                        strings = player[now.player].n + 'は' + player[now.player].card[value][0] + 'を使った！'
                        player[now.player].card[value][1]--;
                        display.s.card = false;
                        display.s.cmd2 = false;
                        now.state = 'tokuseirei,0';
                        temporary.i12 = search.f.card(player[now.player].card[value][0]);
                        if (player[now.player].card[value][1] < 1) {
                            player[now.player].card.splice(value, 1);
                        }
                        break;
                    } else {
                        strings = player[now.player].n + '！誰も借金を背負っておりませんぞ!!';
                        now.state = 'empty';
                    }
                }
            } else if (player[now.player].card[value][0] == '10億円カード') {
                strings = player[now.player].n + 'は10億円カードを使った!';
                player[now.player].card[value][1]--;
                display.s.card = false;
                now.state = '10okuen';
                if (player[now.player].card[value][1] < 1) {
                    player[now.player].card.splice(value, 1);
                }
            } else if (player[now.player].card[value][0] == '一頭地を抜くカード') {
                temporary.i9 = { v: Number.MIN_SAFE_INTEGER, w: '' }; //Number.MIN_SAFE_INTEGERはjsでの最小の数字
                for (let i3 = 0; i3 < player.length; i3++) {
                    if (player[i3].m > temporary.i9.v) {
                        temporary.i9.v = player[i3].m;
                        temporary.i9.w = i3;
                    }
                }
                if (temporary.i9.w == now.player || temporary.i9.v == player[now.player].m) {
                    display.f.txtbox('今一番所持金が多いのは' + player[now.player].n + '、あなたですぞ！', true);
                } else if (temporary.i9.v < 0) {
                    display.f.txtbox('全ての社長の持ち金がマイナスですぞ！', true);
                } else {
                    player[now.player].card[value][1]--;
                    display.s.card = false;
                    display.s.cmd2 = false;
                    display.s.state = false;
                    if (player[now.player].card[value][1] < 1) {
                        player[now.player].card.splice(value, 1);
                    }
                    display.f.txtbox(player[now.player].n + 'は一頭地を抜くカードを使った！', true);
                    now.state = 'usecard3,ittouchiwonuku,0';
                }
            } else if (player[now.player].card[value][0] == '乗っ取りカード') {
                display.f.txtbox('このカードは物件駅でのみ使えますぞ！', true);
            }
            else {
                strings = player[now.player].n + 'は' + player[now.player].card[value][0] + 'を使った！';
                player[now.player].card[value][1]--;
                display.s.card = false;
                display.s.cmd2 = false;
                display.s.state = false;
                temporary.i12 = search.f.card(player[now.player].card[value][0]);
                now.state = 'usecard2,' + temporary.i12.order;
                if (player[now.player].card[value][1] < 1) {
                    player[now.player].card.splice(value, 1);
                }
                now.can.canvas_touch = false;
            }
        }
        card.f.deleteset = function () {
            card.selectmode = 'delete';
            display.s.card = true;
            strings = `${player[now.player].n}!カードを持ちきれません!\nどのカードを捨てますか?`;
        }
        card.f.delete = function (value) {
            strings = `${player[now.player].n}は${player[now.player].card[value][0]}を捨てた!`;
            player[now.player].card.splice(value, 1);
            now.state = 'empty';
        }
        card.set = [ //カード売り場駅での販売組み合わせ
            ['急行カード', '急行周遊カード', '快急カード', '快急周遊カード', '特急カード', '特急周遊カード', 'ぶっとびカード', '徳政令カード'],
            ['急行カード', '急行周遊カード', '快急カード', '特急周遊カード', '快特カード', 'ぶっとびカード', '乗っ取りカード', '徳政令カード'],
        ];
        let moving = { tf: false, auto: { r: [], r2: [], tf: false, } }; //tfはtrue or falseの略
        moving.v = {
            //d:direction(方向),r:range(距離),n:now(いまどれぐらい進んでいるか),to:どこに進むのか
            d: 'e', r: 100, n: 0, to: { x: 0, y: 0 }
        };
        moving.auto.f = function () {
            console.log(player[now.player].x, moving.auto.r[0].x, player[now.player].y, moving.auto.r[0].y);
            console.log(moving.auto.r);
            console.log(moving.auto.r.filter(value => value.x == player[now.player].x && value.y == player[now.player].y));
            /*if (!(player[now.player].x == moving.auto.r[0].x && player[now.player].y == moving.auto.r[0].y && past.coordinate.filter(value => value.x == player[now.player].x && value.y == player[now.player].y).length == 1)) {
                key.f('arrow' + search.f.direction2(search.f.direction({ x: player[now.player].x, y: player[now.player].y }, { x: past.coordinate[past.coordinate.length - 2].x, y: past.coordinate[past.coordinate.length - 2].y })));
            } else {*/
            moving.auto.r.splice(0, 1);
            //console.log(search.f.direction2(search.f.direction({ x: player[now.player].x, y: player[now.player].y }, { x: moving.auto.r[0].x, y: moving.auto.r[0].y })));
            key.f('arrow' + search.f.direction2(search.f.direction({ x: player[now.player].x, y: player[now.player].y }, { x: moving.auto.r[0].x, y: moving.auto.r[0].y })), true);
            //}
        }
        let flying = { tf: false, };
        flying.v = { d: 'e', r: 100, n: { x: 0, y: 0 }, to: { x: 0, y: 0 }, from: { x: 0, y: 0 }, };
        flying.f = function (to) {
            flying.tf = true;
            flying.v.from = { x: player[now.player].x, y: player[now.player].y };
            flying.v.to = { x: to.x, y: to.y };
            flying.v.r = { x: (flying.v.to.x - flying.v.from.x) * s, y: (flying.v.to.y - flying.v.from.y) * s }; //距離       
            flying.v.n = { x: 0, y: 0 };
        }
        let search = { f: { result: {} } };
        search.f.direction = function (from, to) {
            if (from.x == to.x) {
                if (from.y < to.y) return 's';
                else return 'n';
            } else {
                if (from.x < to.x) return 'e';
                else return 'w';
            }
        }
        search.f.direction2 = function (n) { //方角をleftとかに変換
            if (n.charAt(0) == 'n') return 'up';
            else if (n.charAt(0) == 's') return 'down';
            else if (n.charAt(0) == 'e') return 'right';
            else if (n.charAt(0) == 'w') return 'left';
        }
        search.f.card = function (n) { //nはnameのn
            temporary.i11 = { t: '', k: '', order: '', v: 0 };
            for (let i3 = 0; i3 < card.list.length; i3++) {
                if (n == card.list[i3].n) {
                    temporary.i11 = card.list[i3];
                    temporary.i11.order = i3;
                }
            }
            return temporary.i11;
        }
        search.f.coordinate = function (x, y) { //検索システム
            temporary.i23 = box.p.filter(value => value.x == x);
            temporary.i23 = temporary.i23.filter(value => value.y == y);
            if (temporary.i23.length > 0) temporary.i23 = temporary.i23[0];
            else temporary.i23 = {};
            return temporary.i23;
        }
        search.f.line = function (x, y, d, w) {
            //x=> 始点のx座標 y=> 始点のy座標 d=>direction(方向) w=> what(何を) tfだったらあるかどうか、それ以外だったら結果
            search.f.result.line = [];
            for (let i5 = 0; i5 < line.p.length; i5++) {
                if (d.charAt(0) == 'n' && line.p[i5].c[0].x == x && line.p[i5].c[1].x == x && line.p[i5].c[1].y == y && line.p[i5].c[0].y - line.p[i5].c[1].y == -1) {
                    search.f.result.line.push({ x: line.p[i5].c[1].x, y: line.p[i5].c[1].y });
                } else if (d.charAt(0) == 's' && line.p[i5].c[0].x == x && line.p[i5].c[1].x == x && line.p[i5].c[0].y == y && line.p[i5].c[0].y - line.p[i5].c[1].y == -1) {
                    search.f.result.line.push({ x: line.p[i5].c[1].x, y: line.p[i5].c[1].y });
                } else if (d.charAt(0) == 'w' && line.p[i5].c[0].y == y && line.p[i5].c[1].y == y && line.p[i5].c[1].x == x && line.p[i5].c[0].x - line.p[i5].c[1].x == -1) {
                    search.f.result.line.push({ x: line.p[i5].c[1].x, y: line.p[i5].c[1].y });
                } else if (d.charAt(0) == 'e' && line.p[i5].c[0].y == y && line.p[i5].c[1].y == y && line.p[i5].c[0].x == x && line.p[i5].c[0].x - line.p[i5].c[1].x == -1) {
                    search.f.result.line.push({ x: line.p[i5].c[1].x, y: line.p[i5].c[1].y });
                }
            }
            if (w == 'tf' && search.f.result.line.length > 0) return true;
            else if (w == 'tf' && search.f.result.line.length == 0) return false;
            else return search.result.line;
        }
        search.f.where = function (x, y) {
            return block.filter(function (value) {
                return value.x.where('x') <= x && value.y.where('y') <= y && value.x.where('x') + value.w.raito() >= x && value.y.where('y') + value.h.raito() >= y
            });
        }
        Object.prototype.where = function (d) { //this(引火元)には数値、dには方向を入力
            if (d == 'x') return center.x + (this * s + adj.x) * r;
            else if (d == 'y') return center.y + (this * s + adj.y) * r;
        }
        Object.prototype.raito = function () {
            return this * s * r;
        }
        let past = { coordinate: [], mousepoint: { x: '', y: '' } };

        let key = { v: '', v2: '' };
        key.f = function (event, autokey) {
            if (autokey === undefined) autokey = false;
            now.auto = ((autokey == true && moving.auto.tf == true) || (autokey == false && moving.auto.tf == false));
            console.log(event);
            if (event instanceof Object) {
                key.v = event.code.toLowerCase(); //全て小文字にする。要注意。
                key.v2 = event.key.toLowerCase(); //こっちを普段は使用。
            } else { //key
                if (/^key|^arrow/.test(event.toString().substring(0, 3).toLowerCase())) {
                    key.v = event.toLowerCase();
                    key.v2 = event.toLowerCase();
                } else {
                    if (/down$|left$|right$|up$/.test(event.toString().toLowerCase())) {
                        if (event.toString().toLowerCase().substring(0, 5) == 'arrow') key.v = event;
                        else key.v = 'arrow' + event;
                    }
                    else key.v = 'key' + event.toLowerCase();
                    key.v2 = event.toLowerCase();
                }
            }
            if (key.v.substring(0, 5) == 'arrow' && glasses.tf == true) {
                if (key.v == 'arrowup') {
                    center.y += 100;
                } else if (key.v == 'arrowdown') {
                    center.y -= 100;
                } else if (key.v == 'arrowleft') {
                    center.x += 100;
                } else if (key.v == 'arrowright') {
                    center.x -= 100;
                }
            } else if (key.v.substring(0, 5) == "arrow" && moving.tf == false && now.can.move == true) {
                if (now.auto) {
                    if (key.v == 'arrowup') {
                        moving.v.d = 'n'; //nはnorth
                        moving.v.r = -1 * s; //距離          
                        moving.v.to = { x: player[now.player].x, y: player[now.player].y - 1 }; //目的地の座標を入力
                        if (search.f.line(player[now.player].x, player[now.player].y, 'n', 'tf')) moving.tf = true;
                    } else if (key.v == 'arrowdown') {
                        moving.v.d = 's'; //sはsouth
                        moving.v.r = s; //距離          
                        moving.v.to = { x: player[now.player].x, y: player[now.player].y + 1 };
                        if (search.f.line(player[now.player].x, player[now.player].y, moving.v.d, 'tf')) moving.tf = true;
                    } else if (key.v == 'arrowleft') {
                        moving.v.d = 'w'; //wはwest
                        moving.v.r = -1 * s; //距離          
                        moving.v.to = { x: player[now.player].x - 1, y: player[now.player].y };
                    } else if (key.v == 'arrowright') {
                        moving.v.d = 'e'; //eはeast
                        moving.v.r = s; //距離          
                        moving.v.to = { x: player[now.player].x + 1, y: player[now.player].y };
                    }
                    console.log('www' + moving.v.d);
                    player[now.player].d = moving.v.d;
                    moving.v.n = 0;
                    now.can.move_roll--;
                    console.log(now.can.move_roll);
                    if (search.f.line(player[now.player].x, player[now.player].y, moving.v.d, 'tf') == true && now.can.move_roll > -1) {
                        if (past.coordinate.length == 0) {
                            past.coordinate.push({ x: player[now.player].x, y: player[now.player].y });
                            past.coordinate.push({ x: moving.v.to.x, y: moving.v.to.y });
                        } else if (past.coordinate.length == 1) {
                            past.coordinate.push({ x: moving.v.to.x, y: moving.v.to.y });
                        } else {
                            past.coordinate.push({ x: moving.v.to.x, y: moving.v.to.y });
                            console.log(past.coordinate);
                            if (past.coordinate[past.coordinate.length - 3].x == past.coordinate[past.coordinate.length - 1].x && past.coordinate[past.coordinate.length - 3].y == past.coordinate[past.coordinate.length - 1].y) {
                                now.can.move_roll += 2;
                                past.coordinate.splice(past.coordinate.length - 1, 1);
                                past.coordinate.splice(past.coordinate.length - 1, 1);
                            }
                        }
                        if (now.can.move_roll < 1) now.next.arrive = true;
                        moving.tf = true;
                    } else {
                        now.can.move_roll++;
                    }
                }
            } else if (key.v2 == "k") {
                display.f.sta_name();
            } else if (key.v2 == 'enter') {
                enter();
            } else if ((key.v2 == 'glasses' || (key.v2 == 'y' && display.s.glasses == true)) && now.auto == true) {
                glasses.f();
            }
        }
        let use = {};
        use.dice = function () {
            display.s.yn = false;
            now.dice_roll = Math.floor(Math.random() * 6) + 1;
            display.f.txtbox(player[now.player].n + 'はサイコロを振った!\n' + now.dice_roll + 'マス進めますぞ！', true);
            display.s.cmd2 = false;
            display.s.state = false;
            display.s.moving = true; //残りのマスを表示
            now.can.move = true;
            now.can.move_roll = now.dice_roll;
        }
        use.card = function () {
            display.f.txtbox(['none'], true);
            if (player[now.player].card.length > 0) {
                display.s.card = true;
                display.f.bukken(['none'], false); //物件表示の削除
                now.state = 'cardselect';
                strings = 'どのカードを使いますか？';
            } else {
                strings = 'カードを1枚も持ってありませんぞ！';
            }
        }
        let bukken = { mode: 'buy' };
        bukken.buy = function (sta_order, bukken_order) {
            //駅の順番、物件の順番が必要
            if (box.p[sta_order].b[bukken_order].w == 'none') {
                if (player[now.player].m - box.p[sta_order].b[bukken_order].v > -1) {
                    if (yn_strings == 'bukken,buy,' + bukken_order) {
                        yn(true);
                    } else {
                        yn_strings = 'bukken,buy,' + bukken_order;
                        strings = box.p[sta_order].b[bukken_order].n + 'を購入しますか？';
                        display.s.yn = true;
                    }
                } else strings = player[now.player].n + '!お金が足りなくて買えません！！';
            } else if (box.p[sta_order].b[bukken_order].w == now.player) strings = player[now.player].n + '!その物件は我が社のものですぞ!!';
            else strings = player[now.player].n + '!その物件は他社のものです！';
        }
        bukken.buy2 = function (sta_order, bukken_order) {
            box.p[sta_order].b[bukken_order].w = now.player;
            player[now.player].m -= box.p[sta_order].b[bukken_order].v;
            strings = player[now.player].n + 'は' + box.p[sta_order].n + 'の' + box.p[sta_order].b[bukken_order].n + 'を購入した！\n残額は' + money.f(player[now.player].m) + '円！';
        }
        bukken.buyall2 = function (sta_order, kind) {
            temporary.arr.bukken_list = [];
            temporary.total_money = 0;
            for (let i3 = 0; i3 < box.p[sta_order].b.length; i3++) {
                if (player[now.player].m - (temporary.total_money + box.p[sta_order].b[i3].v) > -1) {
                    if (box.p[sta_order].b[i3].w == 'none') {
                        temporary.total_money += box.p[sta_order].b[i3].v;
                        temporary.arr.bukken_list.push(i3);
                        if (kind == 'buy') bukken.buy2(sta_order, i3);
                    }
                } else break;
            }
            return { total_money: temporary.total_money, list: temporary.arr.bukken_list };
        }
        bukken.buyall = function (sta_order) {
            bukken.mode = 'buy';
            temporary.i3 = bukken.buyall2(sta_order, 'look');
            temporary.arr.bukken_list = temporary.i3.list;
            temporary.total_money = temporary.i3.total_money;
            display.s.yn = false;
            if (temporary.arr.bukken_list.length == 0) strings = player[now.player].n + '!1つも物件を買えませんぞ!';
            else {
                strings = '買えるだけ買うと、上から' + temporary.arr.bukken_list.length + 'つの物件を\n' + money.f(temporary.total_money) + '円で買って,残金は' + money.f(player[now.player].m - temporary.total_money) + '円となりますが\nよろしいですか?';
                yn_strings = 'bukken_buyall,' + sta_order;
                display.s.yn = true;
            }
        }
        bukken.sell = function (sta_order, bukken_order) {
            //駅の順番、物件の順番が必要
            if (box.p[sta_order].b[bukken_order].w == now.player) {
                if (yn_strings == 'bukken,sell,' + bukken_order) {
                    yn(true);
                } else {
                    yn_strings = 'bukken,sell,' + bukken_order;
                    display.s.yn = true;
                    strings = box.p[sta_order].b[bukken_order].n + 'を売却しますか?';
                }
            } else if (box.p[sta_order].b[bukken_order].w == 'none') strings = player[now.player].n + '!その物件は我が社の物件ではありません!';
            else strings = player[now.player].n + '!その物件は他社の物件です！';
        }
        bukken.sell2 = function (sta_order, bukken_order) {
            //駅の順番、物件の順番が必要
            box.p[sta_order].b[bukken_order].w = 'none';
            player[now.player].m += Math.floor(box.p[sta_order].b[bukken_order].v / 2);
            strings = player[now.player].n + 'は' + box.p[sta_order].n + 'の' + box.p[sta_order].b[bukken_order].n + 'を売却した！\n残額は' + money.f(player[now.player].m) + '円！';
        }
        bukken.card = function (sta_order, bukken_order) {
            temporary.i7 = false; //乗っ取りカードの有無
            temporary.i8 = "";
            for (let i9 = 0; i9 < player[now.player].card.length; i9++) {
                if (player[now.player].card[i9][0] == '乗っ取りカード') {
                    temporary.i7 = true;
                    temporary.i8 = i9;
                    break;
                }
            }
            if (temporary.i7) { //乗っ取りカードとかが存在するなら
                temporary.i9 = search.f.coordinate(player[now.player].x, player[now.player].y).order;
                temporary.i10 = false;
                for (let i9 = 0; i9 < box.p[temporary.i9].b.length; i9++) {
                    if ((!(box.p[temporary.i9].b[i9].w == now.player)) && (!(box.p[temporary.i9].b[i9].w == 'none'))) {
                        temporary.i10 = true;
                        break;
                    }
                }
                if (temporary.i10) {
                    strings = 'どの物件を乗っ取りますか？';
                    bukken.mode = 'steal';
                    steal_card = temporary.i8;
                } else strings = player[now.player].n + '!今乗っ取れるような物件はありませんぞ!';
            } else {
                strings = '今使えるカードは1枚もありません!';
            }
        }
        bukken.steal = function (sta_order, bukken_order, card_order) {
            if (box.p[sta_order].b[bukken_order].w == now.player) strings = player[now.player].n + '!その物件は我が社のものです!';
            else if (box.p[sta_order].b[bukken_order].w == 'none') strings = player[now.player].n + '!その物件は誰のものでもありません!';
            else {
                if (yn_strings == 'bukken,steal,' + bukken_order + ',' + card_order) {
                    yn(true);
                } else {
                    strings = box.p[sta_order].b[bukken_order].n + 'をを奪いますか?\n';
                    yn_strings = 'bukken,steal,' + bukken_order + ',' + card_order;
                    display.s.yn = true;
                }
            }
        }
        bukken.steal2 = function (sta_order, bukken_order, card_order) {
            box.p[sta_order].b[bukken_order].w = now.player;
            strings = player[now.player].n + 'は' + box.p[sta_order].n + 'の\n' + box.p[sta_order].b[bukken_order].n + 'をを奪った!\n';
            player[now.player].card[card_order][1]--;
            if (player[now.player].card[card_order][1] < 1) {
                strings += player[now.player].card[card_order][0] + 'が消えた!';
                player[now.player].card.splice(card_order, 1); //カード使用可能回数が0回のものを削除
            }
            bukken.mode = 'buy';
        }
        let turn = {};
        turn.finish = function () {
            card.mode = 'buy';
            display.s.moving = false;
            display.s.glasses = false;
            display.s.state = false;
            display.s.cmd1 = false;
            display.s.cmd2 = false;
            display.s.cmd3 = false;
            display.s.money = false;
            display.s.buycard = false;
            display.s.setting = false;
            display.f.bukken(['none'], false);
            roulette.f.end();
            display.s.card = false;
            now.can.bukken.buy = false;
            now.can.card.buy = false;
            now.player++;
            past = { coordinate: [], mousepoint: { x: '', y: '' } };
            if (now.player > player.length - 1) {
                now.player = 0;
                now.time++;
                game.start();
            } else {
                now.state = 'monthstart';
                enter();
            }
            center.x2 = -1 * player[now.player].x * s * r;
            center.y2 = -1 * player[now.player].y * s * r;
            center.x = parseFloat(canvas.width) / 2 + center.x2;
            center.y = parseFloat(canvas.height) / 2 + center.y2;
            center.x3 = parseFloat(canvas.width) / 2;
            center.y3 = parseFloat(canvas.height) / 2; //以上4行で位置を元に戻す
        }
        let roulette = { f: {}, content: [], v: [], setting: { m: {}, variation: { max: 1, min: 1 } }, mode: 'plus', stop: false, can: { stop: false, }, result: {}, decide: false, };
        roulette.setting.m.plus = [600, 680, 1660, 2060, 3840, 1670, 870, 230, 120, 90, 100, 180];
        roulette.setting.m.minus = [-560, -400, -310, -100, -50, -1370, -2270, -3400, -4150, -4220, -4670, -2270];
        roulette.setting.m.card = [ //10年区切り
            [
                ['急行カード', '急行カード', '急行カード', '急行カード', '急行カード', '急行周遊カード', '急行周遊カード', '急行周遊カード', '快急カード', '快急カード', '快急カード', '快急周遊カード', '特急カード', '特急カード', '特急周遊カード', 'ぶっとびカード', '乗っ取りカード'],
                ['急行カード', '急行カード', '急行周遊カード', '急行周遊カード', '快急カード', '快急カード', '快急周遊カード', '快急周遊カード', '特急カード', '特急周遊カード', 'ぶっとびカード', 'ぶっとびカード', '乗っ取りカード', '徳政令カード', '10億円カード'],
                ['急行カード', '急行カード', '急行カード', '急行周遊カード', '急行周遊カード', '快急カード', '快急カード', '快急周遊カード', '快急周遊カード', '特急カード', '特急周遊カード', 'ぶっとびカード', 'ぶっとびカード', '乗っ取りカード', '徳政令カード', '一頭地を抜くカード'],
            ]
        ];
        roulette.setting.m.nicecard = [
            [
                ['急行周遊カード', '急行周遊カード', '快急カード', '快急周遊カード', '快急周遊カード', '快急周遊カード', '特急カード', '特急(特別車)カード', '特急(特別車)カード', '特急周遊カード', '特急周遊カード', '快特(特別車)カード', '快特周遊カード', '新幹線カード', '新幹線カード', '新幹線周遊カード', '乗っ取りカード', '乗っ取りカード', '一頭地を抜くカード'],
            ],
        ]
        roulette.f.start = function (kind) {
            display.s.roulette = true;
            roulette.v = [];
            if (kind == 'plus') {
                roulette.content = roulette.setting.m.plus[roulette.f.time(time().month - 4)] * ((time().year - 1) * 0.2 + 1);
                roulette.setting.variation.max = 1.2;
                roulette.setting.variation.min = 0.8;
                roulette.mode = 'plus';
            } else if (kind == 'minus') {
                roulette.content = roulette.setting.m.minus[roulette.f.time(time().month - 4)] * ((time().year - 1) * 0.2 + 1);
                roulette.setting.variation.max = 1.3;
                roulette.setting.variation.min = 0.8;
                roulette.mode = 'minus';
            } else if (kind == 'card') {
                roulette.content = roulette.setting.m.card[Math.floor(time().year / 10)][Math.floor(Math.random() * roulette.setting.m.card[Math.floor(time().year / 10)].length)];
                roulette.mode = 'card';
            } else if (kind == 'nicecard') {
                roulette.content = roulette.setting.m.nicecard[Math.floor(time().year / 10)][Math.floor(Math.random() * roulette.setting.m.nicecard[Math.floor(time().year / 10)].length)];
                roulette.mode = 'nicecard';
            }
            now.state = 'roulettestop';
            roulette.stop = false;
            roulette.can.stop = false;
            roulette.can.stop2 = false;
            display.s.roulette = true;
            roulette.decide = true;
        }
        roulette.f.end = function () {
            display.s.roulette = false;
            roulette.v = [];
        }
        roulette.f.time = function (value) {
            if (value < 0) return value + 12;
            else return value;
        }
        roulette.f.decide = function () {
            if (roulette.decide) {
                roulette.decide = false;
                if (roulette.result.v2.charAt(roulette.result.v2.length - 1) == '円') {
                    player[now.player].m += parseFloat(roulette.result.v);
                } else {
                    player[now.player].card.push([roulette.result.v2, search.f.card(roulette.result.v2).t]);
                }
                strings = roulette.result.v2 + '！';
                now.state = 'rouletteget';
            }
        }
        let glasses = { tf: false };
        glasses.f = function () {
            console.log('glasses');
            console.log(glasses.tf);
            if (glasses.tf) { //終了時
                glasses.tf = false;
                display.s.bukken = false;
                display.s.buycard = false;
                display.s.yn = false;
                center.x = parseFloat(canvas.width) / 2 + center.x2;
                center.y = parseFloat(canvas.height) / 2 + center.y2;
                center.x3 = parseFloat(canvas.width) / 2;
                center.y3 = parseFloat(canvas.height) / 2; //以上4行で位置を元に戻す
                if (display.s.moving) { //移動中なら
                    display.s.money = false;
                } else { //ターン開始時なら
                    display.s.cmd2 = true;
                    display.s.state = true;
                }
            } else { //開始時
                glasses.tf = true;
                display.s.state = false;
                display.s.cmd2 = false;
                display.s.card = false; //カード表示の削除
                strings = ''; //テキスト表示の内容の削除
                display.f.txtbox(['none'], false); //テキストボックスの削除
            }
            return 0;
        }
        window.onload = function () {
            canvas = document.getElementById("can1");
            ctx = canvas.getContext("2d");
            context = canvas.getContext('2d');
            fitCanvasSize();
            if (canvas.getContext) {
                setInterval(draw2, 10);
            }
            window.onresize = fitCanvasSize;
            'mousedown touchstart'.split(' ').forEach((eventName) => {
                canvas.addEventListener(eventName, e => { //canvasのクリック判定
                    // マウスの座標をCanvas内の座標とあわせるため
                    //console.log(now.can.canvas_touch);
                    now.mouse = true;
                    let rect = canvas.getBoundingClientRect();
                    let point = {
                        x: (e.clientX - rect.left) * dpr,
                        y: (e.clientY - rect.top) * dpr
                    };
                    // クリック判定処理
                    for (let i6 = 0; i6 < shapes.length; i6++) {
                        let square = shapes[i6];
                        let hit =
                            (square.x <= point.x && point.x <= square.x + square.w)  // 横方向の判定
                            && (square.y <= point.y && point.y <= square.y + square.h)  // 縦方向の判定
                        //console.log(square);
                        if (hit) {
                            //console.log(now.can.canvas_touch);
                            square.what = square.what.split(',');
                            //console.log(square.what);
                            if (square.what[0] == 'k') display.f.sta_name();
                            else if (square.what[0] == 'key') key.f(square.what[1]);
                            else if (square.what[0] == 'bukken') {
                                display.s.yn = false;
                                if (square.what[1] == 'buy') bukken.buy(search.f.coordinate(player[now.player].x, player[now.player].y).order, square.what[2]);
                                else if (square.what[1] == 'sell') bukken.sell(search.f.coordinate(player[now.player].x, player[now.player].y).order, square.what[2]);
                                else if (square.what[1] == 'steal') bukken.steal(search.f.coordinate(player[now.player].x, player[now.player].y).order, square.what[2], steal_card);
                            } else if (square.what[0] == 'cardselect') {
                                if (yn_strings == 'cardselect,' + square.what[1] && display.s.yn == true) yn(true); //ダブルクリックで動くようにする。
                                else {
                                    strings = search.f.card(player[now.player].card[parseFloat(square.what[1])][0]).e + '\nこのカードを使いますか?';
                                    yn_strings = 'cardselect,' + square.what[1];
                                    display.s.yn = true;
                                    display.s.yn_de = true;
                                }
                            } else if (square.what[0] == 'carddeleteselect') {
                                if (yn_strings == 'carddeleteselect,' + square.what[1] && display.s.yn == true) yn(true); //ダブルクリックでも動かす
                                else {
                                    strings = player[now.player].card[parseFloat(square.what[1])][0] + 'を捨てますか?';
                                    yn_strings = 'carddeleteselect,' + square.what[1];
                                    display.s.yn = true;
                                }
                            }
                            else if (square.what[0] == 'bukkenbox' && now.can.canvas_touch == true && glasses.tf == true) display.f.bukken(square.what, true, 'glasses');
                            else if (square.what[0] == 'buycard' && now.can.canvas_touch == true && glasses.tf == true) {
                                display.s.buycard = true;
                                display.s.card_sta = search.f.coordinate(square.what[1], square.what[2]).order;
                                display.s.txtbox = true;
                                strings = 'ここはカード売り場駅' + stde(box.p[display.s.card_sta].n) + 'ですぞ！';
                                strings += display.f.can.move(parseFloat(square.what[1]), parseFloat(square.what[2])).strings;
                            } else if (square.what[0] == 'cardshop') {
                                display.s.yn = false; //はいかいいえを削除
                                square.what[2] = parseFloat(square.what[2]);
                                if (square.what[1] == 'buy') {
                                    if (player[now.player].card.length >= card.max) {
                                        strings = `${player[now.player].n}!これ以上カードを持てません！`;
                                        display.s.yn = false;
                                    } else {
                                        temporary.i = search.f.card(card.set[box.p[display.s.card_sta].set][square.what[2]]);
                                        if (player[now.player].m - temporary.i.v < 0 && (!(temporary.i.v == 0))) { //価格が0円の時はいかなる所持金でも買える
                                            strings = player[now.player].n + '！所持金が足りなくて買えません！';
                                            display.s.yn = false;
                                        } else {
                                            strings = card.list[temporary.i.order].n + 'を買いますか？';
                                            yn_strings = 'cardshop,buy,' + temporary.i.order;
                                            display.s.yn = true;
                                        }
                                    }
                                } else if (square.what[1] == 'point') {
                                    if (player[now.player].card.length >= card.max) {
                                        strings = `${player[now.player].n}!これ以上カードを持てません！`;
                                        display.s.yn = false;
                                    } else {
                                        temporary.i = search.f.card(card.set[box.p[display.s.card_sta].set][square.what[2]]);
                                        if (player[now.player].point - temporary.i.v < 0) {
                                            strings = player[now.player].n + '！ポイントが足りません！';
                                        } else {
                                            strings = card.list[temporary.i.order].n + 'をポイントで買いますか？';
                                            yn_strings = 'cardshop,point,' + temporary.i.order;
                                            display.s.yn = true;
                                        }
                                    }
                                } else if (square.what[1] == 'sell') {
                                    temporary.i = search.f.card(player[now.player].card[square.what[2]][0]);
                                    strings = card.list[temporary.i.order].n + 'を売却しますか？';
                                    yn_strings = 'cardshop,sell,' + temporary.i.order + ',' + square.what[2];
                                    display.s.yn = true;
                                }
                                else strings = '';
                            }
                            else if (/plus|blue|minus|red|card|yellow|port|nicecard/.test(square.what[0].toLowerCase()) && now.can.canvas_touch == true) {
                                display.f.txtbox(square.what, true);
                            }
                            else if (square.what[0] == 'canvas' && now.can.canvas_touch == true) {
                                console.log(point.x, point.y, center.x3 * dpr, center.y3 * dpr);
                                display.f.txtbox(['none'], false);
                                display.f.bukken(['none'], false);
                                display.s.money = false;
                                display.s.card = false;
                                display.s.buycard = false;
                                display.s.yn = false;
                                if (glasses.tf) {
                                    now.mousemoving = true;
                                }
                            } else if (square.what[0] == 'use') {
                                display.s.card = false;
                                display.s.yn_de = false;
                                display.s.setting = false;
                                if (square.what[1] == 'dice') {
                                    use.dice();
                                } else if (square.what[1] == 'card') {
                                    use.card();
                                }
                                else break;
                            } else if (square.what[0] == 'enter') enter();
                            else if (square.what[0] == 'cmd1') {
                                display.s.bukken = true;
                                display.s.yn = false; //yesかnoボタンを消す。
                                display.s.yn_de = false;
                                display.s.setting = false;
                                if (square.what[1] == 'buy') {
                                    strings = 'どの物件を購入しますか？';
                                    bukken.mode = 'buy';
                                }
                                else if (square.what[1] == 'buyall') bukken.buyall(search.f.coordinate(player[now.player].x, player[now.player].y).order);
                                else if (square.what[1] == 'sell') {
                                    strings = 'どの物件を売却しますか？';
                                    bukken.mode = 'sell';
                                }
                                else if (square.what[1] == 'finish') turn.finish();
                                else if (square.what[1] == 'card') bukken.card(search.f.coordinate(player[now.player].x, player[now.player].y).order);
                                else bukken.mode = square.what[1];
                            } else if (square.what[0] == 'cmd3') {
                                display.s.yn = false; //yesかnoボタンを消す。
                                display.s.yn_de = false;
                                display.s.setting = false;
                                display.s.buycard = true;
                                if (square.what[1] == 'buy') {
                                    strings = 'どのカードを購入しますか？';
                                    card.mode = 'buy';
                                } else if (square.what[1] == 'sell') {
                                    if (player[now.player].card.length < 1) strings = `${player[now.player].n}!カードを一枚も持っておりませんぞ！`;
                                    else strings = 'どのカードを売却しますか？';
                                    card.mode = 'sell';
                                } else if (square.what[1] == 'point') {
                                    strings = player[now.player].n + 'の現在のポイントは' + money.f(player[now.player].point) + '円です。\nどのカードをポイントで購入しますか？';
                                    card.mode = 'point';
                                }
                                else if (square.what[1] == 'finish') {
                                    display.s.buycard = false;
                                    display.s.cmd3 = false;
                                    if (!(card.point == 0)) {
                                        player[now.player].point += card.point;
                                        card.point = 0;
                                        strings = player[now.player].n + 'のポイントは' + money.f(player[now.player].point) + '円になった！';
                                        now.state = 'turnfinish';
                                    } else turn.finish();
                                }
                                else card.mode = square.what[1];
                            }
                            else if (square.what[0] == 'glasses') {
                                glasses.f();
                            }
                            else if (square.what[0] == 'はい') yn(true);
                            else if (square.what[0] == 'いいえ') yn(false);
                            else if (square.what[0] == 'yn_de') yn('yn_de');
                            else if (square.what[0] == 'other1') {
                                display.s.setting = true;
                                display.s.card = false;
                                display.s.bukken = false;
                                display.s.buycard = false;
                            }
                            else if (square.what[0] == 'data') {
                                if (square.what[1] == 'save') {
                                    data.save();
                                } else if (square.what[1] == 'load') {
                                    data.load();
                                } else if (square.what[1] == 'localload') {
                                    data.local.load();
                                }
                            }
                            break; //for文を強制終了。
                        }
                    }
                });
            });
            'mouseup touchend'.split(' ').forEach((eventName) => {
                canvas.addEventListener(eventName, e => {
                    now.mouse = false;
                    now.mousemoving = false;
                    past.mousepoint.x = '';
                    past.mousepoint.y = '';
                });
            });
            'mousemove touchmove'.split(' ').forEach((eventName) => {
                canvas.addEventListener(eventName, (e) => {
                    //console.log(glasses.tf, now.mousemoving, now.mouse);
                    if (glasses.tf == true && now.mouse == true && (now.mousemoving == true || eventName == 'touchmove')) {
                        let rect = canvas.getBoundingClientRect();
                        let point;
                        if (eventName == 'touchmove') {
                            point = {
                                x: (e.changedTouches[0].clientX - rect.left) * dpr,
                                y: (e.changedTouches[0].clientY - rect.top) * dpr
                            };
                        } else {
                            point = {
                                x: (e.clientX - rect.left) * dpr,
                                y: (e.clientY - rect.top) * dpr
                            };
                        }
                        if (past.mousepoint.x == '') past.mousepoint.x = point.x;
                        if (past.mousepoint.y == '') past.mousepoint.y = point.y;
                        center.x -= (past.mousepoint.x - point.x);
                        center.y -= (past.mousepoint.y - point.y);
                        past.mousepoint.x = point.x;
                        past.mousepoint.y = point.y;
                    };
                });
            });
            game.start();
        }
        function fitCanvasSize() {
            // Canvas のサイズをクライアントサイズに合わせる
            canvas.width = (document.documentElement.clientWidth - 10);
            canvas.height = (document.documentElement.clientHeight - 10);

            canvas.width *= dpr; //以下4行高画質化処理
            canvas.height *= dpr;
            canvas.style.width = String(canvas.width / dpr) + "px";
            canvas.style.height = String(canvas.height / dpr) + "px";

            center.x = parseFloat(canvas.width) / 2 + center.x2;
            center.y = parseFloat(canvas.height) / 2 + center.y2;
            center.x3 = parseFloat(canvas.width) / 2;
            center.y3 = parseFloat(canvas.height) / 2;
            locX = center.x;
            locY = center.y;
        }
        function draw2() {
            requestAnimationFrame(draw);
        }
        function draw() {
            adj.x = 0;
            adj.y = 0; //adjをリセット
            shapes = [];
            if (flying.tf) {
                if (Math.abs(flying.v.r.x) >= Math.abs(flying.v.r.y)) {
                    flying.v.n.x -= 5 * Math.sign(flying.v.r.x);
                    adj.x = flying.v.n.x;
                    flying.v.n.y -= 5 * Math.abs(((flying.v.r.y) / (flying.v.r.x))) * Math.sign(flying.v.r.y);
                    adj.y = flying.v.n.y;
                } else {
                    flying.v.n.x -= 5 * ((flying.v.r.x) / (flying.v.r.y));
                    adj.x = flying.v.n.x;
                    flying.v.n.y -= 5 * Math.sign(flying.v.r.y);
                    adj.y = flying.v.n.y;
                }
                if (((((Math.sign(flying.v.r.x) == -1 && flying.v.n.x * -1 < flying.v.r.x))) || ((Math.sign(flying.v.r.x) == 1 && flying.v.n.x * -1 > flying.v.r.x)) || flying.v.r.x == 0) && (((Math.sign(flying.v.r.y) == -1 && flying.v.n.y * -1 < flying.v.r.y)) || (((Math.sign(flying.v.r.y) == 1 && flying.v.n.y * -1 > flying.v.r.y))) || flying.v.r.y == 0)) {
                    player[now.player].x = flying.v.to.x;
                    player[now.player].y = flying.v.to.y;
                    flying.tf = false;
                    flying.v.r = { x: 0, y: 0 };
                    adj.x = 0;
                    adj.y = 0;
                    center.x2 = -1 * player[now.player].x * s * r;
                    center.y2 = -1 * player[now.player].y * s * r;
                    center.x = parseFloat(canvas.width) / 2 + center.x2;
                    center.y = parseFloat(canvas.height) / 2 + center.y2;
                    now.can.move = false;
                    arrive(1);
                }
            } else if (moving.tf) {
                if (moving.v.d == 'n' || moving.v.d == 's') {
                    moving.v.n -= moving.v.r / 20;
                    adj.y = moving.v.n;
                } else if (moving.v.d == 'e' || moving.v.d == 'w') {
                    moving.v.n -= moving.v.r / 20;
                    adj.x = moving.v.n;
                }
                if ((Math.sign(moving.v.r) == -1 && moving.v.n * -1 < moving.v.r) || (Math.sign(moving.v.r) == 1 && moving.v.n * -1 > moving.v.r)) {
                    //Math.signの返り値は、正の場合１、負の場合-1、0の場合0です。
                    player[now.player].x = moving.v.to.x;
                    player[now.player].y = moving.v.to.y;
                    moving.tf = false;
                    moving.v.r = 0;
                    adj.x = 0;
                    adj.y = 0;
                    center.x2 = -1 * player[now.player].x * s * r;
                    center.y2 = -1 * player[now.player].y * s * r;
                    center.x = parseFloat(canvas.width) / 2 + center.x2;
                    center.y = parseFloat(canvas.height) / 2 + center.y2;
                    if (now.next.arrive) {
                        now.can.move = false;
                        now.next.arrive = false;
                        arrive();
                    } else if (moving.auto.tf) {
                        moving.auto.f();
                    }
                }
            }
            ctx.beginPath();
            ctx.rect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#FFFFFF";
            ctx.fill();
            for (let i4 = 0; i4 < block.length; i4++) {
                if (center.x + block[i4].x * s * r + adj.x * r > canvas.width || center.y + block[i4].y * s * r + adj.y * r > canvas.height || center.x + (block[i4].x + block[i4].w) * s * r + adj.x * r < 0 || center.y + (block[i4].y + block[i4].h) * s * r + adj.y * r < 0) continue;
                ctx.beginPath();
                if (block[i4].c == 'sea') ctx.fillStyle = '#33ccff';
                else if (/land/.test(block[i4].c)) ctx.fillStyle = '#B0FC49';
                else ctx.fillStyle = '#000000';
                ctx.rect(center.x + block[i4].x * s * r + adj.x * r, center.y + block[i4].y * s * r + adj.y * r, block[i4].w * s * r, block[i4].h * s * r);
                ctx.fill();
            }
            for (let i4 = 0; i4 < line.p.length; i4++) {
                ctx.beginPath();
                ctx.fillStyle = '#000000'; //色を設定
                if ((center.x - (line.w / 2) * r + (line.p[i4].c[0].x * s + adj.x) * r < -1 * s * 3) || (center.x - (line.w / 2) * r + (line.p[i4].c[0].x * s + adj.x) * r > canvas.width + s * 3) || (center.y - (line.w / 2) * r + (line.p[i4].c[0].y * s + adj.y) * r < -1 * s * 3) || (center.y - (line.w / 2) * r + (line.p[i4].c[0].y * s + adj.y) * r > canvas.height + s * 3)) {
                    continue;
                }
                if (line.p[i4].c[0].x - line.p[i4].c[1].x == 0) { //y方向の線のとき
                    ctx.rect(center.x - (line.w / 2) * r + (line.p[i4].c[0].x * s + adj.x) * r, center.y - (line.w / 2) * r + (line.p[i4].c[0].y * s + adj.y) * r, line.w * r, line.p[i4].l * s * r);
                    ctx.fill();
                } else if (line.p[i4].c[0].y - line.p[i4].c[1].y == 0) { //x方向の線の時
                    ctx.rect(center.x - (line.w / 2) * r + (line.p[i4].c[0].x * s + adj.x) * r, center.y - (line.w / 2) * r + (line.p[i4].c[0].y * s + adj.y) * r, line.p[i4].l * s * r, line.w * r);
                    ctx.fill();
                }
            }
            for (let i4 = 0; i4 < box.p.length; i4++) {
                if ((center.x - (box.w / 2) * r + (box.p[i4].x * s + adj.x) * r < -1 * size.font * r * 3) || (center.x - (box.w / 2) * r + (box.p[i4].x * s + adj.x) * r > canvas.width + size.font * r * 3) || (center.y - (box.h / 2) * r + (box.p[i4].y * s + adj.y) * r < -1 * size.font * r * 3) || (center.y - (box.h / 2) * r + (box.p[i4].y * s + adj.y) * r > canvas.height + size.font * r * 3)) {
                    continue; //範囲外を表示しない処理
                }
                ctx.globalCompositeOperation = "source-over";
                ctx.beginPath(); //入力情報をリセット
                ctx.rect(center.x - (box.w / 2) * r + (box.p[i4].x * s + adj.x) * r, center.y - (box.h / 2) * r + (box.p[i4].y * s + adj.y) * r, box.w * r, box.h * r); //正方形の情報を入力
                if (Array.isArray(box.p[i4].b)) ctx.fillStyle = 'yellowgreen'; //yellowgreenは黄緑
                else if (box.p[i4].b == 'port') ctx.fillStyle = '#FFFFFF';
                else if (box.p[i4].b == 'buycard') ctx.fillStyle = '#FFFFFF';
                else if (box.p[i4].b == 'nicecard') ctx.fillStyle = 'yellow'; //ナイスカード駅
                else if (/p|b/.test(box.p[i4].b.charAt(0))) ctx.fillStyle = '#33CCFF'; //'plus'か'blue'=プラス駅
                else if (/m|r/.test(box.p[i4].b.charAt(0))) ctx.fillStyle = 'red'; //'minus'か'red'=マイナス駅
                else if (/c|y/.test(box.p[i4].b.charAt(0))) ctx.fillStyle = 'yellow'; //'card'か'yellow'=カード駅
                else ctx.fillStyle = '#000000';
                ctx.fill();
                ctx.strokeStyle = 'blue';
                let line_w = 6;
                ctx.lineWidth = line_w;
                ctx.stroke();

                if (box.p[i4].b == 'port') { //港の壁画
                    ctx.beginPath();
                    ctx.font = size.font * r + 'px sans serif';
                    ctx.fillStyle = '#33CCFF';
                    ctx.fillText('⚓', center.x + (box.p[i4].x * s + adj.x) * r - (box.w / 2) * r - 6, center.y + (box.h / 2) * r + (box.p[i4].y * s + adj.y) * r - 6, box.w * r + 12); //第4因数は横の最大幅
                } else if (box.p[i4].b == 'buycard') { //カード売り場駅の壁画
                    ctx.beginPath();
                    ctx.font = box.h * r * 1.18 + 'px sans serif';
                    ctx.fillStyle = '#22FF22';
                    ctx.fillText('★', center.x + (box.p[i4].x * s + adj.x) * r - (box.w / 2) * r - 6, center.y + (box.h / 2) * r + (box.p[i4].y * s + adj.y) * r - 6, box.w * r + 12); //第4因数は横の最大幅
                } else if (box.p[i4].b == 'nicecard') { //ナイスカード駅の壁画
                    ctx.beginPath();
                    ctx.font = box.h * r * 1.08 + 'px sans serif';
                    ctx.fillStyle = '#00FF00';
                    ctx.fillText('Ｎ', center.x + (box.p[i4].x * s + adj.x) * r - (box.w / 2) * r - 6, center.y + (box.h / 2) * r + (box.p[i4].y * s + adj.y) * r - 6, box.w * r + 12); //第4因数は横の最大幅
                }

                let sta_kind = box.p[i4].b;
                if (Array.isArray(sta_kind)) sta_kind = 'bukkenbox';
                sta_kind += ',' + box.p[i4].x + ',' + box.p[i4].y;
                shapes.push({ x: center.x - (box.w / 2) * r + (box.p[i4].x * s + adj.x) * r - (line_w / 2), y: center.y - (box.h / 2) * r + (box.p[i4].y * s + adj.y) * r - (line_w / 2), w: box.w * r + line_w, h: box.h * r + line_w, what: sta_kind }); //クリック判定
                if (!(isNaN(parseFloat(box.p[i4].n)))) continue; //名前が番号の際は以下省略
                if (Array.isArray(box.p[i4].b) || display.s.sta_name) {
                    let d1 = box.f(box.p[i4].d); //[東西方向の座標修正、南北方向の座標修正]の順に返ってくる
                    ctx.beginPath(); //以下駅名の背景を描く
                    ctx.font = size.font * r + 'px sans serif';//文字の長さ取得用
                    sta_name = box.p[i4].n;
                    if (box.p[i4].n.charAt(box.p[i4].n.length - 1) == '駅') sta_name = box.p[i4].n.substring(0, box.p[i4].n.length - 1);
                    txw = ctx.measureText(sta_name);
                    adj.s = 0;
                    if (box.p[i4].s.charAt(0) == 'r') adj.s = txw.width - (box.w / 2) * r; //右寄せ(頭文字がr)の時
                    else if (box.p[i4].s.charAt(0) == 'c') adj.s = txw.width / 2; //中央(center)の時
                    else adj.s = (box.w / 2) * r; //左寄せ(頭文字がl(エル))のとき
                    ctx.rect(center.x + (box.p[i4].x * s + d1[0] + adj.x) * r - adj.s, center.y - (box.h / 2) * r + (box.p[i4].y * s + d1[1] + adj.y) * r, txw.width, box.h * r);
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fill();
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = 2 * r;
                    ctx.stroke();

                    ctx.beginPath(); //以下文字（駅名）を描く
                    ctx.font = size.font * r + 'px sans serif';
                    ctx.fillStyle = '#000000';
                    ctx.fillText(sta_name, center.x + (box.p[i4].x * s + d1[0] + adj.x) * r - adj.s, center.y + (box.h / 2) * r + (box.p[i4].y * s + d1[1] - 5 + adj.y) * r, 500 * r); //第4因数は横の最大幅
                }
            }
            ctx.globalCompositeOperation = "source-over";
            for (let i17 = 0; i17 < player.length; i17++) {
                ctx.beginPath(); //以下自分の車両の壁画
                ctx.fillStyle = player[i17].color;
                if (glasses.tf) {
                    temporary.x3 = center.x + (player[i17].x * s + adj.x) * r;
                    temporary.y3 = center.y + (player[i17].y * s + adj.y) * r;
                } else {
                    if (i17 == now.player) {
                        temporary.x3 = center.x3;
                        temporary.y3 = center.y3;
                    } else {
                        temporary.x3 = center.x + (player[i17].x * s + adj.x) * r;

                        temporary.y3 = center.y + (player[i17].y * s + adj.y) * r;
                    }
                }
                temporary.i28 = search.f.where(temporary.x3, temporary.y3);
                if (flying.tf == false && temporary.i28.length > 0 && temporary.i28[temporary.i28.length - 1].c == 'sea') {
                    ctx.save();
                    if (player[i17].d == 'w') {
                        ctx.scale(-1, 1);
                        ctx.translate(temporary.x3 * -1, temporary.y3);
                        ctx.rotate(0 * (Math.PI / 180)); //角度をつける
                    } else if (player[i17].d == 'e') {
                        ctx.translate(temporary.x3, temporary.y3);
                        ctx.rotate(0 * (Math.PI / 180)); //角度をつける
                    } else {
                        ctx.translate(temporary.x3, temporary.y3);
                    }
                    let img = new Image();
                    img.src = svg.make.ship(player[i17].color);
                    ctx.drawImage(img, /*temporary.x3*/0 - box.h * r * 0.75, 0/*temporary.y3*/ - box.h * 0.5 - 10, box.h * r * 1.5, box.h * r);
                    ctx.fill();
                    ctx.restore();
                } else {
                    ctx.arc(temporary.x3, temporary.y3, 16 * r, 0, Math.PI * 2.0, false); //円の情報を入力
                    ctx.fill();
                }
            }

            ctx.beginPath();//以下ボタン壁画
            ctx.font = size.font * r + 'px sans serif';
            txw = ctx.measureText('Ⓚ物件駅以外の駅名を消す');
            ctx.rect(center.x3 * 2 - txw.width - 5, 5, txw.width, size.font * r);
            shapes.push({ x: center.x3 * 2 - txw.width - 5, y: 5, w: txw.width, h: size.font * r, what: 'k' });
            ctx.fillStyle = '#FFFFFF';
            ctx.fill();
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2 * r;
            ctx.stroke();

            ctx.beginPath(); //以下文字壁画
            ctx.font = size.font * r + 'px sans serif';
            ctx.fillStyle = '#000000';
            ctx.fillText('Ⓚ物件駅以外の駅名を消す', center.x3 * 2 - txw.width - 5, size.font * r, 500 * r);
            if (display.s.glasses) {
                ctx.beginPath();
                ctx.font = size.font * r + 'px sans serif';
                txw = ctx.measureText('Ⓨ虫メガネ');
                ctx.rect(canvas.width - txw.width - 12, size.font * r * 3, canvas.width * 0.2, size.font * r);
                ctx.fillStyle = '#FFFFFF';
                ctx.fill();
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = '6';
                ctx.stroke();
                ctx.beginPath();
                ctx.fillStyle = '#000000';
                ctx.fillText('Ⓨ虫メガネ', canvas.width - txw.width - 12, size.font * r * 4 - 8, canvas.width * 0.2);
                shapes.unshift({ x: canvas.width - txw.width - 12, y: size.font * r * 3, w: canvas.width * 0.2, h: size.font * r, what: 'glasses' });
            } if (display.s.bukken) { //物件表示
                ctx.beginPath();
                ctx.rect(canvas.width * 0.2, 5 + size.font * r, canvas.width * 0.8 - 3, canvas.height * 0.68 - 5 - size.font * r);
                ctx.fillStyle = "#FFFFFF";
                ctx.fill();
                ctx.lineWidth = 6;
                ctx.strokeStyle = "#000000";
                ctx.stroke();

                ctx.beginPath();
                ctx.font = size.font * r + 'px sans serif';
                ctx.fillStyle = '#000000';
                ctx.fillText('物件名', canvas.width * 0.2, 5 + size.font * r * 2, canvas.width * 0.25);
                ctx.beginPath();
                ctx.fillText('価格', canvas.width * 0.45, 5 + size.font * r * 2, canvas.width * 0.4);
                ctx.beginPath(); //利益率
                ctx.fillText('利益率', canvas.width * 0.68, 5 + size.font * r * 2, canvas.width * 0.1);
                ctx.beginPath(); //所持者
                ctx.fillText('所持者', canvas.width * 0.8, 5 + size.font * r * 2, canvas.width * 0.15);
                for (let i8 = 0; i8 < box.p[display.s.bukken_sta].b.length; i8++) {
                    ctx.beginPath(); //物件名
                    ctx.font = size.font * r + 'px sans serif';
                    ctx.fillStyle = '#000000';
                    ctx.fillText(box.p[display.s.bukken_sta].b[i8].n, canvas.width * 0.2, 5 + size.font * r * (i8 + 3) + i8 * 10, canvas.width * 0.25);

                    ctx.beginPath(); //価格
                    temporary.i2 = money.f(box.p[display.s.bukken_sta].b[i8].v) + '円';
                    if (bukken.mode == 'sell') temporary.i2 = money.f(Math.floor(box.p[display.s.bukken_sta].b[i8].v / 2)) + '円'; //売却モードの場合半額にする
                    ctx.fillText(temporary.i2, canvas.width * 0.45, 5 + size.font * r * (i8 + 3) + i8 * 10, canvas.width * 0.23);

                    ctx.beginPath(); //利益率
                    ctx.fillText(box.p[display.s.bukken_sta].b[i8].p + '%', canvas.width * 0.68, 5 + size.font * r * (i8 + 3) + i8 * 10, canvas.width * 0.12);

                    ctx.beginPath(); //所持者
                    if (!(box.p[display.s.bukken_sta].b[i8].w == 'none')) ctx.fillText(player[box.p[display.s.bukken_sta].b[i8].w].n, canvas.width * 0.8, 5 + size.font * r * (i8 + 3) + i8 * 10, canvas.width * 0.15);

                    temporary.i2 = 'bukken,' + bukken.mode + ',' + i8;
                    if (now.can.bukken.buy) shapes.unshift({ x: canvas.width * 0.2, y: 5 + size.font * r * (i8 + 2) + i8 * 10, w: canvas.width * 0.8 - 3, h: size.font * r, what: temporary.i2 });
                }

            } if (display.s.buycard) { //カード表示
                ctx.beginPath();
                ctx.rect(canvas.width * 0.2, 5 + size.font * r, canvas.width * 0.8 - 3, canvas.height * 0.68 - 5 - size.font * r);
                ctx.fillStyle = "#FFFFFF";
                ctx.fill();
                ctx.lineWidth = 6;
                ctx.strokeStyle = "#000000";
                ctx.stroke();

                ctx.beginPath();
                ctx.font = size.font * r + 'px sans serif';
                ctx.fillStyle = '#000000';
                ctx.fillText('名前', canvas.width * 0.2, 5 + size.font * r * 2, canvas.width * 0.4);
                ctx.beginPath();
                ctx.fillText('価格', canvas.width * 0.6, 5 + size.font * r * 2, canvas.width * 0.2);
                if (card.mode == 'sell') temporary.i3 = player[now.player].card.length;
                else temporary.i3 = card.set[box.p[display.s.card_sta].set].length;
                for (let i8 = 0; i8 < temporary.i3; i8++) {
                    ctx.beginPath(); //カード名
                    ctx.font = size.font * r + 'px sans serif';
                    if (player[now.player].card.length >= card.max && (!(card.mode == 'sell'))) ctx.fillStyle = '#FA1830';
                    else ctx.fillStyle = '#000000';
                    if (card.mode == 'sell') temporary.i2 = player[now.player].card[i8][0];
                    else temporary.i2 = card.set[box.p[display.s.card_sta].set][i8];
                    ctx.fillText(temporary.i2, canvas.width * 0.2, 5 + size.font * r * (i8 + 3) + i8 * 10, canvas.width * 0.4);

                    ctx.beginPath(); //価格
                    if (card.mode == 'sell') temporary.i2 = money.f(Math.floor((search.f.card(player[now.player].card[i8][0]).v) / 4)) + '円';
                    else temporary.i2 = money.f(search.f.card(card.set[box.p[display.s.card_sta].set][i8]).v) + '円';
                    ctx.fillText(temporary.i2, canvas.width * 0.6, 5 + size.font * r * (i8 + 3) + i8 * 10, canvas.width * 0.2);
                    temporary.i2 = 'cardshop,' + card.mode + ',' + i8;
                    if (now.can.card.buy) shapes.unshift({ x: canvas.width * 0.2, y: 5 + size.font * r * (i8 + 2) + i8 * 10, w: canvas.width * 0.8 - 3, h: size.font * r, what: temporary.i2 });
                }

            } if (display.s.setting) {
                if (display.s.state) adj.seth = size.font * r * 3 + 5;
                else adj.seth = size.font * r * 1 + 5;
                ctx.beginPath();
                ctx.rect(canvas.width * 0.2, adj.seth + size.font * r * 0.1, canvas.width * 0.8 - 3, canvas.height * 0.68 - adj.seth);
                ctx.fillStyle = "#FFFFFF";
                ctx.fill();
                ctx.lineWidth = 6;
                ctx.strokeStyle = "#000000";
                ctx.stroke();

                ctx.beginPath();
                ctx.font = size.font * r * 1.2 + 'px sans serif';
                ctx.fillStyle = '#000000';
                ctx.fillText('セーブ', canvas.width * 0.2, adj.seth + size.font * r * 1.3, canvas.width * 0.2);
                ctx.beginPath();
                ctx.fillText('※今月開始時のデータを保存します。', canvas.width * 0.4, adj.seth + size.font * r * 1.3, canvas.width * 0.59);
                shapes.unshift({ x: canvas.width * 0.2, y: adj.seth + size.font * r * 0.2, w: canvas.width * 0.8 - 2, h: size.font * r * 1.2, what: 'data,save' });
                ctx.beginPath();
                ctx.fillText('ロード(ファイル読み込み)', canvas.width * 0.2, adj.seth + size.font * r * 2.4, canvas.width * 0.8 - 2);
                shapes.unshift({ x: canvas.width * 0.2, y: adj.seth + size.font * r * 1.3, w: canvas.width * 0.8 - 2, h: size.font * r * 1.2, what: 'data,load' });
                ctx.beginPath();
                /*ctx.fillText('ロード(ブラウザに保存されたデータ)', canvas.width * 0.2, adj.seth + size.font * r * 4.6, canvas.width * 0.8 - 2);
                shapes.unshift({ x: canvas.width * 0.2, y: adj.seth + size.font * r * 3.5, w: canvas.width * 0.8 - 2, h: size.font * r * 1.2, what: 'data,localload' });*/
            }
            if (display.s.txtbox) { //以下下に表示する文字の壁画
                ctx.beginPath();
                ctx.rect(canvas.width * 0.2, canvas.height * 0.68 + 8, canvas.width * 0.8 - 3, canvas.height * 0.32 - 10);
                ctx.fillStyle = "#FFFFFF";
                ctx.fill();
                ctx.lineWidth = 6;
                ctx.strokeStyle = "#000000";
                ctx.stroke();

                ctx.beginPath();
                ctx.font = size.font * r + 'px sans serif';
                ctx.fillStyle = '#000000';
                strings2 = strings.split('\n');
                for (let i3 = 0; i3 < strings2.length; i3++) ctx.fillText(strings2[i3], canvas.width * 0.2 + 5, canvas.height * 0.68 + 6 + size.font * r * (i3 + 1), canvas.width * 0.8 - 3);
            } if (display.s.money) { //金額表示
                ctx.beginPath();
                ctx.rect(canvas.width * 0.1 + 12, 4.5, canvas.width * 0.8, size.font * r);
                ctx.fillStyle = player[now.player].color;
                ctx.fill();
                ctx.lineWidth = 4;
                ctx.strokeStyle = "#000000";
                ctx.stroke();

                ctx.beginPath(); //社長の名前
                ctx.font = size.font * r + 'px sans serif';
                temporary.money = money.f(player[now.player].m) + '円';
                txw = ctx.measureText(temporary.money);
                ctx.fillStyle = '#000000';
                ctx.fillText(player[now.player].n, canvas.width * 0.1 + 5, size.font * r - 2, canvas.width * 0.4);
                ctx.beginPath(); //金額
                ctx.fillText(temporary.money, canvas.width * 0.9 - txw.width, size.font * r - 2, canvas.width * 0.9);
                ctx.beginPath(); //「所持金:」を壁画
                ctx.fillText('所持金:', canvas.width * 0.4, size.font * r - 2, canvas.width * 0.6 - txw.width);
            } if (display.s.state) {
                ctx.beginPath(); //枠の壁画
                ctx.rect(canvas.width * 0.1 + 12, 4.5, canvas.width * 0.8, size.font * r * 2.5);
                ctx.fillStyle = 'rgba(50,50,50,0.7)';
                ctx.fill();
                ctx.lineWidth = 8;
                ctx.strokeStyle = player[now.player].color;
                ctx.stroke();

                ctx.beginPath(); //以下真ん中の仕切り線の壁画
                ctx.rect(canvas.width * 0.115, 16 + size.font * r, canvas.width * 0.585, 4);
                ctx.fillStyle = '#FFFFFF';
                ctx.fill();

                ctx.beginPath(); //社長の名前の壁画
                ctx.font = size.font * r + 'px sans serif';
                ctx.fillStyle = '#FFFFFF';
                ctx.fillText(player[now.player].n, canvas.width * 0.12, 5 + size.font * r, canvas.width * 0.4);

                temporary.money = money.f(player[now.player].m) + '円'; //以下所持金の壁画
                txw = ctx.measureText(temporary.money);
                ctx.beginPath();
                ctx.fillText(temporary.money, canvas.width * 0.7 - txw.width, 5 + size.font * r, canvas.width * 0.5);

                ctx.beginPath(); //残りのマス数の壁画
                ctx.fillText(now.dest.n + 'までマス', canvas.width * 0.12, 15 + size.font * r * 2, canvas.width * 0.4);
                temporary.time = time(now.time);
                txw = ctx.measureText(temporary.time.year + '年目');
                ctx.beginPath(); //現在の何年目か
                ctx.fillText(temporary.time.year + '年目', canvas.width * 0.7 - txw.width, 15 + size.font * r * 2, canvas.width * 0.4);
                ctx.beginPath(); //現在の何月か
                ctx.font = size.font * r * 2 + 'px sans serif';
                txw = ctx.measureText(temporary.time.month + '月');
                ctx.fillText(temporary.time.month + '月', canvas.width * 0.9 - txw.width, size.font * r * 2, canvas.width * 0.2);
            } if (display.s.cmd1) { //コマンド壁画。１つ目は物件購入画面。
                temporary.arr.cmd = [['買う', 'cmd1,buy'], ['まとめ買い', 'cmd1,buyall'], ['売る', 'cmd1,sell'], ['カード', 'cmd1,card'], ['その他', 'other1'], ['やめる', 'cmd1,finish']];
                ctx.beginPath(); //枠の壁画
                ctx.rect(6, size.font * r + 5, canvas.width * 0.2 - 15, size.font * r * temporary.arr.cmd.length + temporary.arr.cmd.length * 10 - 5);
                ctx.fillStyle = '#FFFFFF';
                ctx.fill();
                ctx.lineWidth = 6;
                ctx.strokeStyle = "#000000";
                ctx.stroke();

                ctx.font = size.font * r + 'px sans serif';
                for (let i3 = 0; i3 < temporary.arr.cmd.length; i3++) {
                    ctx.beginPath();
                    ctx.fillStyle = '#000000';
                    ctx.fillText(temporary.arr.cmd[i3][0], 12, size.font * r * (i3 + 2) + i3 * 10, canvas.width * 0.2 - 30);
                    txw = ctx.measureText(temporary.arr.cmd[i3][0]);
                    shapes.unshift({ x: 12, y: size.font * r * (i3 + 1) + i3 * 10, w: txw.width, h: size.font * r, what: temporary.arr.cmd[i3][1] });
                }
            } if (display.s.cmd2) { //コマンド壁画。２つ目は最初のサイコロとかの選択画面。
                temporary.arr.cmd = [['サイコロ', 'use,dice'], ['カード', 'use,card'], ['その他', 'other1']];
                ctx.beginPath(); //枠の壁画
                ctx.rect(6, canvas.height * 0.68 + 4 - size.font * r * temporary.arr.cmd.length - temporary.arr.cmd.length * 10, canvas.width * 0.2 - 15, size.font * r * temporary.arr.cmd.length + temporary.arr.cmd.length * 10 - 5);
                ctx.fillStyle = '#FFFFFF';
                ctx.fill();
                ctx.lineWidth = 6;
                ctx.strokeStyle = "#000000";
                ctx.stroke();
                ctx.font = size.font * r + 'px sans serif';
                for (let i3 = 0; i3 < temporary.arr.cmd.length; i3++) {
                    ctx.beginPath();
                    if (temporary.arr.cmd[i3][1] == 'use,card' && player[now.player].card.length < 1) ctx.fillStyle = '#FA1830';
                    else ctx.fillStyle = '#000000';
                    ctx.fillText(temporary.arr.cmd[i3][0], 12, canvas.height * 0.68 - size.font * r * (temporary.arr.cmd.length - i3 - 1) - (temporary.arr.cmd.length - i3) * 10, canvas.width * 0.2 - 30);
                    txw = ctx.measureText(temporary.arr.cmd[i3][0]);
                    //console.log(txw.width);
                    shapes.unshift({ x: 12, y: canvas.height * 0.68 + 4 - size.font * r * (temporary.arr.cmd.length - i3) - (temporary.arr.cmd.length - i3) * 10, w: txw.width, h: size.font * r, what: temporary.arr.cmd[i3][1] });
                }
            } if (display.s.cmd3) { //カード購入・売却場面の壁画。１つ目は物件購入画面。
                temporary.arr.cmd = [['買う', 'cmd3,buy'], ['売る', 'cmd3,sell'], ['ポイント', 'cmd3,point'], ['その他', 'other1'], ['やめる', 'cmd3,finish']];
                ctx.beginPath(); //枠の壁画
                ctx.rect(6, size.font * r + 5, canvas.width * 0.2 - 15, size.font * r * temporary.arr.cmd.length + temporary.arr.cmd.length * 10 - 5);
                ctx.fillStyle = '#FFFFFF';
                ctx.fill();
                ctx.lineWidth = 6;
                ctx.strokeStyle = "#000000";
                ctx.stroke();

                ctx.font = size.font * r + 'px sans serif';
                for (let i3 = 0; i3 < temporary.arr.cmd.length; i3++) {
                    ctx.beginPath();
                    if (temporary.arr.cmd[i3][1] == 'cmd3,sell' && player[now.player].card.length < 1) ctx.fillStyle = '#FA1830';
                    else ctx.fillStyle = '#000000';
                    ctx.fillText(temporary.arr.cmd[i3][0], 12, size.font * r * (i3 + 2) + i3 * 10, canvas.width * 0.2 - 30);
                    txw = ctx.measureText(temporary.arr.cmd[i3][0]);
                    shapes.unshift({ x: 12, y: size.font * r * (i3 + 1) + i3 * 10, w: txw.width, h: size.font * r, what: temporary.arr.cmd[i3][1] });
                }
            }
            if (display.s.card) { //カードリストの壁画
                ctx.beginPath(); //まず枠を壁画
                ctx.rect(canvas.width * 0.3, canvas.height * 0.15, canvas.width * 0.4, canvas.height * 0.52 + 8);
                ctx.fillStyle = '#FFFFFF';
                ctx.fill();
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 6;
                ctx.stroke();
                for (let i3 = 0; i3 < player[now.player].card.length; i3++) { //カード一覧の壁画
                    ctx.beginPath();
                    ctx.fillStyle = '#000000';
                    ctx.fillText(player[now.player].card[i3][0], canvas.width * 0.3, canvas.height * 0.15 + size.font * r * (i3 + 1), canvas.width * 0.38);
                    txw = ctx.measureText(player[now.player].card[i3][0]);
                    if (card.selectmode == 'delete') temporary.selectmode = 'carddeleteselect,' + i3;
                    else temporary.selectmode = 'cardselect,' + i3;
                    shapes.unshift({ x: canvas.width * 0.3, y: canvas.height * 0.15 + size.font * r * (i3), w: txw.width, h: size.font * r, what: temporary.selectmode });
                }
            } if (display.s.roulette) { //ルーレットの壁画
                ctx.beginPath();
                ctx.font = size.font * r + 'px sans serif';
                ctx.rect(canvas.width * 0.3, canvas.height * 0.2, canvas.width * 0.4, size.font * r * 3 * 1.25);
                ctx.fillStyle = 'rgba(50,50,50,0.7)';
                ctx.fill();
                temporary.color = '#000000';
                if (roulette.mode == 'plus') temporary.color = '#33CCFF';
                else if (roulette.mode == 'minus') temporary.color = '#FA1830';
                else if (roulette.mode == 'card' || roulette.mode == 'nicecard') temporary.color = 'yellow';
                if (roulette.v.length == 0) {
                    for (let i3 = 0; i3 < 4; i3++) {
                        temporary.v = 0;
                        temporary.v2 = '';
                        if (roulette.mode == 'plus' || roulette.mode == 'minus') {
                            temporary.v = Math.floor(roulette.content * (Math.random() * (roulette.setting.variation.max - roulette.setting.variation.min) + roulette.setting.variation.min));
                            temporary.v2 = money.f(temporary.v) + '円';
                            if (!(temporary.v2.charAt(0) == '-')) temporary.v2 = '+' + temporary.v2;
                        } else if (roulette.mode == 'card' || roulette.mode == 'nicecard') {
                            temporary.v = roulette.content[Math.floor(Math.random() * roulette.content.length)];
                            temporary.v2 = temporary.v;
                        }
                        roulette.v.push({ v: temporary.v, v2: temporary.v2, y: size.font * r * (i3 - 1) * 1.25 });
                    }
                }
                for (let i3 = 0; i3 < roulette.v.length; i3++) {
                    ctx.beginPath();
                    if (roulette.stop == false) roulette.v[i3].y -= 10;
                    if (canvas.height * 0.2 + size.font * r * 1.25 * 2 + roulette.v[i3].y < canvas.height * 0.2) {
                        if (roulette.mode == 'plus' || roulette.mode == 'minus') {
                            temporary.v = Math.floor(roulette.content * (Math.random() * (roulette.setting.variation.max - roulette.setting.variation.min) + roulette.setting.variation.min));
                            temporary.v2 = money.f(temporary.v) + '円';
                            if (!(temporary.v2.charAt(0) == '-')) temporary.v2 = '+' + temporary.v2;
                        } else if (roulette.mode == 'card') {
                            temporary.v = roulette.content[Math.floor(Math.random() * roulette.content.length)];
                            temporary.v2 = temporary.v;
                        } else if (roulette.mode == 'nicecard') {
                            temporary.v = roulette.content[Math.floor(Math.random() * roulette.content.length)];
                            temporary.v2 = temporary.v;
                        }
                        roulette.v[i3] = { v: temporary.v, v2: temporary.v2, y: size.font * r * 2 * 1.25 };
                    } else if (size.font * r * 0 * 1.25 - 1 < roulette.v[i3].y && roulette.v[i3].y < size.font * r * 0 * 1.25 + 10 && roulette.can.stop == true) {
                        roulette.can.stop2 = true;
                        roulette.result = roulette.v[i3];
                        roulette.f.decide();
                    }
                    if (roulette.mode == 'minus') ctx.fillStyle = '#FA1830';
                    else ctx.fillStyle = '#FFFFFF';
                    txw = ctx.measureText(roulette.v[i3].v2);
                    txw4 = txw.width;
                    if (txw4 > canvas.width * 0.33) txw4 = canvas.width * 0.32;
                    else txw4 = canvas.width * 0.65 - txw4;
                    ctx.fillText(roulette.v[i3].v2, txw4, canvas.height * 0.2 + size.font * r * 1.25 * 2 + roulette.v[i3].y, canvas.width * 0.33);
                }
                if (roulette.can.stop2) {
                    roulette.stop = true;
                    roulette.can.stop2 = false;
                }
                ctx.beginPath(); //以下大枠（はみ出た文字の隠蔽）の壁画
                ctx.rect(canvas.width * 0.3 - 6, canvas.height * 0.2 - size.font * r * 1.25 + 6, canvas.width * 0.4 + 12, size.font * r * 1.25);
                ctx.fillStyle = temporary.color;
                ctx.fill();
                ctx.beginPath();
                ctx.rect(canvas.width * 0.3 - 6, canvas.height * 0.2 + size.font * r * 3 * 1.25 - 6, canvas.width * 0.4 + 12, size.font * r * 1.25 + 8);
                ctx.fill();
                ctx.beginPath();
                ctx.rect(canvas.width * 0.3 - size.font * r * 1.25, canvas.height * 0.2 - size.font * r * 1.25 + 6, size.font * r * 1.25 + 12, size.font * r * 5 * 1.25 - 4);
                ctx.fill();
                ctx.beginPath();
                ctx.rect(canvas.width * 0.7, canvas.height * 0.2 - size.font * r * 1.25 + 6, size.font * r * 1.25 + 12, size.font * r * 5 * 1.25 - 4);
                ctx.fill();
            } if (display.s.moving) {
                ctx.beginPath();
                ctx.rect(canvas.width * 0.7, 4.5, canvas.width * 0.3 - 8, size.font * r * 1.1);
                ctx.fillStyle = '#FFFFFF';
                ctx.fill();
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = '6';
                ctx.stroke();
                ctx.beginPath();
                ctx.fillStyle = '#000000';
                ctx.font = size.font * r * 1.1 + 'px sans serif';
                temporary.i15 = now.can.move_roll.toString();
                if (temporary.i15.length == 1) temporary.i15 = ' ' + temporary.i15;
                ctx.fillText('あと' + temporary.i15 + 'マス', canvas.width * 0.7, size.font * r * 1.1 - 4.5, canvas.width * 0.3);
            }
            //以下ボタン壁画　左、右、上、下の順番。
            ctx.beginPath();
            ctx.rect(10, canvas.height * 0.79 + 8, canvas.width * 0.1 - 15, canvas.height * 0.105 - 5);
            ctx.fillStyle = '#FFFFFF';
            ctx.fill()
            ctx.lineWidth = 6;
            ctx.strokeStyle = '#000000';
            ctx.stroke();
            ctx.beginPath();
            ctx.rect(canvas.width * 0.1 + 2.5, canvas.height * 0.79 + 8, canvas.width * 0.1 - 15, canvas.height * 0.105 - 5);
            ctx.fill();
            ctx.stroke();
            ctx.beginPath();
            ctx.rect(canvas.width * 0.05, canvas.height * 0.68 + 18, canvas.width * 0.1 - 10, canvas.height * 0.105 - 15);
            ctx.fill();
            ctx.stroke();
            ctx.beginPath();
            ctx.rect(canvas.width * 0.05, canvas.height * 0.89 + 18, canvas.width * 0.1 - 10, canvas.height * 0.105 - 15);
            ctx.fill();
            ctx.stroke();
            shapes.unshift({ x: 10, y: canvas.height * 0.79 + 8, w: canvas.width * 0.1 - 15, h: canvas.height * 0.105 - 5, what: 'key,left' });
            shapes.unshift({ x: canvas.width * 0.1 + 2.5, y: canvas.height * 0.79 + 8, w: canvas.width * 0.1 - 15, h: canvas.height * 0.105 - 5, what: 'key,right' });
            shapes.unshift({ x: canvas.width * 0.05, y: canvas.height * 0.68 + 8, w: canvas.width * 0.1 - 10, h: canvas.height * 0.105 - 5, what: 'key,up' });
            shapes.unshift({ x: canvas.width * 0.05, y: canvas.height * 0.89 + 8, w: canvas.width * 0.1 - 10, h: canvas.height * 0.105 - 5, what: 'key,down' });

            ctx.font = size.font * r * 2 + 'px sans serif'; //以下エンターボタンの壁画
            ctx.fillStyle = '#FFFFFF';
            txw = ctx.measureText('⏎');
            ctx.beginPath();
            ctx.rect(canvas.width - txw.width, canvas.height - size.font * r - 40, txw.width, size.font * r + 40);
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = '6';
            ctx.stroke();
            ctx.beginPath();
            ctx.strokeText('⏎', canvas.width - txw.width, canvas.height - 10);
            shapes.unshift({ x: canvas.width - txw.width, y: canvas.height - size.font * r - 40, w: txw.width, h: size.font * r + 40, what: 'enter' });
            if (display.s.yn) {
                temporary.arr.i2 = ['いいえ', 'はい'];
                if (display.s.yn_de) temporary.arr.i2.push('　');
                txw3 = 0;
                for (let i3 = 0; i3 < temporary.arr.i2.length; i3++) {
                    ctx.font = size.font * r * 1.6 + 'px sans serif'; //以下YESとNOボタンの壁画
                    ctx.fillStyle = '#FFFFFF';
                    /*if (!(i3 == 0))*/ txw3 = parseFloat(txw3) + ctx.measureText(temporary.arr.i2[i3]).width;
                    ctx.beginPath();
                    ctx.rect(canvas.width - txw.width - txw3, canvas.height - size.font * r - 40, txw3, size.font * r + 40);
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = '6';
                    ctx.stroke();
                    ctx.beginPath();
                    if (i3 == 0) ctx.fillStyle = '#0000FF';
                    else if (i3 == 2) ctx.fillStyle = '#33FF33';
                    else ctx.fillStyle = '#FF0000';
                    if (i3 == 2) {
                        let svgbase64path = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDk2IiBoZWlnaHQ9IjU3OCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgb3ZlcmZsb3c9ImhpZGRlbiI+PGc+PHBhdGggZD0iTTYwNy41IDE2NUM2MDcuNDUxIDE0OC40NTIgNTk0LjA0OCAxMzUuMDQ5IDU3Ny41IDEzNUw0NDIuNSAxMzUgNDQyLjUgMTEyLjVDNDQyLjQ3NSA5MS43OTkyIDQyNS43MDEgNzUuMDI0NyA0MDUgNzVMMzE1IDc1QzI5NC4yOTkgNzUuMDI0NyAyNzcuNTI1IDkxLjc5OTIgMjc3LjUgMTEyLjVMMjc3LjUgMTM1IDE0Mi41IDEzNUMxMjUuOTUyIDEzNS4wNDkgMTEyLjU0OSAxNDguNDUyIDExMi41IDE2NUwxMTIuNSAyMTAgMTQyLjg2NyAyMTAgMTYzLjU2OCA2MTYuOTA1QzE2NC41ODEgNjM2Ljg0MiAxODEuMDM3IDY1Mi40OSAyMDEgNjUyLjVMNTE5IDY1Mi41QzUzOC45NjkgNjUyLjQ5OCA1NTUuNDMzIDYzNi44NDggNTU2LjQ0OCA2MTYuOTA1TDU3Ny4xMzIgMjEwIDYwNy41IDIxMFpNMjkyLjUgMTEyLjVDMjkyLjUgMTAwLjA3MyAzMDIuNTczIDkwIDMxNSA5MEw0MDUgOTBDNDE3LjQyNyA5MCA0MjcuNSAxMDAuMDczIDQyNy41IDExMi41TDQyNy41IDEzNSAyOTIuNSAxMzVaTTU0MS40NTUgNjE2LjE0QzU0MC44NDggNjI4LjEwMiA1MzAuOTc3IDYzNy40OTIgNTE5IDYzNy41TDIwMSA2MzcuNUMxODkuMDA1IDYzNy41MTYgMTc5LjEwNyA2MjguMTE5IDE3OC41IDYxNi4xNEwxNTcuODkgMjEwIDU2Mi4xNCAyMTBaTTU5Mi41IDE5NSAxMjcuNSAxOTUgMTI3LjUgMTY1QzEyNy41IDE1Ni43MTUgMTM0LjIxNSAxNTAgMTQyLjUgMTUwTDU3Ny41IDE1MEM1ODUuNzg0IDE1MCA1OTIuNSAxNTYuNzE1IDU5Mi41IDE2NVoiIHRyYW5zZm9ybT0ibWF0cml4KDEuMDAxMzkgMCAwIDEgLTExMyAtNzYpIi8+PHBhdGggZD0iTTI3MCA1ODUgMjcwLjM3NSA1ODVDMjc0LjUxMiA1ODQuNzk4IDI3Ny43MDMgNTgxLjI4MSAyNzcuNTAxIDU3Ny4xNDMgMjc3LjUgNTc3LjE0IDI3Ny41IDU3Ny4xMzYgMjc3LjUgNTc3LjEzMkwyNjIuNSAyNjkuNjMzQzI2Mi4yOTMgMjY1LjQ5IDI1OC43NjcgMjYyLjMwMSAyNTQuNjI1IDI2Mi41MDggMjUwLjQ4MyAyNjIuNzE0IDI0Ny4yOTMgMjY2LjI0IDI0Ny41IDI3MC4zODJMMjYyLjUgNTc3Ljg4M0MyNjIuNzA0IDU4MS44NzUgMjY2LjAwMyA1ODUuMDA1IDI3MCA1ODVaIiB0cmFuc2Zvcm09Im1hdHJpeCgxLjAwMTM5IDAgMCAxIC0xMTMgLTc2KSIvPjxwYXRoIGQ9Ik0zNjAgNTg1QzM2NC4xNDIgNTg1IDM2Ny41IDU4MS42NDIgMzY3LjUgNTc3LjVMMzY3LjUgMjcwQzM2Ny41IDI2NS44NTggMzY0LjE0MiAyNjIuNSAzNjAgMjYyLjUgMzU1Ljg1OCAyNjIuNSAzNTIuNSAyNjUuODU4IDM1Mi41IDI3MEwzNTIuNSA1NzcuNUMzNTIuNSA1ODEuNjQyIDM1NS44NTggNTg1IDM2MCA1ODVaIiB0cmFuc2Zvcm09Im1hdHJpeCgxLjAwMTM5IDAgMCAxIC0xMTMgLTc2KSIvPjxwYXRoIGQ9Ik00NDkuNjMzIDU4NSA0NTAgNTg1QzQ1NC4wMDMgNTg1LjAwNSA0NTcuMzA0IDU4MS44NjYgNDU3LjUgNTc3Ljg2OEw0NzIuNSAyNzAuMzY3QzQ3Mi43MDcgMjY2LjIyNSA0NjkuNTE3IDI2Mi42OTkgNDY1LjM3NSAyNjIuNDkyIDQ2MS4yMzMgMjYyLjI4NiA0NTcuNzA3IDI2NS40NzUgNDU3LjUgMjY5LjYxOEw0NDIuNSA1NzcuMTE3QzQ0Mi4yODQgNTgxLjI1NCA0NDUuNDYyIDU4NC43ODMgNDQ5LjU5OSA1ODQuOTk5IDQ0OS42MSA1ODQuOTk5IDQ0OS42MjEgNTg0Ljk5OSA0NDkuNjMzIDU4NVoiIHRyYW5zZm9ybT0ibWF0cml4KDEuMDAxMzkgMCAwIDEgLTExMyAtNzYpIi8+PC9nPjwvc3ZnPg==";
                        let img = new Image();
                        img.src = svgbase64path;
                        ctx.drawImage(img, canvas.width - txw.width - txw3, canvas.height - 40 - size.font * r, size.font * r + 30, size.font * r + 40);
                        shapes.unshift({ x: canvas.width - txw.width - txw3, y: canvas.height - size.font * r - 40, w: ctx.measureText(temporary.arr.i2[i3]).width, h: size.font * r + 40, what: 'yn_de' });
                    } else {
                        ctx.fillText(temporary.arr.i2[i3], canvas.width - txw.width - txw3, canvas.height - 16);
                        shapes.unshift({ x: canvas.width - txw.width - txw3, y: canvas.height - size.font * r - 40, w: ctx.measureText(temporary.arr.i2[i3]).width, h: size.font * r + 40, what: temporary.arr.i2[i3] });
                    }
                }
            }
            shapes.push({ x: 0, y: 0, w: canvas.width, h: canvas.height, what: 'canvas' });
        }
        function time(value) {
            if (value == undefined) value = now.time;
            temporary.i14 = value;
            value = parseFloat(value);
            value += 3;
            temporary.month = (value % 12) + 1;
            temporary.year = Math.floor(temporary.i14 / 12) + 1;
            return { month: temporary.month, year: temporary.year };
        }
        let state = {};
        let game = { loadmode: '' }; //localloadstartはローカルストレージのロードで始めたかどうか
        game.start = function () { //!!window.localStorage.getItem('data')でnullや空文字、undefindedかどうか判定。もし文字列ならtrueを返す。
            if (now.time < 1 && (!!window.localStorage.getItem('data')) && game.loadmode == '' && confirm('ブラウザに前回のデータがあります。読み込みますか?')) {
                data.local.load();
            } else {
                game.loadmode = 'local';
                display.f.txtbox('社長のみなさーん、' + time(now.time).month + '月ですよー！', true);
                now.can.canvas_touch = false;
                data.makedata().then(() => {
                    now.state = 'monthstart';
                    data.local.save();
                    console.log(now.state);
                })
            }
        }
        function enter() {
            if (display.s.yn) {
                yn(true); //はいいいえボタンがあるとき、「はい」を押した扱いにする。
            } else {
                now.state2 = now.state;
                now.state = '';
                if (now.state2 == 'monthstart') {
                    display.f.txtbox(player[now.player].n + '、今月はどうしますか？', true);
                    display.s.cmd2 = true;
                    display.s.state = true;
                    now.can.canvas_touch = true;
                    display.s.glasses = true;
                    card.selectmode = 'use';
                } else if (now.state2.substring(0, 8) == 'usecard2') {
                    temporary.i13 = now.state2.split(',');
                    if (card.list[temporary.i13[1]].k.split(',')[0] == 'express') {
                        now.dice_roll = 0;
                        for (let i3 = 0; i3 < card.list[temporary.i13[1]].k.split(',')[1]; i3++) {
                            now.dice_roll += Math.floor(Math.random() * 6) + 1;
                        }
                        display.f.txtbox(now.dice_roll + 'マス進めますぞ！', true);
                        display.s.cmd2 = false;
                        display.s.state = false;
                        display.s.moving = true; //残りのマスを表示
                        now.can.move = true;
                        now.can.move_roll = now.dice_roll;
                        now.can.canvas_touch = true;
                    } else if (card.list[temporary.i13[1]].k == 'buttobi') {
                        strings = 'それではぶっとびましょう！！';
                        temporary.i27 = box.p[Math.floor(Math.random() * (box.p.length - 1))];
                        flying.f({ x: temporary.i27.x, y: temporary.i27.y });
                    }
                } else if (now.state2.substring(0, 8) == 'usecard3') {
                    temporary.i13 = now.state2.split(',');
                    if (temporary.i13[1] == 'ittouchiwonuku') {
                        temporary.i13[2] = parseFloat(temporary.i13[2]);
                        if (temporary.i13[2] == 0) {
                            temporary.i9 = { v: Number.MIN_SAFE_INTEGER, w: '' }; //Number.MIN_SAFE_INTEGERはjsでの最小の数字
                            for (let i3 = 0; i3 < player.length; i3++) {
                                if (player[i3].m > temporary.i9.v) {
                                    temporary.i9.v = player[i3].m;
                                    temporary.i9.w = i3;
                                }
                            }
                            temporary.i9.add = (Math.floor(time(now.time).year / 10) + 1) * 10000; //追加金額
                            display.f.txtbox('今一番所持金が多いのは' + player[temporary.i9.w].n + '、金額は' + money.f(temporary.i9.v) + '円です！\nそれプラス' + money.f(temporary.i9.add) + '円もらっちゃいましょう！', true);
                            player[now.player].m += temporary.i9.v + temporary.i9.add;
                            now.state = 'usecard3,ittouchiwonuku,1';
                        } else if (temporary.i13[2] == 1) {
                            strings = player[now.player].n + 'の所持金は' + money.f(player[now.player].m) + '円!';
                            now.state = 'turnfinish';
                        }
                    }
                } else if (now.state2 == 'carddeleteset') {
                    roulette.f.end();
                    card.f.deleteset();
                }
                else if (now.state2 == 'roulettestop') {
                    roulette.can.stop = true;
                    roulette.can.stop2 = false;
                } else if (now.state2 == 'rouletteget') {
                    if (roulette.result.v2.charAt(roulette.result.v2.length - 1) == '円') {
                        strings = player[now.player].n + 'の所持金は' + money.f(player[now.player].m) + '円！';
                        now.state = 'turnfinish';
                    } else {
                        strings = player[now.player].n + 'は' + roulette.result.v2 + 'を手に入れた！';
                        if (player[now.player].card.length > card.max) {
                            now.state = 'carddeleteset';
                        }
                        else now.state = 'turnfinish';
                    }
                } else if (now.state2 == 'turnfinish') {
                    turn.finish();
                } else if (now.state2.substring(0, 10) == 'tokuseirei') {
                    if (now.state2.charAt(11) == '0') {
                        strings = '';
                        for (let i16 = 0; i16 < player.length; i16++) {
                            if (player[i16].m < 0) {
                                strings += player[i16].n + 'の持ち金は' + money.f(player[i16].m) + 'から0円になった！\n';
                                player[i16].m = 0;
                            }
                        }
                        now.state = 'tokuseirei,1';
                    } else {
                        now.state = '';
                        strings = '';
                        display.s.cmd2 = true;
                    }
                } else if (now.state2 == '10okuen') {
                    player[now.player].m += 100000;
                    strings = player[now.player].n + 'の持ち金が10億円増えた！\n所持金は' + money.f(player[now.player].m) + '円になった！';
                    now.state = 'empty2';
                } else if (now.state2.substring(0, 5) == 'next1') {
                    strings = now.state2.substring(7, now.state2.length);
                    now.state = 'empty';
                } else if (now.state2 == 'empty') { //テキストボックスを空にする
                    strings = '';
                } else if (now.state2 == 'empty2') {
                    strings = '';
                    now.display.s.cmd2 = true;
                } else if (now.state2.substring(0, 5) == 'kisen') {
                    display.s.txtbox = true;
                    if (parseFloat(now.state2.charAt(6)) == 0) {
                        strings = 'いつも桃太郎汽船をご利用下さいましてありがとうございます！\n記念にこれをお受け取りください！';
                        now.state = 'kisen,1';
                    } else if (parseFloat(now.state2.charAt(6)) == 1) {
                        temporary.cardset = ['急行カード', '急行周遊カード', '特急カード', 'ぶっとびカード', '快急カード', '急行周遊カード', '徳政令カード',];
                        temporary.card = temporary.cardset[Math.floor(Math.random() * (temporary.cardset.length - 1))];
                        player[now.player].card.push([temporary.card, search.f.card(temporary.card).t]);
                        strings = `これはラッキー！\n${player[now.player].n}は${temporary.card}を手に入れた！`;
                        if (player[now.player].card.length > card.max) now.state = 'carddeleteset';
                        else now.state = 'turnfinish';
                    } else now.state = 'turnfinish';
                }
            }
        }
        function arrive(value) {
            moving.auto.tf = false;
            if (value == undefined || value == 0) {
                past.coordinate = [];
                temporary.sta = search.f.coordinate(player[now.player].x, player[now.player].y);
                display.f.txtbox(['none'], true);
                display.s.money = true; //金額表示を出す
                display.s.moving = false; //残りマス表示を消す
                now.can.canvas_touch = false;
                display.s.glasses = false; //虫メガネ機能のボタンを消す
                if (Array.isArray(box.p[temporary.sta.order].b)) { //物件駅に到着した場合
                    strings = player[now.player].n + 'は物件駅\n' + stde(temporary.sta.n) + 'に止まった！';
                    display.s.cmd1 = true;
                    bukken.mode = 'buy';
                    display.f.bukken(['bukkenbox', player[now.player].x, player[now.player].y], true);
                    now.can.bukken.buy = true;
                } else if (/buycard/.test(box.p[temporary.sta.order].b.toLowerCase())) { //カード売り場に到着した場合
                    strings = player[now.player].n + 'はカード売り場駅\n' + stde(temporary.sta.n) + 'に止まった！';
                    display.s.cmd3 = true;
                    card.mode = 'buy';
                    display.s.buycard = true;
                    now.can.card.buy = true;
                    display.s.card_sta = search.f.coordinate(player[now.player].x, player[now.player].y).order;
                } else if (/blue|plus/.test(box.p[temporary.sta.order].b.toLowerCase())) { //青マス(プラス駅)に到着した場合
                    strings = player[now.player].n + 'はプラス駅\n' + stde(temporary.sta.n) + 'に止まった！';
                    roulette.f.start('plus');
                } else if (/red|minus/.test(box.p[temporary.sta.order].b.toLowerCase())) { //赤マス(マイナス駅)に到着した場合
                    strings = player[now.player].n + 'はマイナス駅\n' + stde(temporary.sta.n) + 'に止まった！';
                    roulette.f.start('minus');
                } else if (box.p[temporary.sta.order].b.toLowerCase() == 'nicecard') {
                    strings = player[now.player].n + 'はナイスカード駅\n' + stde(temporary.sta.n) + 'に止まった!\nちょっぴりいいカードが手に入る!';
                    roulette.f.start('nicecard');
                } else if (/yellow|card/.test(box.p[temporary.sta.order].b.toLowerCase())) { //黄マス(カード駅)に到着した場合
                    strings = player[now.player].n + 'はカード駅\n' + stde(temporary.sta.n) + 'に止まった！';
                    roulette.f.start('card');
                } else if (/port/.test(box.p[temporary.sta.order].b.toLowerCase())) { //港に到着した場合
                    strings = player[now.player].n + 'は\n' + stde(temporary.sta.n) + 'に止まった！';
                    temporary.random = Math.random();
                    if ((temporary.random > 0.5 && player[now.player].card.length < card.max) || temporary.random > 0.9) now.state = 'kisen,0';
                    else now.state = 'turnfinish';
                }
            } else if (value == 1) {
                temporary.sta = search.f.coordinate(player[now.player].x, player[now.player].y);
                if (temporary.sta.p == 'sea') strings = `${player[now.player].n}!海上に着きましたぞ!`;
                else strings = `${player[now.player].n}!${stde(temporary.sta.n)}(${temporary.sta.p.areaname()})に着きましたぞ!`;
                now.state = 'turnfinish';
            }
        }
        function stde(value) { //駅名の「駅」の部分の削除
            if (value == undefined) value = '';
            if (value.toString().charAt(value.length - 1) == '駅') return value.substring(0, value.length - 1);
            else if (!(isNaN(parseFloat(value)))) return '';
            else return value;
        }
        function yn(result) {
            console.log(yn_strings);
            yn_strings = yn_strings.split(',');
            if (yn_strings[0] == 'bukken_buyall') {
                if (result == true) {
                    temporary.i4 = bukken.buyall2(yn_strings[1], 'buy');
                    strings = player[now.player].n + 'は' + box.p[search.f.coordinate(player[now.player].x, player[now.player].y).order].n + 'の物件\n' + temporary.i4.list.length + '件を' + money.f(temporary.i4.total_money) + '円で購入した!\n残金は' + money.f(player[now.player].m) + '円!';
                } else if (result == false) {
                    strings = '';
                }
                display.s.yn = false;
                yn_strings = '';
            } else if (yn_strings[0] == 'cardshop') {
                if (result == true) {
                    if (yn_strings[1] == 'buy') {
                        yn_strings[2] = parseFloat(yn_strings[2]);
                        player[now.player].m -= card.list[yn_strings[2]].v;
                        card.point += Math.floor(card.list[yn_strings[2]].v * 0.1);
                        player[now.player].card.push([card.list[yn_strings[2]].n, card.list[yn_strings[2]].t]);
                        strings = player[now.player].n + 'は' + card.list[yn_strings[2]].n + 'を買った！\n残金は' + money.f(player[now.player].m) + '円！';
                    } else if (yn_strings[1] == 'point') {
                        yn_strings[2] = parseFloat(yn_strings[2]);
                        player[now.player].point -= card.list[yn_strings[2]].v;
                        player[now.player].card.push([card.list[yn_strings[2]].n, card.list[yn_strings[2]].t]);
                        strings = player[now.player].n + 'は\n' + card.list[yn_strings[2]].n + 'をポイントで買った！\n残りのポイントは' + money.f(player[now.player].point) + '円！';
                    } else if (yn_strings[1] == 'sell') {
                        yn_strings[2] = parseFloat(yn_strings[2]);
                        yn_strings[3] = parseFloat(yn_strings[3]);
                        player[now.player].m += Math.floor(card.list[yn_strings[2]].v / 4);
                        player[now.player].card.splice(yn_strings[3], 1);
                        strings = player[now.player].n + 'は' + card.list[yn_strings[2]].n + 'を売った！\n所持金は' + money.f(player[now.player].m) + '円になった！';
                    }
                } else if (result == false) {
                    strings = '';
                }
                display.s.yn = false;
                yn_strings = '';
            } else if (yn_strings[0] == 'cardselect') {
                display.s.yn = false;
                if (result == 'yn_de') {
                    display.s.yn = true;
                    display.s.yn_de = false;
                    strings = `${player[now.player].n}!本当に${player[now.player].card[parseFloat(yn_strings[1])][0]}を捨てますか?`;
                    yn_strings = 'cardselect,delete,' + yn_strings[1];
                } else if (result == true) {
                    if (yn_strings[1] == 'delete') {
                        strings = `${player[now.player].n}は${player[now.player].card[yn_strings[2]][0]}を捨てた!`;
                        player[now.player].card.splice(yn_strings[2], 1);
                    }
                    else card.f.use(parseFloat(yn_strings[1]));
                } else if (result == false) {
                    strings = '';
                }
            } else if (yn_strings[0] == 'carddeleteselect') {
                display.s.yn = false;
                yn_strings[1] = parseFloat(yn_strings[1]);
                strings = `${player[now.player].n}は${player[now.player].card[yn_strings[1]][0]}を捨てた!`;
                player[now.player].card.splice(yn_strings[1], 1);
                if (player[now.player].card.length > card.max) {
                    now.state = `next1,${player[now.player].n}!どのカードを捨てますか?`;
                } else {
                    card.selectmode = 'use';
                    now.state = 'turnfinish';
                }
            } else if (yn_strings[0] == 'bukken') {
                if (yn_strings[1] == 'buy') bukken.buy2(search.f.coordinate(player[now.player].x, player[now.player].y).order, yn_strings[2]);
                else if (yn_strings[1] == 'sell') bukken.sell2(search.f.coordinate(player[now.player].x, player[now.player].y).order, yn_strings[2]);
                else if (yn_strings[1] == 'steal') bukken.steal2(search.f.coordinate(player[now.player].x, player[now.player].y).order, yn_strings[2], yn_strings[3]);
                display.s.yn = false;
            } else if (yn_strings[0] == 'routego') {
                if (result) {
                    glasses.f();
                    moving.auto.tf = true;
                    //moving.auto.r = moving.auto.r2[moving.auto.r2.length - 1];
                    moving.auto.r = past.coordinate.slice(1).reverse().concat(moving.auto.r2[moving.auto.r2.length - 1]);
                    moving.auto.f();
                } else {
                    display.s.yn = false;
                }
            }
        }
        window.addEventListener("keydown", key.f);

        let graphData = new Array(box.p.length);
        let nodeNames = new Array(box.p.length);
        for (let i18 = 0; i18 < box.p.length; i18++) {
            graphData[i18] = new Array(false, false, false, false); //lastで前いたところ
            //[north,south,east,west]の順番に格納
            nodeNames[i18] = box.p[i18].n;
        }
        let doneData = graphData;
        for (let i18 = 0; i18 < line.p.length; i18++) {
            temporary.i19 = search.f.coordinate(line.p[i18].c[0].x, line.p[i18].c[0].y);
            temporary.i20 = search.f.coordinate(line.p[i18].c[1].x, line.p[i18].c[1].y);
            if (line.p[i18].c[0].x == line.p[i18].c[1].x) { //xが同じなら、y方向に変化しているということ。
                graphData[temporary.i19.order][1] = true; //south
                graphData[temporary.i20.order][0] = true; //north
            } else if (line.p[i18].c[0].y == line.p[i18].c[1].y) {//yが同じならx方向に変化している
                graphData[temporary.i19.order][3] = true; //east
                graphData[temporary.i20.order][2] = true; //west
            }
        }
        let way = { c: { x: 0, y: 0, order: 0 }, p: [], r: [], r2: [], finish: true, cx: [] }; //pはpastの略
        search.f.route = function (start, goal, num) { //numは移動可能数
            way = { c: { x: 0, y: 0, order: 0 }, p: [], r: [], r2: [], finish: true, cx: [] };
            if (isNaN(start.order)) { //start.orderが数字でないのなら
                start.order = search.f.coordinate(start.x, start.y).order;
            } else if (isNaN(start.x) || isNaN(start.y)) { //startのx座標、y座標が数字でないのなら
                start.x = box.p[start.order].x;
                start.y = box.p[start.order].y;
            }
            way.c.x = start.x;
            way.c.y = start.y;
            way.c.order = start.order;
            way.p.push({ x: way.c.x, y: way.c.y, d: [] });
            way.p[way.p.length - 1].d = [false, false, false, false];
            let d = 0; //方向を格納
            let i21 = 0;
            while (way.finish) {
                for (let i18 = 0; i18 < 4; i18++) {
                    if (graphData[way.c.order][i18] == false) {
                        way.p[way.p.length - 1].d[i18] = true;
                    }
                }
                let d2 = 0;
                if (way.p[way.p.length - 1].d[d] == false && way.p.length < num + 2) {
                    way.p[way.p.length - 1].d[d] = true;
                    if (d == 0) {
                        way.c.y--;
                        d2 = 1;
                    } else if (d == 1) {
                        way.c.y++;
                        d2 = 0;
                    } else if (d == 2) {
                        way.c.x--;
                        d2 = 3;
                    } else if (d == 3) {
                        way.c.x++;
                        d2 = 2;
                    }
                    way.c.order = search.f.coordinate(way.c.x, way.c.y).order;
                    way.p.push({ x: way.c.x, y: way.c.y, d: [] });
                    way.p[way.p.length - 1].d = [false, false, false, false];
                    way.p[way.p.length - 1].d[d2] = true;
                } else {
                    temporary.i21 = true;
                    if (way.p[way.p.length - 1].d.indexOf(false) > -1) {
                        temporary.i21 = false;
                        d = way.p[way.p.length - 1].d.indexOf(false);
                    }
                    if (way.p.length > num + 1) {
                        temporary.i21 = true;
                    }
                    if (temporary.i21 == true) {
                        way.p.splice(way.p.length - 1, 1);
                        if (way.p.length > num) {
                            way.r.push(way.p[way.p.length - 1]);
                            way.r2.push(way.p.concat());
                            way.p.splice(way.p.length - 1, 1);
                        }
                        if (way.p.length < 1) {
                            way.finish = false;
                        }
                    }
                    if (way.p.length > 0) {
                        way.c.x = way.p[way.p.length - 1].x;
                        way.c.y = way.p[way.p.length - 1].y;
                        way.c.order = search.f.coordinate(way.c.x, way.c.y).order;
                    }
                }
                i21++;
                if (i21 > 99998) break; //暴走防止用
            }
            console.log(i21);
            way.finish = true;
            return way;
        }
        //console.log(search.f.route({ x: 0, y: 0 }, '', 2));
        search.f.short = function (start, goal) { //start.orderが数字でないのなら
            if (isNaN(start.order)) start.order = search.f.coordinate(start.x, start.y).order;
            else if (isNaN(start.x) || isNaN(start.y)) { //startのx座標、y座標が数字でないのなら
                start.x = box.p[start.order].x;
                start.y = box.p[start.order].y;
            }
            if (isNaN(goal.order)) goal.order = search.f.coordinate(goal.x, goal.y).order;
            else if (isNaN(goal.x) || isNaN(goal.y)) { //startのx座標、y座標が数字でないのなら
                goal.x = box.p[goal.order].x;
                goal.y = box.p[goal.order].y;
            }
            temporary.i24 = { x: Math.abs(start.x - goal.x), y: Math.abs(start.y - goal.y), finish: true };

            let i24 = temporary.i24.x + temporary.i24.y;
            while (temporary.i24) {
                temporary.i25 = search.f.route(start, '', i24).r2;
                temporary.i25 = temporary.i25.filter(value => value[value.length - 1].x == goal.x);
                temporary.i25 = temporary.i25.filter(value => value[value.length - 1].y == goal.y);
                if (temporary.i25.length > 0) break;
                i24++;
                if (i24 > 120) temporary.i24 = false;
            }
            return temporary.i25;
        }
        let data = { now: '' };
        data.makedata = async function () {
            temporary.data = JSON.stringify({ boxp: box.p, now: now, player: player });
            data.now = await compress(temporary.data, false); //圧縮
            return 0;
        }
        data.save = async function () {
            let blob = new Blob([data.now], { "type": "text/plain" });
            let a = document.createElement('a');
            a.download = "ももてつもどきセーブデータ.txt";
            a.target = '_blank';
            if (window.URL && window.URL.createObjectURL) {
                // for Firefox
                a.href = window.URL.createObjectURL(blob);
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
            return temporary.data;
        }
        data.load = function () {
            game.loadmode = 'file';
            document.getElementById('input').click();
        }
        data.loading = async function (string) {
            try {
                string = await decompress(string, false); //解凍
                temporary.data = JSON.parse(string);
                box.p = temporary.data.boxp;
                now = temporary.data.now;
                player = temporary.data.player;
                now.player = player.length + 1;
                now.time--;
                turn.finish();
                return 0;
            } catch (e) {
                alert('ファイルを正常に読み込めませんでした。');
                console.log(e.message);
            }
        }
        data.loadFile = function (input) {
            let file = input.files[0];
            let reader = new FileReader();
            reader.readAsText(file);
            reader.onload = function () {
                console.log(reader.result);
                data.loading(reader.result);
            };
            reader.onerror = function () {
                console.log(reader.error);
            };
        }
        data.local = {};
        data.local.save = function () { //ローカルストレージ(localStorage)にセーブデータを突っ込むためのコード
            window.localStorage.setItem('data', data.now);
        }
        data.local.load = function () {
            game.loadmode = 'local';
            data.loading(window.localStorage.getItem('data'));
        }
    </script>
</body>

</html>
